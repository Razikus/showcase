import{d as As,h as ui,g as ci,f as hi,ad as es}from"./index.b025626a.js";import{f as pi,ai as se,cd as gi,W as mi,c8 as fi,co as E,cp as x,cq as _e,cr as p,cs as b,ct as T,cu as Fs,cv as de,cw as f,cx as wt,cy as d,cz as L,cA as st,cB as G,cC as M,cD as vi,cE as Ci,cF as Ss,cG as Ms,cH as Ce,cI as q,cJ as pt,cK as Ps,cL as S,cM as Le,cN as Pt,cO as Ei,cP as ne,cQ as yi,cR as V,cS as bs,cT as z,cU as Ai,cV as Fi,cW as Ts,cX as Si,cn as N,cY as $e,cZ as Ds,c_ as ts,c$ as Mi,d0 as Pi,d1 as Ht,d2 as Ye,d3 as Ls,d4 as bi,d5 as Ti,d6 as Di,d7 as ss}from"./main.esm.040c62a4.js";var Li=Object.defineProperty,is=Object.getOwnPropertySymbols,wi=Object.prototype.hasOwnProperty,xi=Object.prototype.propertyIsEnumerable,rs=(t,e,s)=>e in t?Li(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ee=(t,e)=>{for(var s in e||(e={}))wi.call(e,s)&&rs(t,s,e[s]);if(is)for(var s of is(e))xi.call(e,s)&&rs(t,s,e[s]);return t},Gi=(t,e,s)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:s})};function it(t){const e=t&&t.__v_raw;return e?it(e):t}function bt(t){return Object.isExtensible(t)&&Gi(t,"__v_skip",!0),t}var Ii=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),_i=t=>`on${t.charAt(0).toUpperCase()}${t.substring(1,t.length)}`,Vi=()=>{const t={};se.PUBLIC_EVENTS.map(n=>_i(Ii(n))).forEach(n=>t[n]=void 0);const s={},i={modelValue:{handler(n,a){!this.gridCreated||!this.api||n!==a&&(n&&a&&n.length===a.length&&n.every((l,u)=>l===a[u])||se.processOnChange({rowData:n},this.api,!0))},deep:!0}};let r=null,o={};return se.ALL_PROPERTIES.filter(n=>n!="gridOptions").forEach(n=>{t[n]={default:se.VUE_OMITTED_PROPERTY},i[n]={handler(a,l){o[n]=a===se.VUE_OMITTED_PROPERTY?void 0:a,r==null&&(r=setTimeout(()=>{se.processOnChange(o,this.api,!0),r=null,o={}},0))},deep:!0}}),[t,s,i]},xt=class ws{static getComponentDefinition(e,s){let i;return typeof e=="string"?i=this.searchForComponentInstance(s,e):i={extends:As(Ee({},e))},i||console.error(`Could not find component with name of ${e}. Is it in Vue.components?`),i.extends?(i.extends.setup&&(i.setup=i.extends.setup),i.extends.props=this.addParamsToProps(i.extends.props)):i.props=this.addParamsToProps(i.props),i}static addParamsToProps(e){return!e||Array.isArray(e)&&e.indexOf("params")===-1?e=["params",...e||[]]:typeof e=="object"&&!e.params&&(e.params={type:Object}),e}static createAndMountComponent(e,s,i,r){const o=ws.getComponentDefinition(e,i);if(!o)return;const{vNode:n,destroy:a,el:l}=this.mount(o,{params:Object.freeze(s)},i,r||{});return{componentInstance:n.component.proxy,element:l,destroy:a}}static mount(e,s,i,r){let o=hi(e,s);o.appContext=i.$.appContext,o.appContext.provides=Ee(Ee(Ee({},r),o.appContext.provides?o.appContext.provides:{}),i.$parent.$options.provide?i.$parent.$options.provide:{});let n=document.createElement("div");return es(o,n),{vNode:o,destroy:()=>{n&&es(null,n),n=null,o=null},el:n}}static searchForComponentInstance(e,s,i=10,r=!1){let o=null,n=e.$parent,a=0;for(;!o&&n&&n.$options&&++a<i;){const l=n;l.$options&&l.$options.components&&l.$options.components[s]?o=l.$options.components[s]:l[s]&&(o=l[s]),n=n.$parent}if(!o){const l=e.$.appContext.components;l&&l[s]&&(o=l[s])}return!o&&!r?(console.error(`Could not find component with name of ${s}. Is it in Vue.components?`),null):o}},Oi=class rt extends mi{constructor(e,s){super(),this.parent=e,rt.provides||(rt.provides=s)}createWrapper(e){const s=this;class i extends Ri{init(n){super.init(n)}hasMethod(n){const a=r.getFrameworkComponentInstance();return a[n]?!0:a.$.setupState[n]!=null}callMethod(n,a){var l;const u=this.getFrameworkComponentInstance(),c=r.getFrameworkComponentInstance();return c[n]?c[n].apply(u,a):(l=c.$.setupState[n])==null?void 0:l.apply(u,a)}addMethod(n,a){r[n]=a}overrideProcessing(n){return s.parent.autoParamsRefresh&&n==="refresh"}processMethod(n,a){return n==="refresh"&&(this.getFrameworkComponentInstance().params=a[0]),this.hasMethod(n)?this.callMethod(n,a):n==="refresh"}createComponent(n){return s.createComponent(e,n)}}const r=new i;return r}createComponent(e,s){return xt.createAndMountComponent(e,s,this.parent,rt.provides)}createMethodProxy(e,s,i){return function(){return e.overrideProcessing(s)?e.processMethod(s,arguments):e.hasMethod(s)?e.callMethod(s,arguments):(i&&console.warn("AG Grid: Framework component is missing the method "+s+"()"),null)}}destroy(){this.parent=null}},Ri=class{getGui(){return this.element}destroy(){this.getFrameworkComponentInstance()&&typeof this.getFrameworkComponentInstance().destroy=="function"&&this.getFrameworkComponentInstance().destroy(),this.unmount()}getFrameworkComponentInstance(){return this.componentInstance}init(t){var e;const{componentInstance:s,element:i,destroy:r}=this.createComponent(t);this.componentInstance=s,this.unmount=r,this.element=(e=i.firstElementChild)!=null?e:i}},Ni=class extends fi{constructor(t){super("vue"),this.parent=t}frameworkComponent(t,e){let s=xt.searchForComponentInstance(this.parent,t,10,!0)?t:null;if(!s&&e&&e[t]){const i=e[t];s=xt.searchForComponentInstance(this.parent,i,10,!0)?i:null}return s}isFrameworkComponent(t){return typeof t=="object"}},Bi=new Set(["rowDataUpdated","cellValueChanged","rowValueChanged"]),os="onUpdate:modelValue",ki="update:modelValue",[Ui,Hi,Ki]=Vi(),Eo=As({render(){return ui("div")},props:Ee({gridOptions:{type:Object,default:()=>({})},autoParamsRefresh:{type:Boolean,default:()=>!1},componentDependencies:{type:Array,default:()=>[]},plugins:[],modules:{type:Array,default:()=>[]},modelValue:{type:Array,default:void 0,required:!1}},Ui),data(){return{api:void 0,gridCreated:!1,isDestroyed:!1,gridReadyFired:!1,emitRowModel:void 0}},computed:Hi,watch:Ki,methods:{globalEventListenerFactory(t){return(e,s)=>{if(this.isDestroyed)return;e==="gridReady"&&(this.gridReadyFired=!0);const i=pi.has(e);i&&!t||!i&&t||this.updateModelIfUsed(e)}},processChanges(t,e,s){if(this.gridCreated){if(this.skipChange(t,e,s))return;const i={[t]:t==="rowData"?Object.isFrozen(e)?e:bt(it(e)):e};se.processOnChange(i,this.api)}},checkForBindingConflicts(){const t=this;(t.rowData&&t.rowData!=="AG-VUE-OMITTED-PROPERTY"||this.gridOptions.rowData)&&t.modelValue&&console.warn("AG Grid: Using both rowData and v-model. rowData will be ignored.")},getRowData(){var t;const e=[];return(t=this.api)==null||t.forEachNode(s=>{e.push(s.data)}),e},updateModelIfUsed(t){this.gridReadyFired&&this.$attrs[os]&&Bi.has(t)&&this.emitRowModel&&this.emitRowModel()},getRowDataBasedOnBindings(){const t=this,e=t.modelValue;return e||(t.rowData?t.rowData:t.gridOptions.rowData)},getProvides(){let t=ci(),e={};for(;t;)t&&t.provides&&(e=Ee(Ee({},e),t.provides)),t=t.parent;return e},skipChange(t,e,s){if(this.gridReadyFired&&t==="rowData"&&this.$attrs[os]){if(e===s)return!0;if(e&&s){const i=e,r=s;if(i.length===r.length){for(let o=0;o<i.length;o++)if(i[o]!==r[o])return!1;return!0}}}return!1},debounce(t,e){let s;return()=>{const i=function(){t()};window.clearTimeout(s),s=window.setTimeout(i,e)}}},mounted(){this.emitRowModel=this.debounce(()=>{this.$emit(ki,Object.freeze(this.getRowData()))},20);const t=this.getProvides(),e=new Oi(this,t),s=bt(se.combineAttributesAndGridOptions(it(this.gridOptions),this));this.checkForBindingConflicts();const i=this.getRowDataBasedOnBindings();i!==se.VUE_OMITTED_PROPERTY&&(s.rowData=i&&(Object.isFrozen(i)?i:bt(it(i))));const r={globalEventListener:this.globalEventListenerFactory().bind(this),globalSyncEventListener:this.globalEventListenerFactory(!0).bind(this),frameworkOverrides:new Ni(this),providedBeanInstances:{frameworkComponentWrapper:e},modules:this.modules};this.api=gi(this.$el,s,r),this.gridCreated=!0},unmounted(){var t;this.gridCreated&&((t=this.api)==null||t.destroy(),this.isDestroyed=!0)}});/*! Bundled license information:

@vue/shared/dist/shared.esm-bundler.js:
  (**
  * @vue/shared v3.4.21
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **)

@vue/reactivity/dist/reactivity.esm-bundler.js:
  (**
  * @vue/reactivity v3.4.21
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **)
*/var xs=Object.defineProperty,Wi=Object.defineProperties,$i=Object.getOwnPropertyDescriptor,ji=Object.getOwnPropertyDescriptors,ns=Object.getOwnPropertySymbols,zi=Object.prototype.hasOwnProperty,qi=Object.prototype.propertyIsEnumerable,as=(t,e,s)=>e in t?xs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Kt=(t,e)=>{for(var s in e||(e={}))zi.call(e,s)&&as(t,s,e[s]);if(ns)for(var s of ns(e))qi.call(e,s)&&as(t,s,e[s]);return t},Wt=(t,e)=>Wi(t,ji(e)),v=(t,e,s,i)=>{for(var r=i>1?void 0:i?$i(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(r=(i?n(e,s,r):n(r))||r);return i&&r&&xs(e,s,r),r},Je=class extends L{constructor(t){super(`
            <div class="ag-advanced-filter-header" role="row">
            </div>`),this.enabled=t}postConstruct(){this.setupAdvancedFilter(this.enabled),this.addDestroyFunc(()=>this.destroyBean(this.eAdvancedFilter)),this.addManagedListener(this.eventService,f.EVENT_GRID_COLUMNS_CHANGED,()=>this.onGridColumnsChanged()),this.addGuiEventListener("keydown",t=>this.onKeyDown(t)),this.addGuiEventListener("focusout",t=>{this.getFocusableElement().contains(t.relatedTarget)||this.focusService.clearAdvancedFilterColumn()})}getFocusableElement(){var t,e;return(e=(t=this.eAdvancedFilter)==null?void 0:t.getGui())!=null?e:this.getGui()}setEnabled(t){t!==this.enabled&&this.setupAdvancedFilter(t)}refresh(){var t;(t=this.eAdvancedFilter)==null||t.refresh()}getHeight(){return this.height}setInputDisabled(t){var e;(e=this.eAdvancedFilter)==null||e.setInputDisabled(t)}setupAdvancedFilter(t){const e=this.getGui();if(t){this.eAdvancedFilter=this.createBean(new Y);const s=this.eAdvancedFilter.getGui();this.eAdvancedFilter.addCssClass("ag-advanced-filter-header-cell"),this.height=this.columnModel.getFloatingFiltersHeight();const i=`${this.height}px`;e.style.height=i,e.style.minHeight=i,this.setAriaRowIndex(),d.setAriaRole(s,"gridcell"),d.setAriaColIndex(s,1),this.setAriaColumnCount(s),e.appendChild(s)}else d.clearElement(e),this.destroyBean(this.eAdvancedFilter),this.height=0;d.setDisplayed(e,t),this.enabled=t}setAriaColumnCount(t){d.setAriaColSpan(t,this.columnModel.getAllGridColumns().length)}setAriaRowIndex(){d.setAriaRowIndex(this.getGui(),this.headerNavigationService.getHeaderRowCount())}onGridColumnsChanged(){!this.eAdvancedFilter||(this.setAriaColumnCount(this.eAdvancedFilter.getGui()),this.setAriaRowIndex())}onKeyDown(t){switch(t.key){case M.ENTER:{this.hasFocus()&&this.focusService.focusInto(this.getFocusableElement())&&t.preventDefault();break}case M.ESCAPE:this.hasFocus()||this.getFocusableElement().focus();break;case M.UP:this.navigateUpDown(!0,t);break;case M.DOWN:this.navigateUpDown(!1,t);break;case M.TAB:if(this.hasFocus())this.navigateLeftRight(t);else{const e=this.focusService.findNextFocusableElement(this.getFocusableElement(),null,t.shiftKey);e?(t.preventDefault(),e.focus()):this.navigateLeftRight(t)}break}}navigateUpDown(t,e){this.hasFocus()&&this.focusService.focusNextFromAdvancedFilter(t)&&e.preventDefault()}navigateLeftRight(t){(t.shiftKey?this.focusService.focusLastHeader():this.focusService.focusNextFromAdvancedFilter(!1,!0))&&t.preventDefault()}hasFocus(){return this.gos.getActiveDomElement()===this.getFocusableElement()}};v([p("columnModel")],Je.prototype,"columnModel",2);v([p("focusService")],Je.prototype,"focusService",2);v([p("headerNavigationService")],Je.prototype,"headerNavigationService",2);v([b],Je.prototype,"postConstruct",1);var Gs=class extends Ps{constructor(t){super(Wt(Kt({},t),{template:`
                <div class="ag-picker-field" role="presentation">
                    <div ref="eLabel"></div>
                    <div ref="eWrapper" class="ag-wrapper ag-picker-collapsed">
                        <div ref="eDisplayField" class="ag-picker-field-display"></div>
                        <ag-input-text-field ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`})),this.params=t}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:t,ariaLabel:e}=this.params;d.setDisplayed(this.eDisplayField,!1),t&&this.eWrapper.classList.add(t),d.setAriaLabelledBy(this.eWrapper,""),d.setAriaLabel(this.eWrapper,e)}onEnterKeyDown(t){d.stopPropagationForAgGrid(t),this.isPickerDisplayed?super.onEnterKeyDown(t):(t.preventDefault(),this.showPicker())}},gt=class Gt extends T{constructor(e,s){super(),this.comp=e,this.virtualList=s}postConstruct(){this.createManagedBean(new Fs(this.comp,this.virtualList,{dragSourceType:de.AdvancedFilterBuilder,listItemDragStartEvent:Gt.EVENT_DRAG_STARTED,listItemDragEndEvent:Gt.EVENT_DRAG_ENDED,eventSource:this,getCurrentDragValue:e=>this.getCurrentDragValue(e),isMoveBlocked:()=>!1,getNumRows:e=>e.getNumItems(),moveItem:(e,s)=>this.moveItem(e,s)}))}getCurrentDragValue(e){return e.item}moveItem(e,s){this.comp.moveItem(e,s)}};gt.EVENT_DRAG_STARTED="advancedFilterBuilderDragStarted";gt.EVENT_DRAG_ENDED="advancedFilterBuilderDragEnded";v([b],gt.prototype,"postConstruct",1);var It=gt,$t=class extends T{constructor(t,e,s){super(),this.eGui=t,this.focusWrapper=e,this.eFocusableComp=s}postConstruct(){this.addManagedListener(this.eGui,"keydown",t=>{switch(t.key){case M.TAB:t.defaultPrevented||d.stopPropagationForAgGrid(t);break;case M.UP:case M.DOWN:d.stopPropagationForAgGrid(t);break;case M.ESCAPE:if(d.isStopPropagationForAgGrid(t))return;this.eGui.contains(this.gos.getActiveDomElement())&&(t.preventDefault(),d.stopPropagationForAgGrid(t),this.focusWrapper.focus());break}}),this.addManagedListener(this.focusWrapper,"keydown",t=>{switch(t.key){case M.ENTER:if(d.isStopPropagationForAgGrid(t))return;this.gos.getActiveDomElement()===this.focusWrapper&&(t.preventDefault(),d.stopPropagationForAgGrid(t),this.eFocusableComp.getFocusableElement().focus());break}}),this.addManagedListener(this.focusWrapper,"focusin",()=>{this.focusWrapper.classList.add("ag-advanced-filter-builder-virtual-list-item-highlight")}),this.addManagedListener(this.focusWrapper,"focusout",t=>{this.focusWrapper.contains(t.relatedTarget)||this.focusWrapper.classList.remove("ag-advanced-filter-builder-virtual-list-item-highlight")})}};v([b],$t.prototype,"postConstruct",1);function Is(t,e){return{pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderAddField",pickerAriaLabelValue:"Advanced Filter Builder Add Field",pickerType:"ag-list",valueList:[{key:"condition",displayValue:t("advancedFilterBuilderAddCondition")},{key:"join",displayValue:t("advancedFilterBuilderAddJoin")}],valueFormatter:s=>{var i;return s==null?null:(i=s.displayValue)!=null?i:s.key},pickerIcon:"advancedFilterBuilderAdd",maxPickerWidth:`${e!=null?e:120}px`,wrapperClassName:"ag-advanced-filter-builder-item-button",ariaLabel:t("advancedFilterBuilderAddButtonTooltip")}}var B=class{};B.EVENT_ADDED="advancedFilterBuilderAdded";B.EVENT_MOVED="advancedFilterBuilderMoved";B.EVENT_REMOVED="advancedFilterBuilderRemoved";B.EVENT_VALUE_CHANGED="advancedFilterBuilderValueChanged";B.EVENT_VALID_CHANGED="advancedFilterBuilderValidChanged";var jt=class extends L{constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `),this.validationMessage=null}init(t){const{item:e,createPill:s}=t;this.item=e,this.createPill=s,this.filterModel=e.filterModel,this.setupColumnCondition(this.filterModel),this.validate(),this.addDestroyFunc(()=>this.destroyBeans([this.eColumnPill,this.eOperatorPill,this.eOperandPill]))}getDragName(){return this.filterModel.colId?this.advancedFilterExpressionService.parseColumnFilterModel(this.filterModel):this.getDefaultColumnDisplayValue()}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderFilterItem")} ${this.getDragName()}`}getValidationMessage(){return this.validationMessage}getFocusableElement(){return this.eColumnPill.getFocusableElement()}setupColumnCondition(t){var e;const s=this.advancedFilterExpressionService.getColumnDetails(t.colId);this.baseCellDataType=s.baseCellDataType,this.column=s.column,this.numOperands=this.getNumOperands(this.getOperatorKey()),this.eColumnPill=this.createPill({key:this.getColumnKey(),displayValue:(e=this.getColumnDisplayValue())!=null?e:this.getDefaultColumnDisplayValue(),cssClass:"ag-advanced-filter-builder-column-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getColumnAutocompleteEntries()}),update:i=>this.setColumnKey(i),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderColumnSelectField",pickerAriaLabelValue:"Advanced Filter Builder Column Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderColumn")}),this.getGui().appendChild(this.eColumnPill.getGui()),d.exists(this.getColumnKey())&&(this.createOperatorPill(),this.hasOperand()&&this.createOperandPill())}createOperatorPill(){var t;this.eOperatorPill=this.createPill({key:this.getOperatorKey(),displayValue:(t=this.getOperatorDisplayValue())!=null?t:this.getDefaultOptionSelectValue(),cssClass:"ag-advanced-filter-builder-option-pill",isSelect:!0,getEditorParams:()=>({values:this.getOperatorAutocompleteEntries()}),update:e=>this.setOperatorKey(e),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderOptionSelectField",pickerAriaLabelValue:"Advanced Filter Builder Option Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderOption")}),this.eColumnPill.getGui().insertAdjacentElement("afterend",this.eOperatorPill.getGui())}createOperandPill(){var t;const e=(t=this.getOperandDisplayValue())!=null?t:"";this.eOperandPill=this.createPill({key:e,displayValue:e,baseCellDataType:this.baseCellDataType,cssClass:"ag-advanced-filter-builder-value-pill",isSelect:!1,update:s=>this.setOperand(s),ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderValue")}),this.getGui().appendChild(this.eOperandPill.getGui())}getColumnKey(){return this.filterModel.colId}getColumnDisplayValue(){return this.advancedFilterExpressionService.getColumnDisplayValue(this.filterModel)}getOperatorKey(){return this.filterModel.type}getOperatorDisplayValue(){return this.advancedFilterExpressionService.getOperatorDisplayValue(this.filterModel)}getOperandDisplayValue(){return this.advancedFilterExpressionService.getOperandDisplayValue(this.filterModel,!0)}hasOperand(){return this.numOperands>0}getOperatorAutocompleteEntries(){return this.column?this.advancedFilterExpressionService.getOperatorAutocompleteEntries(this.column,this.baseCellDataType):[]}setColumnKey(t){this.eOperatorPill||this.createOperatorPill();const e=this.advancedFilterExpressionService.getColumnDetails(t);this.column=e.column;const s=e.baseCellDataType;this.baseCellDataType!==s&&(this.baseCellDataType=s,this.setOperatorKey(void 0),this.eOperatorPill&&(d.removeFromParent(this.eOperatorPill.getGui()),this.destroyBean(this.eOperatorPill),this.createOperatorPill()),this.validate()),this.filterModel.colId=t,this.filterModel.filterType=this.baseCellDataType}setOperatorKey(t){const e=this.getNumOperands(t);e!==this.numOperands&&(this.numOperands=e,e===0?this.destroyOperandPill():(this.createOperandPill(),this.baseCellDataType!=="number"&&this.setOperand(""))),this.filterModel.type=t,this.validate()}setOperand(t){var e;let s=t;this.column&&(s=(e=this.advancedFilterExpressionService.getOperandModelValue(t,this.baseCellDataType,this.column))!=null?e:""),this.filterModel.filter=s,this.validate()}getNumOperands(t){var e,s;return(s=(e=this.advancedFilterExpressionService.getExpressionOperator(this.baseCellDataType,t))==null?void 0:e.numOperands)!=null?s:0}destroyOperandPill(){delete this.filterModel.filter,this.getGui().removeChild(this.eOperandPill.getGui()),this.destroyBean(this.eOperandPill),this.eOperandPill=void 0}validate(){let t=null;d.exists(this.getColumnKey())?d.exists(this.getOperatorKey())?this.numOperands>0&&!d.exists(this.getOperandDisplayValue())&&(t=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationEnterValue")):t=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectOption"):t=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectColumn"),this.item.valid=!t,t!==this.validationMessage&&(this.validationMessage=t,this.dispatchEvent({type:B.EVENT_VALID_CHANGED}))}getDefaultColumnDisplayValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectColumn")}getDefaultOptionSelectValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectOption")}};v([p("advancedFilterExpressionService")],jt.prototype,"advancedFilterExpressionService",2);v([p("valueService")],jt.prototype,"valueService",2);var Xe=class extends L{constructor(t){super(`
            <div class="ag-advanced-filter-builder-pill-wrapper" role="presentation">
                <div ref="ePill" class="ag-advanced-filter-builder-pill" role="button">
                    <span ref="eLabel" class="ag-advanced-filter-builder-pill-display"></span>
                </div>
            </div>
        `),this.params=t,this.value=t.value}postConstruct(){const{cssClass:t,ariaLabel:e}=this.params;this.ePill.classList.add(t),this.activateTabIndex([this.ePill]),this.eLabel.id=`${this.getCompId()}`,d.setAriaDescribedBy(this.ePill,this.eLabel.id),d.setAriaLabel(this.ePill,e),this.renderValue(),this.addManagedListener(this.ePill,"click",s=>{s.preventDefault(),this.showEditor()}),this.addManagedListener(this.ePill,"keydown",s=>{switch(s.key){case M.ENTER:s.preventDefault(),d.stopPropagationForAgGrid(s),this.showEditor();break}}),this.addDestroyFunc(()=>this.destroyBean(this.eEditor))}getFocusableElement(){return this.ePill}showEditor(){if(this.eEditor)return;d.setDisplayed(this.ePill,!1),this.eEditor=this.createEditorComp(this.params.type),this.eEditor.setValue(this.value);const t=this.eEditor.getGui();this.eEditor.addManagedListener(t,"keydown",e=>{switch(e.key){case M.ENTER:e.preventDefault(),d.stopPropagationForAgGrid(e),this.updateValue(!0);break;case M.ESCAPE:e.preventDefault(),d.stopPropagationForAgGrid(e),this.hideEditor(!0);break}}),this.eEditor.addManagedListener(t,"focusout",()=>{this.updateValue(!1)}),this.getGui().appendChild(t),this.eEditor.getFocusableElement().focus()}createEditorComp(t){let e;switch(t){case"text":e=new Ss;break;case"number":e=new Ci;break;case"date":e=new vi;break}return this.createBean(e)}hideEditor(t){const{eEditor:e}=this;!e||(this.eEditor=void 0,this.getGui().removeChild(e.getGui()),this.destroyBean(e),d.setDisplayed(this.ePill,!0),t&&this.ePill.focus())}renderValue(){let t;this.eLabel.classList.remove("ag-advanced-filter-builder-value-empty","ag-advanced-filter-builder-value-number","ag-advanced-filter-builder-value-text"),d.exists(this.value)?this.params.type==="number"?(t=this.value,this.eLabel.classList.add("ag-advanced-filter-builder-value-number")):(t=`"${this.value}"`,this.eLabel.classList.add("ag-advanced-filter-builder-value-text")):(t=this.advancedFilterExpressionService.translate("advancedFilterBuilderEnterValue"),this.eLabel.classList.add("ag-advanced-filter-builder-value-empty")),this.eLabel.innerText=t}updateValue(t){var e;if(!this.eEditor)return;const s=(e=this.eEditor.getValue())!=null?e:"";this.dispatchEvent({type:f.EVENT_FIELD_VALUE_CHANGED,value:s}),this.value=s,this.renderValue(),this.hideEditor(t)}};v([E("ePill")],Xe.prototype,"ePill",2);v([E("eLabel")],Xe.prototype,"eLabel",2);v([p("advancedFilterExpressionService")],Xe.prototype,"advancedFilterExpressionService",2);v([b],Xe.prototype,"postConstruct",1);var _s=class extends L{constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `)}init(t){const{item:e,createPill:s}=t,i=e.filterModel;this.filterModel=i,this.ePill=s({key:i.type,displayValue:this.advancedFilterExpressionService.parseJoinOperator(i),cssClass:"ag-advanced-filter-builder-join-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries()}),update:r=>i.type=r,pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderJoinSelectField",pickerAriaLabelValue:"Advanced Filter Builder Join Operator Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderJoinOperator")}),this.getGui().appendChild(this.ePill.getGui()),this.addDestroyFunc(()=>this.destroyBean(this.ePill))}getDragName(){return this.advancedFilterExpressionService.parseJoinOperator(this.filterModel)}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderGroupItem")} ${this.getDragName()}`}getValidationMessage(){return null}getFocusableElement(){return this.ePill.getFocusableElement()}};v([p("advancedFilterExpressionService")],_s.prototype,"advancedFilterExpressionService",2);var Zi=class extends Ps{constructor(t){super(Wt(Kt({},t),{template:`
                <div class="ag-picker-field ag-advanced-filter-builder-pill-wrapper" role="presentation">
                    <div ref="eLabel"></div>
                    <div ref="eWrapper" class="ag-wrapper ag-advanced-filter-builder-pill ag-picker-collapsed">
                        <div ref="eDisplayField" class="ag-picker-field-display ag-advanced-filter-builder-pill-display"></div>
                        <ag-input-text-field ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`})),this.params=t}getFocusableElement(){return this.eWrapper}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:t,ariaLabel:e}=this.params;this.eWrapper.classList.add(t),d.setAriaLabelledBy(this.eWrapper,""),d.setAriaLabel(this.eWrapper,e)}createPickerComponent(){var t;if(!this.values){const{values:e}=this.params.getEditorParams();this.values=e;const s=this.value.key,i=(t=e.find(r=>r.key===s))!=null?t:{key:s,displayValue:this.value.displayValue};this.value=i}return super.createPickerComponent()}onEnterKeyDown(t){d.stopPropagationForAgGrid(t),this.isPickerDisplayed?super.onEnterKeyDown(t):(t.preventDefault(),this.showPicker())}},U=class extends Ms{constructor(t,e,s){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div ref="eItem" class="ag-advanced-filter-builder-item" role="presentation">
                    <div ref="eTreeLines" class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true"></div>
                    <span ref="eDragHandle" class="ag-drag-handle" aria-hidden="true"></span>
                    <span ref="eValidation" class="ag-advanced-filter-builder-item-button ag-advanced-filter-builder-invalid" aria-hidden="true"></span>
                </div>
                <div ref="eButtons" class="ag-advanced-filter-builder-item-buttons">
                    <span ref="eMoveUpButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <span ref="eMoveDownButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <div ref="eAddButton" role="presentation"></div>
                    <span ref="eRemoveButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                </div>
            </div>
        `),this.item=t,this.dragFeature=e,this.focusWrapper=s,this.moveUpDisabled=!1,this.moveDownDisabled=!1}postConstruct(){const{filterModel:t,level:e,showMove:s}=this.item,i=t.filterType==="join";if(this.ePillWrapper=this.createManagedBean(i?new _s:new jt),this.ePillWrapper.init({item:this.item,createPill:r=>this.createPill(r)}),this.eDragHandle.insertAdjacentElement("afterend",this.ePillWrapper.getGui()),e===0){const r=document.createElement("div");r.classList.add("ag-advanced-filter-builder-item-tree-line-vertical-bottom"),r.classList.add("ag-advanced-filter-builder-item-tree-line-root"),this.eTreeLines.appendChild(r),d.setDisplayed(this.eDragHandle,!1),d.setDisplayed(this.eButtons,!1),d.setAriaExpanded(this.focusWrapper,!0)}else this.setupTreeLines(e),this.eDragHandle.appendChild(d.createIconNoSpan("advancedFilterBuilderDrag",this.gos)),this.setupValidation(),this.setupMoveButtons(s),this.setupAddButton(),this.setupRemoveButton(),this.setupDragging(),this.updateAriaExpanded();d.setAriaLevel(this.focusWrapper,e+1),this.initialiseTabGuard({}),this.createManagedBean(new $t(this.getGui(),this.focusWrapper,this.ePillWrapper)),this.updateAriaLabel(),this.addManagedListener(this.ePillWrapper,B.EVENT_VALUE_CHANGED,()=>this.dispatchEvent({type:B.EVENT_VALUE_CHANGED})),this.addManagedListener(this.ePillWrapper,B.EVENT_VALID_CHANGED,()=>this.updateValidity())}setState(t){const{level:e}=this.item;if(e===0)return;const{showMove:s}=this.item,{disableMoveUp:i,disableMoveDown:r,treeLines:o,showStartTreeLine:n}=t;this.updateTreeLines(o,n),this.updateAriaExpanded(),s&&(this.moveUpDisabled=!!i,this.moveDownDisabled=!!r,this.eMoveUpButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",i),this.eMoveDownButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",r),d.setAriaDisabled(this.eMoveUpButton,!!i),d.setAriaDisabled(this.eMoveDownButton,!!r),this.moveUpTooltipFeature.refreshToolTip(),this.moveDownTooltipFeature.refreshToolTip())}focusMoveButton(t){(t?this.eMoveUpButton:this.eMoveDownButton).focus()}afterAdd(){this.ePillWrapper.getFocusableElement().focus()}setupTreeLines(t){for(let e=0;e<t;e++){const s=document.createElement("div");this.eTreeLines.appendChild(s)}}updateTreeLines(t,e){const s=t.length-1,{children:i}=this.eTreeLines;for(let o=0;o<s;o++){const n=i.item(o);n&&n.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!t[o])}const r=i.item(s);if(r){r.classList.add("ag-advanced-filter-builder-item-tree-line-horizontal");const o=t[s];r.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-top",o),r.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!o)}this.eDragHandle.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-bottom",e)}setupValidation(){this.eValidation.appendChild(d.createIconNoSpan("advancedFilterBuilderInvalid",this.gos)),this.validationTooltipFeature=this.createManagedBean(new Ce({getGui:()=>this.eValidation,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.ePillWrapper.getValidationMessage(),getTooltipShowDelayOverride:()=>1e3})),this.updateValidity()}setupAddButton(){var t;const e=Is(i=>this.advancedFilterExpressionService.translate(i),(t=this.gos.get("advancedFilterBuilderParams"))==null?void 0:t.addSelectWidth),s=this.createManagedBean(new Gs(e));this.addManagedListener(s,f.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:i})=>this.dispatchEvent({type:B.EVENT_ADDED,item:this.item,isJoin:i.key==="join"})),this.eAddButton.appendChild(s.getGui()),this.createManagedBean(new Ce({getGui:()=>this.eAddButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")}))}setupRemoveButton(){this.eRemoveButton.appendChild(d.createIconNoSpan("advancedFilterBuilderRemove",this.gos)),this.addManagedListener(this.eRemoveButton,"click",()=>this.removeItem()),this.addManagedListener(this.eRemoveButton,"keydown",t=>{switch(t.key){case M.ENTER:t.preventDefault(),d.stopPropagationForAgGrid(t),this.removeItem();break}}),this.createManagedBean(new Ce({getGui:()=>this.eRemoveButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")})),d.setAriaLabel(this.eRemoveButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")),this.activateTabIndex([this.eRemoveButton])}setupMoveButtons(t){t?(this.eMoveUpButton.appendChild(d.createIconNoSpan("advancedFilterBuilderMoveUp",this.gos)),this.addManagedListener(this.eMoveUpButton,"click",()=>this.moveItem(!0)),this.addManagedListener(this.eMoveUpButton,"keydown",e=>{switch(e.key){case M.ENTER:e.preventDefault(),d.stopPropagationForAgGrid(e),this.moveItem(!0);break}}),this.moveUpTooltipFeature=this.createManagedBean(new Ce({getGui:()=>this.eMoveUpButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveUpDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")})),d.setAriaLabel(this.eMoveUpButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")),this.eMoveDownButton.appendChild(d.createIconNoSpan("advancedFilterBuilderMoveDown",this.gos)),this.addManagedListener(this.eMoveDownButton,"click",()=>this.moveItem(!1)),this.addManagedListener(this.eMoveDownButton,"keydown",e=>{switch(e.key){case M.ENTER:e.preventDefault(),d.stopPropagationForAgGrid(e),this.moveItem(!1);break}}),this.moveDownTooltipFeature=this.createManagedBean(new Ce({getGui:()=>this.eMoveDownButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveDownDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")})),d.setAriaLabel(this.eMoveDownButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")),this.activateTabIndex([this.eMoveUpButton,this.eMoveDownButton])):(d.setDisplayed(this.eMoveUpButton,!1),d.setDisplayed(this.eMoveDownButton,!1))}updateValidity(){d.setVisible(this.eValidation,!this.item.valid),this.validationTooltipFeature.refreshToolTip(),this.updateAriaLabel()}createPill(t){var e,s;const{key:i,displayValue:r,cssClass:o,update:n,ariaLabel:a}=t,l=u=>{u!=null&&(n(u),this.dispatchEvent({type:B.EVENT_VALUE_CHANGED}))};if(t.isSelect){const{getEditorParams:u,pickerAriaLabelKey:c,pickerAriaLabelValue:h}=t,g=this.gos.get("advancedFilterBuilderParams"),m=`${(e=g==null?void 0:g.pillSelectMinWidth)!=null?e:140}px`,y=`${(s=g==null?void 0:g.pillSelectMaxWidth)!=null?s:200}px`,P=this.createBean(new Zi({pickerAriaLabelKey:c,pickerAriaLabelValue:h,pickerType:"ag-list",value:{key:i,displayValue:r},valueFormatter:w=>{var j;return w==null?null:(j=w.displayValue)!=null?j:w.key},variableWidth:!0,minPickerWidth:m,maxPickerWidth:y,getEditorParams:u,wrapperClassName:o,ariaLabel:a}));return this.addManagedListener(P,f.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:w})=>l(w==null?void 0:w.key)),P}else{const u=this.createBean(new Xe({value:r,cssClass:o,type:this.getInputType(t.baseCellDataType),ariaLabel:a}));return this.addManagedListener(u,f.EVENT_FIELD_VALUE_CHANGED,({value:c})=>l(c)),u}}getInputType(t){switch(t){case"text":case"object":case"boolean":return"text";case"number":return"number";case"date":case"dateString":return"date"}}setupDragging(){const t={type:de.AdvancedFilterBuilder,eElement:this.eDragHandle,dragItemName:()=>this.ePillWrapper.getDragName(),getDefaultIconName:()=>q.ICON_NOT_ALLOWED,getDragItem:()=>({}),onDragStarted:()=>this.dragFeature.dispatchEvent({type:It.EVENT_DRAG_STARTED,item:this.item}),onDragStopped:()=>this.dragFeature.dispatchEvent({type:It.EVENT_DRAG_ENDED})};this.dragAndDropService.addDragSource(t,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(t))}updateAriaLabel(){const t=this.ePillWrapper.getAriaLabel(),e=`${this.item.level+1}`,s=this.ePillWrapper.getValidationMessage();let i;s?i=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItemValidation",[t,e,s]):i=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[t,e]),d.setAriaLabel(this.focusWrapper,i)}updateAriaExpanded(){d.removeAriaExpanded(this.focusWrapper);const{filterModel:t}=this.item;(t==null?void 0:t.filterType)==="join"&&t.conditions.length&&d.setAriaExpanded(this.focusWrapper,!0)}removeItem(){this.dispatchEvent({type:B.EVENT_REMOVED,item:this.item})}moveItem(t){this.dispatchEvent({type:B.EVENT_MOVED,item:this.item,backwards:t})}};v([E("eTreeLines")],U.prototype,"eTreeLines",2);v([E("eDragHandle")],U.prototype,"eDragHandle",2);v([E("eItem")],U.prototype,"eItem",2);v([E("eButtons")],U.prototype,"eButtons",2);v([E("eValidation")],U.prototype,"eValidation",2);v([E("eMoveUpButton")],U.prototype,"eMoveUpButton",2);v([E("eMoveDownButton")],U.prototype,"eMoveDownButton",2);v([E("eAddButton")],U.prototype,"eAddButton",2);v([E("eRemoveButton")],U.prototype,"eRemoveButton",2);v([p("beans")],U.prototype,"beans",2);v([p("dragAndDropService")],U.prototype,"dragAndDropService",2);v([p("advancedFilterExpressionService")],U.prototype,"advancedFilterExpressionService",2);v([b],U.prototype,"postConstruct",1);var Qe=class extends L{constructor(t,e){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div ref="eItem" class="ag-advanced-filter-builder-item" role="presentation">
                    <div class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true">
                        <div class="ag-advanced-filter-builder-item-tree-line-vertical-top ag-advanced-filter-builder-item-tree-line-horizontal"></div>
                    </div>
                </div>
            </div>
        `),this.item=t,this.focusWrapper=e}postConstruct(){var t;d.setAriaLevel(this.focusWrapper,2);const e=Is(i=>this.advancedFilterExpressionService.translate(i),(t=this.gos.get("advancedFilterBuilderParams"))==null?void 0:t.addSelectWidth),s=this.createManagedBean(new Gs(e));this.addManagedListener(s,f.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:i})=>{this.dispatchEvent({type:B.EVENT_ADDED,item:this.item,isJoin:i.key==="join"})}),this.eItem.appendChild(s.getGui()),this.createManagedBean(new Ce({getGui:()=>s.getGui(),getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")})),this.createManagedBean(new $t(this.getGui(),this.focusWrapper,s)),d.setAriaLabel(this.focusWrapper,this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip"),`${this.item.level+1}`]))}afterAdd(){}};v([p("beans")],Qe.prototype,"beans",2);v([p("advancedFilterExpressionService")],Qe.prototype,"advancedFilterExpressionService",2);v([E("eItem")],Qe.prototype,"eItem",2);v([b],Qe.prototype,"postConstruct",1);var ae=class extends L{constructor(){super(`
            <div role="presentation" class="ag-advanced-filter-builder" tabindex="-1">
                <div role="presentation" class="ag-advanced-filter-builder-list" ref="eList"></div>
                <div role="presentation" class="ag-advanced-filter-builder-button-panel">
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-apply-button" ref="eApplyFilterButton"></button>
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-cancel-button" ref="eCancelFilterButton"></button>
                </div>
            </div>`),this.validationMessage=null}postConstruct(){var t;const{showMoveButtons:e}=(t=this.gos.get("advancedFilterBuilderParams"))!=null?t:{};this.showMove=!!e,this.addManagedPropertyListener("advancedFilterBuilderParams",({currentValue:s})=>{this.showMove=!!(s!=null&&s.showMoveButtons),this.refreshList(!1)}),this.filterModel=this.setupFilterModel(),this.setupVirtualList(),this.dragFeature=this.createManagedBean(new It(this,this.virtualList)),this.setupButtons()}refresh(){let t=this.virtualList.getLastFocusedRow();this.setupFilterModel(),this.validateItems(),this.refreshList(!1),t!=null&&(this.virtualList.getComponentAt(t)||(t=0),this.virtualList.focusRow(t))}getNumItems(){return this.items.length}moveItem(t,e){!e||!t||this.moveItemToIndex(t,e.rowIndex,e.position)}afterGuiAttached(){this.virtualList.focusRow(0)}setupVirtualList(){this.virtualList=this.createManagedBean(new pt({cssIdentifier:"advanced-filter-builder",ariaRole:"tree",listName:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderList")})),this.virtualList.setComponentCreator(this.createItemComponent.bind(this)),this.virtualList.setComponentUpdater(this.updateItemComponent.bind(this)),this.virtualList.setRowHeight(40),this.eList.appendChild(this.virtualList.getGui()),this.virtualList.setModel({getRowCount:()=>this.items.length,getRow:t=>this.items[t],areRowsEqual:(t,e)=>t===e}),this.buildList(),this.virtualList.refresh()}setupButtons(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedListener(this.eApplyFilterButton,"click",()=>{this.advancedFilterService.setModel(this.filterModel),this.filterManager.onFilterChanged({source:"advancedFilter"}),this.close()}),this.validationTooltipFeature=this.createManagedBean(new Ce({getGui:()=>this.eApplyFilterButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.validationMessage,getTooltipShowDelayOverride:()=>1e3})),this.validate(),this.addManagedListener(this.eApplyFilterButton,"mouseenter",()=>this.addOrRemoveCssClass("ag-advanced-filter-builder-validation",!0)),this.addManagedListener(this.eApplyFilterButton,"mouseleave",()=>this.addOrRemoveCssClass("ag-advanced-filter-builder-validation",!1)),this.eCancelFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderCancel"),this.activateTabIndex([this.eCancelFilterButton]),this.addManagedListener(this.eCancelFilterButton,"click",()=>this.close())}removeItemFromParent(t){const e=t.parent.conditions.indexOf(t.filterModel);return t.parent.conditions.splice(e,1),e}moveItemToIndex(t,e,s){var i;const r=this.items[e],o=((i=r.filterModel)==null?void 0:i.filterType)==="join"&&s==="bottom",n=o?r.filterModel:r.parent;if(!n||this.isChildOrSelf(n,t.filterModel)||r===t)return;this.removeItemFromParent(t);let a;o?a=0:(a=n.conditions.indexOf(r.filterModel),a===-1?a=n.conditions.length:s==="bottom"&&(a+=1)),n.conditions.splice(a,0,t.filterModel),this.refreshList(!1)}isChildOrSelf(t,e){return t===e||e.filterType==="join"&&e.conditions.some(s=>this.isChildOrSelf(t,s))}setupFilterModel(){const t=this.formatFilterModel(this.advancedFilterService.getModel());return this.stringifiedModel=JSON.stringify(t),t}formatFilterModel(t){return t=t!=null?t:{filterType:"join",type:"AND",conditions:[]},t.filterType!=="join"&&(t={filterType:"join",type:"AND",conditions:[t]}),t}buildList(){const t=(e,s,i,r)=>{s.push({filterModel:e,level:i,parent:r,valid:!0,showMove:this.showMove}),e.filterType==="join"&&(e.conditions.forEach(o=>t(o,s,i+1,e)),i===0&&s.push({filterModel:null,level:i+1,parent:e,valid:!0}))};this.items=[],t(this.filterModel,this.items,0)}refreshList(t){if(!t){const e=[];this.items.forEach(s=>{s.valid||e.push(s.filterModel)}),this.buildList(),e.length&&this.items.forEach(s=>{s.filterModel&&e.includes(s.filterModel)&&(s.valid=!1)})}this.virtualList.refresh(t),this.validate()}updateItemComponent(t,e){const s=this.items.indexOf(t),i=(a,l)=>{const u=this.items.find(h=>h.filterModel===a),c=u==null?void 0:u.parent;if(c){const{conditions:h}=c;i(c,l),l.push(h[h.length-1]===a)}},r=[],{filterModel:o}=t;o&&(i(o,r),r[0]=!1);const n=(o==null?void 0:o.filterType)==="join"&&!!o.conditions.length;e.setState({disableMoveUp:s===1,disableMoveDown:!this.canMoveDown(t,s),treeLines:r,showStartTreeLine:n})}createItemComponent(t,e){const s=this.createBean(t.filterModel?new U(t,this.dragFeature,e):new Qe(t,e));return s.addManagedListener(s,B.EVENT_REMOVED,({item:i})=>this.removeItem(i)),s.addManagedListener(s,B.EVENT_VALUE_CHANGED,()=>this.validate()),s.addManagedListener(s,B.EVENT_ADDED,({item:i,isJoin:r})=>this.addItem(i,r)),s.addManagedListener(s,B.EVENT_MOVED,({item:i,backwards:r})=>this.moveItemUpDown(i,r)),s instanceof U&&this.updateItemComponent(t,s),s}addItem(t,e){var s;const{parent:i,level:r,filterModel:o}=t,n=(o==null?void 0:o.filterType)==="join",a=e?{filterType:"join",type:"AND",conditions:[]}:{},l=n?o:i;let u=n?0:l.conditions.indexOf(o);u>=0?(n||(u+=1),l.conditions.splice(u,0,a)):l.conditions.push(a);let c=this.items.indexOf(t);const h=c>=0;if(h){t.filterModel&&c++;const g=[{filterModel:a,level:n?r+1:r,parent:l,valid:e,showMove:this.showMove}];this.items.splice(c,0,...g)}this.refreshList(h),h&&((s=this.virtualList.getComponentAt(c))==null||s.afterAdd())}removeItem(t){var e;const s=t.parent,{filterModel:i}=t,r=s.conditions.indexOf(i);s.conditions.splice(r,1);const o=((e=t.filterModel)==null?void 0:e.filterType)==="join",n=this.items.indexOf(t),a=!o&&n>=0;a&&this.items.splice(n,1),this.refreshList(a),n>=0&&this.virtualList.focusRow(n)}moveItemUpDown(t,e){const s=this.items.indexOf(t),i=e?s-1:s+1;if(i===0||!e&&!this.canMoveDown(t,s))return;const r=this.items[i],o=this.removeItemFromParent(t),{level:n,filterModel:a,parent:l}=t,{level:u,filterModel:c,parent:h}=r;if(e)if(u===n&&c.filterType==="join")c.conditions.push(a);else if(u<=n){const m=h.conditions.indexOf(c);h.conditions.splice(m,0,a)}else l.conditions[o-1].conditions.push(a);else if(u===n)if(c.filterType==="join")c.conditions.splice(0,0,a);else{const m=h.conditions.indexOf(c);h.conditions.splice(m+1,0,a)}else if(o<l.conditions.length)l.conditions.splice(o+1,0,a);else{const m=this.items.find(P=>P.filterModel===l),y=m.parent.conditions.indexOf(m.filterModel)+1;m.parent.conditions.splice(y,0,a)}this.refreshList(!1);const g=this.items.findIndex(({filterModel:m})=>m===a);if(g>=0){const m=this.virtualList.getComponentAt(g);m instanceof U&&m.focusMoveButton(e)}}canMoveDown(t,e){return!(t.level===1&&e===this.items.length-2||t.level===1&&t.parent.conditions[t.parent.conditions.length-1]===t.filterModel)}close(){this.advancedFilterService.getCtrl().toggleFilterBuilder("ui")}validate(){let t=!this.items.every(({valid:e})=>e);t?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationIncomplete"):(t=JSON.stringify(this.filterModel)===this.stringifiedModel,t?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationAlreadyApplied"):this.validationMessage=null),d.setDisabled(this.eApplyFilterButton,t),this.validationTooltipFeature.refreshToolTip()}validateItems(){const t=s=>{s.type=void 0},e=s=>{delete s.filter};this.items.forEach(s=>{if(!s.valid||!s.filterModel||s.filterModel.filterType==="join")return;const{filterModel:i}=s,{colId:r}=i,o=this.advancedFilterExpressionService.getColumnAutocompleteEntries().find(({key:u})=>u===r),n=this.advancedFilterExpressionService.getColumnDetails(i.colId);if(!o||!n.column){s.valid=!1,i.colId=void 0,t(i),e(i);return}const l=this.advancedFilterExpressionService.getDataTypeExpressionOperator(n.baseCellDataType).operators[i.type];if(!l){s.valid=!1,t(i),e(i);return}if(l.numOperands>0&&!d.exists(i.filter)){s.valid=!1;return}})}};v([E("eList")],ae.prototype,"eList",2);v([E("eApplyFilterButton")],ae.prototype,"eApplyFilterButton",2);v([E("eCancelFilterButton")],ae.prototype,"eCancelFilterButton",2);v([p("filterManager")],ae.prototype,"filterManager",2);v([p("advancedFilterService")],ae.prototype,"advancedFilterService",2);v([p("advancedFilterExpressionService")],ae.prototype,"advancedFilterExpressionService",2);v([p("beans")],ae.prototype,"beans",2);v([b],ae.prototype,"postConstruct",1);var Se=class Vs extends T{constructor(e){super(),this.enabled=e}postConstruct(){this.hasAdvancedFilterParent=!!this.gos.get("advancedFilterParent"),this.ctrlsService.whenReady(()=>this.setAdvancedFilterComp()),this.addManagedListener(this.eventService,f.EVENT_ADVANCED_FILTER_ENABLED_CHANGED,({enabled:e})=>this.onEnabledChanged(e)),this.addManagedPropertyListener("advancedFilterParent",()=>this.updateComps()),this.addDestroyFunc(()=>{this.destroyAdvancedFilterComp(),this.destroyBean(this.eBuilderComp),this.eBuilderDialog&&this.eBuilderDialog.isAlive()&&this.destroyBean(this.eBuilderDialog)})}setupHeaderComp(e){this.eHeaderComp=this.createManagedBean(new Je(this.enabled&&!this.hasAdvancedFilterParent)),e.insertAdjacentElement("beforebegin",this.eHeaderComp.getGui())}focusHeaderComp(){return this.eHeaderComp?(this.eHeaderComp.getFocusableElement().focus(),!0):!1}refreshComp(){var e,s;(e=this.eFilterComp)==null||e.refresh(),(s=this.eHeaderComp)==null||s.refresh()}refreshBuilderComp(){var e;(e=this.eBuilderComp)==null||e.refresh()}getHeaderHeight(){var e,s;return(s=(e=this.eHeaderComp)==null?void 0:e.getHeight())!=null?s:0}setInputDisabled(e){var s,i;(s=this.eFilterComp)==null||s.setInputDisabled(e),(i=this.eHeaderComp)==null||i.setInputDisabled(e)}toggleFilterBuilder(e,s){if(s&&this.eBuilderDialog||s===!1&&!this.eBuilderDialog)return;if(this.eBuilderDialog){this.builderDestroySource=e,this.destroyBean(this.eBuilderDialog);return}this.setInputDisabled(!0);const{width:i,height:r,minWidth:o}=this.getBuilderDialogSize();this.eBuilderComp=this.createBean(new ae),this.eBuilderDialog=this.createBean(new wt({title:this.advancedFilterExpressionService.translate("advancedFilterBuilderTitle"),component:this.eBuilderComp,width:i,height:r,resizable:!0,movable:!0,maximizable:!0,centered:!0,closable:!0,minWidth:o,afterGuiAttached:()=>{var n;return(n=this.eBuilderComp)==null?void 0:n.afterGuiAttached()}})),this.dispatchFilterBuilderVisibleChangedEvent(e,!0),this.eBuilderDialog.addEventListener(wt.EVENT_DESTROYED,()=>{var n;this.destroyBean(this.eBuilderComp),this.eBuilderComp=void 0,this.eBuilderDialog=void 0,this.setInputDisabled(!1),this.dispatchEvent({type:Vs.EVENT_BUILDER_CLOSED}),this.dispatchFilterBuilderVisibleChangedEvent((n=this.builderDestroySource)!=null?n:"ui",!1),this.builderDestroySource=void 0})}dispatchFilterBuilderVisibleChangedEvent(e,s){const i={type:f.EVENT_ADVANCED_FILTER_BUILDER_VISIBLE_CHANGED,source:e,visible:s};this.eventService.dispatchEvent(i)}getBuilderDialogSize(){var e,s;const i=(s=(e=this.gos.get("advancedFilterBuilderParams"))==null?void 0:e.minWidth)!=null?s:500,r=this.popupService.getPopupParent(),o=Math.round(d.getAbsoluteWidth(r))-2,n=Math.round(d.getAbsoluteHeight(r)*.75)-2,a=Math.min(Math.max(600,i),o),l=Math.min(600,n);return{width:a,height:l,minWidth:i}}onEnabledChanged(e){this.enabled=e,this.updateComps()}updateComps(){this.setAdvancedFilterComp(),this.setHeaderCompEnabled(),this.eventService.dispatchEvent({type:f.EVENT_HEADER_HEIGHT_CHANGED})}setAdvancedFilterComp(){if(this.destroyAdvancedFilterComp(),!this.enabled)return;const e=this.gos.get("advancedFilterParent");if(this.hasAdvancedFilterParent=!!e,e){const s=this.createBean(new Y),i=s.getGui(),{allThemes:r}=this.environment.getTheme();r.length&&i.classList.add(...r),i.classList.add(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr"),e.appendChild(i),this.eFilterComp=s}}setHeaderCompEnabled(){var e;(e=this.eHeaderComp)==null||e.setEnabled(this.enabled&&!this.hasAdvancedFilterParent)}destroyAdvancedFilterComp(){this.eFilterComp&&(d.removeFromParent(this.eFilterComp.getGui()),this.destroyBean(this.eFilterComp))}};Se.EVENT_BUILDER_CLOSED="advancedFilterBuilderClosed";v([p("focusService")],Se.prototype,"focusService",2);v([p("ctrlsService")],Se.prototype,"ctrlsService",2);v([p("popupService")],Se.prototype,"popupService",2);v([p("advancedFilterExpressionService")],Se.prototype,"advancedFilterExpressionService",2);v([b],Se.prototype,"postConstruct",1);var Os=Se,Y=class extends L{constructor(){super(`
            <div class="ag-advanced-filter" role="presentation" tabindex="-1">
                <ag-autocomplete ref="eAutocomplete"></ag-autocomplete>
                <button class="ag-button ag-standard-button ag-advanced-filter-apply-button" ref="eApplyFilterButton"></button>
                <button class="ag-advanced-filter-builder-button" ref="eBuilderFilterButton">
                    <span ref="eBuilderFilterButtonIcon" aria-hidden="true"></span>
                    <span class="ag-advanced-filter-builder-button-label" ref="eBuilderFilterButtonLabel"></span>
                </button>
            </div>`),this.expressionParser=null,this.isApplyDisabled=!0,this.builderOpen=!1}postConstruct(){this.eAutocomplete.setListGenerator((t,e)=>this.generateAutocompleteListParams(e)).setValidator(()=>this.validateValue()).setForceLastSelection((t,e)=>this.forceLastSelection(t,e)).setInputAriaLabel(this.advancedFilterExpressionService.translate("ariaAdvancedFilterInput")).setListAriaLabel(this.advancedFilterExpressionService.translate("ariaLabelAdvancedFilterAutocomplete")),this.refresh(),this.addManagedListener(this.eAutocomplete,st.EVENT_VALUE_CHANGED,({value:t})=>this.onValueChanged(t)),this.addManagedListener(this.eAutocomplete,st.EVENT_VALUE_CONFIRMED,({isValid:t})=>this.onValueConfirmed(t)),this.addManagedListener(this.eAutocomplete,st.EVENT_OPTION_SELECTED,({position:t,updateEntry:e,autocompleteType:s})=>this.onOptionSelected(t,e,s)),this.addManagedListener(this.eAutocomplete,st.EVENT_VALID_CHANGED,({isValid:t,validationMessage:e})=>this.onValidChanged(t,e)),this.setupApplyButton(),this.setupBuilderButton()}refresh(){const t=this.advancedFilterService.getExpressionDisplayValue();this.eAutocomplete.setValue({value:t!=null?t:"",position:t==null?void 0:t.length,updateListOnlyIfOpen:!0})}setInputDisabled(t){this.eAutocomplete.setInputDisabled(t),d.setDisabled(this.eApplyFilterButton,t||this.isApplyDisabled)}getTooltipParams(){const t=super.getTooltipParams();return t.location="advancedFilter",t}setupApplyButton(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedListener(this.eApplyFilterButton,"click",()=>this.onValueConfirmed(this.eAutocomplete.isValid())),d.setDisabled(this.eApplyFilterButton,this.isApplyDisabled)}setupBuilderButton(){this.eBuilderFilterButtonIcon.appendChild(d.createIconNoSpan("advancedFilterBuilder",this.gos)),this.eBuilderFilterButtonLabel.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilder"),this.activateTabIndex([this.eBuilderFilterButton]),this.addManagedListener(this.eBuilderFilterButton,"click",()=>this.openBuilder()),this.addManagedListener(this.advancedFilterService.getCtrl(),Os.EVENT_BUILDER_CLOSED,()=>this.closeBuilder())}onValueChanged(t){var e;t=d.makeNull(t),this.advancedFilterService.setExpressionDisplayValue(t),this.expressionParser=this.advancedFilterService.createExpressionParser(t);const s=(e=this.expressionParser)==null?void 0:e.parseExpression();s&&s!==t&&this.eAutocomplete.setValue({value:s,silent:!0,restoreFocus:!0})}onValueConfirmed(t){!t||this.isApplyDisabled||(d.setDisabled(this.eApplyFilterButton,!0),this.advancedFilterService.applyExpression(),this.filterManager.onFilterChanged({source:"advancedFilter"}))}onOptionSelected(t,e,s){const{updatedValue:i,updatedPosition:r,hideAutocomplete:o}=this.updateExpression(t,e,s);this.eAutocomplete.setValue({value:i,position:r,updateListOnlyIfOpen:o,restoreFocus:!0})}validateValue(){var t,e,s;return(t=this.expressionParser)!=null&&t.isValid()?null:(s=(e=this.expressionParser)==null?void 0:e.getValidationMessage())!=null?s:null}onValidChanged(t,e){this.isApplyDisabled=!t||this.advancedFilterService.isCurrentExpressionApplied(),d.setDisabled(this.eApplyFilterButton,this.isApplyDisabled),this.setTooltip({newTooltipText:e,showDelayOverride:1e3})}generateAutocompleteListParams(t){return this.expressionParser?this.expressionParser.getAutocompleteListParams(t):this.advancedFilterExpressionService.getDefaultAutocompleteListParams("")}updateExpression(t,e,s){var i,r;return this.advancedFilterExpressionService.updateAutocompleteCache(e,s),(r=(i=this.expressionParser)==null?void 0:i.updateExpression(t,e,s))!=null?r:this.advancedFilterService.getDefaultExpression(e)}forceLastSelection({key:t,displayValue:e},s){return!!s.toLocaleLowerCase().match(`^${(e!=null?e:t).toLocaleLowerCase()}\\s*$`)}openBuilder(){this.builderOpen||(this.builderOpen=!0,d.setDisabled(this.eBuilderFilterButton,!0),this.advancedFilterService.getCtrl().toggleFilterBuilder("ui"))}closeBuilder(){!this.builderOpen||(this.builderOpen=!1,d.setDisabled(this.eBuilderFilterButton,!1),this.eBuilderFilterButton.focus())}};v([E("eAutocomplete")],Y.prototype,"eAutocomplete",2);v([E("eApplyFilterButton")],Y.prototype,"eApplyFilterButton",2);v([E("eBuilderFilterButton")],Y.prototype,"eBuilderFilterButton",2);v([E("eBuilderFilterButtonIcon")],Y.prototype,"eBuilderFilterButtonIcon",2);v([E("eBuilderFilterButtonLabel")],Y.prototype,"eBuilderFilterButtonLabel",2);v([p("advancedFilterService")],Y.prototype,"advancedFilterService",2);v([p("advancedFilterExpressionService")],Y.prototype,"advancedFilterExpressionService",2);v([p("filterManager")],Y.prototype,"filterManager",2);v([b],Y.prototype,"postConstruct",1);var Yi={ariaAdvancedFilterBuilderItem:t=>`${t[0]}. Level ${t[1]}. Press ENTER to edit.`,ariaAdvancedFilterBuilderItemValidation:t=>`${t[0]}. Level ${t[1]}. ${t[2]} Press ENTER to edit.`,ariaAdvancedFilterBuilderList:"Advanced Filter Builder List",ariaAdvancedFilterBuilderFilterItem:"Filter Condition",ariaAdvancedFilterBuilderGroupItem:"Filter Group",ariaAdvancedFilterBuilderColumn:"Column",ariaAdvancedFilterBuilderOption:"Option",ariaAdvancedFilterBuilderValue:"Value",ariaAdvancedFilterBuilderJoinOperator:"Join Operator",ariaAdvancedFilterInput:"Advanced Filter Input",ariaLabelAdvancedFilterAutocomplete:"Advanced Filter Autocomplete",advancedFilterContains:"contains",advancedFilterNotContains:"does not contain",advancedFilterTextEquals:"equals",advancedFilterTextNotEqual:"does not equal",advancedFilterStartsWith:"begins with",advancedFilterEndsWith:"ends with",advancedFilterBlank:"is blank",advancedFilterNotBlank:"is not blank",advancedFilterEquals:"=",advancedFilterNotEqual:"!=",advancedFilterGreaterThan:">",advancedFilterGreaterThanOrEqual:">=",advancedFilterLessThan:"<",advancedFilterLessThanOrEqual:"<=",advancedFilterTrue:"is true",advancedFilterFalse:"is false",advancedFilterAnd:"AND",advancedFilterOr:"OR",advancedFilterApply:"Apply",advancedFilterBuilder:"Builder",advancedFilterValidationMissingColumn:"Column is missing",advancedFilterValidationMissingOption:"Option is missing",advancedFilterValidationMissingValue:"Value is missing",advancedFilterValidationInvalidColumn:"Column not found",advancedFilterValidationInvalidOption:"Option not found",advancedFilterValidationMissingQuote:"Value is missing an end quote",advancedFilterValidationNotANumber:"Value is not a number",advancedFilterValidationInvalidDate:"Value is not a valid date",advancedFilterValidationMissingCondition:"Condition is missing",advancedFilterValidationJoinOperatorMismatch:"Join operators within a condition must be the same",advancedFilterValidationInvalidJoinOperator:"Join operator not found",advancedFilterValidationMissingEndBracket:"Missing end bracket",advancedFilterValidationExtraEndBracket:"Too many end brackets",advancedFilterValidationMessage:t=>`Expression has an error. ${t[0]} - ${t[1]}.`,advancedFilterValidationMessageAtEnd:t=>`Expression has an error. ${t[0]} at end of expression.`,advancedFilterBuilderTitle:"Advanced Filter",advancedFilterBuilderApply:"Apply",advancedFilterBuilderCancel:"Cancel",advancedFilterBuilderAddButtonTooltip:"Add Filter or Group",advancedFilterBuilderRemoveButtonTooltip:"Remove",advancedFilterBuilderMoveUpButtonTooltip:"Move Up",advancedFilterBuilderMoveDownButtonTooltip:"Move Down",advancedFilterBuilderAddJoin:"Add Group",advancedFilterBuilderAddCondition:"Add Filter",advancedFilterBuilderSelectColumn:"Select a column",advancedFilterBuilderSelectOption:"Select an option",advancedFilterBuilderEnterValue:"Enter a value...",advancedFilterBuilderValidationAlreadyApplied:"Current filter already applied.",advancedFilterBuilderValidationIncomplete:"Not all conditions are complete.",advancedFilterBuilderValidationSelectColumn:"Must select a column.",advancedFilterBuilderValidationSelectOption:"Must select an option.",advancedFilterBuilderValidationEnterValue:"Must enter a value."};function _t(t,e,s){if(!t)return"";const i=s-e;return i?t.slice(0,t.length-i):t}function le(t,e,s,i,r,o,n){const a=s+(!t.length||n?0:1);let l=0;return r&&(t[a]===" "?l=1:(i+=" ",o&&(i+='"'))),{updatedValue:t.slice(0,e)+i+t.slice(a),updatedPosition:e+i.length+l}}function Ji(t,e,s){let i=e;for(;i<s&&t[i]===" ";)i++;return i}function Vt(t,e,s,i){let r=e,o=!1;for(;r<t.length;){const n=t[r];if(n==="("){i&&t[r-1]===" "?o=!0:r=r-1;break}else if(n===" "||s&&n===")"){r=r-1;break}r++}return{endPosition:r,isEmpty:o}}function zt(t,e,s,i){s!==e&&(t.expression=le(t.expression,i-e.length+1,i,s).updatedValue)}function Xi(t){return t.replace(/(['"])/,"\\$1")}var Qi=class{constructor(t,e){this.params=t,this.startPosition=e,this.type="column",this.valid=!0,this.hasStartChar=!1,this.hasEndChar=!1,this.colName=""}parse(t,e){if(t===ie.COL_START_CHAR&&!this.colName)this.hasStartChar=!0;else if(t===ie.COL_END_CHAR&&this.hasStartChar){if(this.parseColumn(!1,e))return this.hasEndChar=!0,!1;this.colName+=t}else this.colName+=t}getDisplayValue(){return(this.hasStartChar?ie.COL_START_CHAR:"")+this.colName+(this.hasEndChar?ie.COL_END_CHAR:"")}getColId(){return this.colId}complete(t){this.parseColumn(!0,t)}getValidationError(){var t;return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidColumn"),startPosition:this.startPosition,endPosition:(t=this.endPosition)!=null?t:this.params.expression.length-1}}parseColumn(t,e){var s;this.endPosition=e;const i=this.params.advancedFilterExpressionService.getColId(this.colName);return i&&this.hasStartChar&&(this.colId=i.colId,zt(this.params,this.colName,i.columnName,e-1),this.colName=i.columnName,this.column=this.params.columnModel.getPrimaryColumn(this.colId),this.column)?(this.baseCellDataType=(s=this.params.dataTypeService.getBaseDataType(this.column))!=null?s:"text",!0):(t&&(this.valid=!1),this.baseCellDataType="text",!1)}},er=class{constructor(t,e,s){this.params=t,this.startPosition=e,this.baseCellDataType=s,this.type="operator",this.valid=!0,this.expectedNumOperands=0,this.operator=""}parse(t,e){if(t===" "||t===")"){if(this.parseOperator(!1,e-1))return!0;this.operator+=t}else this.operator+=t}complete(t){this.parseOperator(!0,t)}getValidationError(){var t;return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidOption"),startPosition:this.startPosition,endPosition:(t=this.endPosition)!=null?t:this.params.expression.length-1}}getDisplayValue(){return this.operator}getOperatorKey(){return this.parsedOperator}parseOperator(t,e){const s=this.params.advancedFilterExpressionService.getDataTypeExpressionOperator(this.baseCellDataType),i=s.findOperator(this.operator);if(this.endPosition=e,i){this.parsedOperator=i;const o=s.operators[i];this.expectedNumOperands=o.numOperands;const n=o.displayValue;return zt(this.params,this.operator,n,e),this.operator=n,!0}return(t||!(i===null))&&(this.valid=!1),!1}},tr=class{constructor(t,e,s,i){this.params=t,this.startPosition=e,this.baseCellDataType=s,this.column=i,this.type="operand",this.valid=!0,this.operand="",this.validationMessage=null}parse(t,e){if(t===" ")if(this.quotes)this.operand+=t;else return this.parseOperand(!1,e),!0;else if(t===")"){if(this.baseCellDataType==="number"||!this.quotes)return this.parseOperand(!1,e-1),!0;this.operand+=t}else if(!this.operand&&!this.quotes&&(t==="'"||t==='"'))this.quotes=t;else{if(this.quotes&&t===this.quotes)return this.parseOperand(!1,e),!1;this.operand+=t}}complete(t){this.parseOperand(!0,t)}getValidationError(){var t;return this.validationMessage?{message:this.validationMessage,startPosition:this.startPosition,endPosition:(t=this.endPosition)!=null?t:this.params.expression.length-1}:null}getRawValue(){return this.operand}getModelValue(){return this.modelValue}parseOperand(t,e){const{advancedFilterExpressionService:s}=this.params;if(this.endPosition=e,this.modelValue=this.operand,t&&this.quotes)this.valid=!1,this.validationMessage=s.translate("advancedFilterValidationMissingQuote");else if(this.modelValue==="")this.valid=!1,this.validationMessage=s.translate("advancedFilterValidationMissingValue");else{const i=s.getOperandModelValue(this.operand,this.baseCellDataType,this.column);switch(i!=null&&(this.modelValue=i),this.baseCellDataType){case"number":(this.quotes||isNaN(this.modelValue))&&(this.valid=!1,this.validationMessage=s.translate("advancedFilterValidationNotANumber"));break;case"date":case"dateString":i==null&&(this.valid=!1,this.validationMessage=s.translate("advancedFilterValidationInvalidDate"));break}}}},ie=class{constructor(t,e){this.params=t,this.startPosition=e,this.isAwaiting=!0}parseExpression(){var t,e;let s=this.startPosition;const{expression:i}=this.params;for(;s<i.length;){const r=i[s];if(!(r===" "&&this.isAwaiting)){if(this.isAwaiting=!1,!this.parser){let n;this.columnParser?this.operatorParser?(this.operandParser=new tr(this.params,s,this.columnParser.baseCellDataType,this.columnParser.column),n=this.operandParser):(this.operatorParser=new er(this.params,s,this.columnParser.baseCellDataType),n=this.operatorParser):(this.columnParser=new Qi(this.params,s),n=this.columnParser),this.parser=n}const o=this.parser.parse(r,s);if(o!=null){if(this.isComplete())return this.returnEndPosition(o?s-1:s,!0);this.parser=void 0,this.isAwaiting=!0}}s++}return(e=(t=this.parser)==null?void 0:t.complete)==null||e.call(t,s-1),this.returnEndPosition(s)}isValid(){return this.isComplete()&&this.columnParser.valid&&this.operatorParser.valid&&(!this.operandParser||this.operandParser.valid)}getValidationError(){var t,e,s,i,r;const o=(r=(s=(t=this.columnParser)==null?void 0:t.getValidationError())!=null?s:(e=this.operatorParser)==null?void 0:e.getValidationError())!=null?r:(i=this.operandParser)==null?void 0:i.getValidationError();if(o)return o;const n=this.params.expression.length;let a;return this.columnParser?this.operatorParser?this.operatorParser.expectedNumOperands&&!this.operandParser&&(a="advancedFilterValidationMissingValue"):a="advancedFilterValidationMissingOption":a="advancedFilterValidationMissingColumn",a?{message:this.params.advancedFilterExpressionService.translate(a),startPosition:n,endPosition:n}:null}getFunctionString(t){return this.getFunctionCommon(t,(e,s,i,r)=>{const o=Xi(i),n=e==null?"":`, params.operands[${e}]`;return`params.operators[${s}].evaluator(expressionProxy.getValue('${o}', node), node, params.evaluatorParams[${r}]${n})`})}getFunctionParsed(t){return this.getFunctionCommon(t,(e,s,i,r)=>(o,n,a)=>a.operators[s].evaluator(o.getValue(i,n),n,a.evaluatorParams[r],e==null?void 0:a.operands[e]))}getAutocompleteListParams(t){if(this.isColumnPosition(t))return this.getColumnAutocompleteListParams(t);if(this.isOperatorPosition(t))return this.getOperatorAutocompleteListParams(t);if(!this.isBeyondEndPosition(t))return{enabled:!1}}updateExpression(t,e,s){var i,r,o,n,a;const{expression:l}=this.params;if(this.isColumnPosition(t))return le(this.params.expression,this.startPosition,(i=this.columnParser)!=null&&i.getColId()?this.columnParser.endPosition:Vt(l,t).endPosition,this.params.advancedFilterExpressionService.getColumnValue(e),!0);if(this.isOperatorPosition(t)){const u=this.getBaseCellDataTypeFromOperatorAutocompleteType(s),c=this.hasOperand(u,e.key),h=c&&this.doesOperandNeedQuotes(u);let g;if(((r=this.operatorParser)==null?void 0:r.startPosition)!=null&&t<this.operatorParser.startPosition)g=le(l,t,t,(o=e.displayValue)!=null?o:e.key,c,h);else{let m,y=!1;if((n=this.operatorParser)!=null&&n.getOperatorKey())m=this.operatorParser.endPosition;else{const{endPosition:P,isEmpty:w}=Vt(l,t,!0,!0);m=P,y=w}g=le(l,Ji(l,this.columnParser.endPosition+1,m),m,(a=e.displayValue)!=null?a:e.key,c,h,y)}return Wt(Kt({},g),{hideAutocomplete:!c})}return null}getModel(){const t=this.columnParser.getColId(),e={filterType:this.columnParser.baseCellDataType,colId:t,type:this.operatorParser.getOperatorKey()};return this.operatorParser.expectedNumOperands&&(e.filter=this.operandParser.getModelValue()),e}getFunctionCommon(t,e){var s,i;const r=this.columnParser.getColId(),o=(s=this.operatorParser)==null?void 0:s.getOperatorKey(),{operators:n,evaluatorParams:a,operands:l}=t,u=this.params.advancedFilterExpressionService.getExpressionOperator(this.columnParser.baseCellDataType,o),c=this.addToListAndGetIndex(n,u),h=this.params.advancedFilterExpressionService.getExpressionEvaluatorParams(r),g=this.addToListAndGetIndex(a,h),m=((i=this.operatorParser)==null?void 0:i.expectedNumOperands)===0?void 0:this.addToListAndGetIndex(l,this.getOperandValue());return e(m,c,r,g)}getOperandValue(){let t=this.operandParser.getRawValue();const{baseCellDataType:e,column:s}=this.columnParser;switch(e){case"number":t=Number(t);break;case"date":case"dateString":t=this.params.valueService.parseValue(s,null,t,void 0);break}return e==="dateString"?this.params.dataTypeService.getDateParserFunction(s)(t):t}isComplete(){return!!(this.operatorParser&&(!this.operatorParser.expectedNumOperands||this.operatorParser.expectedNumOperands&&this.operandParser))}isColumnPosition(t){return!this.columnParser||this.columnParser.endPosition==null||t<=this.columnParser.endPosition+1}isOperatorPosition(t){return!this.operatorParser||this.operatorParser.endPosition==null||t<=this.operatorParser.endPosition+1}isBeyondEndPosition(t){return this.isComplete()&&this.endPosition!=null&&t>this.endPosition+1&&this.endPosition+1<this.params.expression.length}returnEndPosition(t,e){return this.endPosition=e?t:t-1,t}getColumnAutocompleteListParams(t){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column",this.getColumnSearchString(t))}getColumnSearchString(t){var e,s,i,r,o;const n=(s=(e=this.columnParser)==null?void 0:e.getDisplayValue())!=null?s:"",a=_t(n,t,((i=this.columnParser)==null?void 0:i.endPosition)==null?this.params.expression.length:this.columnParser.endPosition+1),l=((r=this.columnParser)==null?void 0:r.hasStartChar)&&a.length>0,u=((o=this.columnParser)==null?void 0:o.hasEndChar)&&a.length===n.length+2;return l?a.slice(1,u?-1:void 0):a}getOperatorAutocompleteListParams(t){var e,s,i,r,o;const n=(e=this.columnParser)==null?void 0:e.column;if(!n)return{enabled:!1};const a=this.columnParser.baseCellDataType,l=((s=this.operatorParser)==null?void 0:s.startPosition)!=null&&t<this.operatorParser.startPosition?"":_t((r=(i=this.operatorParser)==null?void 0:i.getDisplayValue())!=null?r:"",t,((o=this.operatorParser)==null?void 0:o.endPosition)==null?this.params.expression.length:this.operatorParser.endPosition+1);return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getOperatorAutocompleteEntries(n,a),`operator-${a}`,l)}getBaseCellDataTypeFromOperatorAutocompleteType(t){return t==null?void 0:t.replace("operator-","")}hasOperand(t,e){var s,i;return!t||!e||((i=(s=this.params.advancedFilterExpressionService.getExpressionOperator(t,e))==null?void 0:s.numOperands)!=null?i:0)>0}doesOperandNeedQuotes(t){return t!=="number"}addToListAndGetIndex(t,e){const s=t.length;return t.push(e),s}};ie.COL_START_CHAR="[";ie.COL_END_CHAR="]";function mt(t,e,s){let i=!1;const r=t.toLocaleLowerCase(),o=r+" ",n=Object.entries(e).find(([a,l])=>{const u=s(l).toLocaleLowerCase();return u.startsWith(o)&&(i=!0),u===r});return n?n[0]:i?null:void 0}function qt(t,e){return(e!=null?e:Object.keys(t)).map(i=>({key:i,displayValue:t[i].displayValue}))}var ls=class{constructor(t){this.params=t,this.initOperators()}getEntries(t){return qt(this.operators,t)}findOperator(t){return mt(t,this.operators,({displayValue:e})=>e)}initOperators(){const{translate:t}=this.params;this.operators={contains:{displayValue:t("advancedFilterContains"),evaluator:(e,s,i,r)=>this.evaluateExpression(e,s,i,r,!1,(o,n)=>o.includes(n)),numOperands:1},notContains:{displayValue:t("advancedFilterNotContains"),evaluator:(e,s,i,r)=>this.evaluateExpression(e,s,i,r,!0,(o,n)=>!o.includes(n)),numOperands:1},equals:{displayValue:t("advancedFilterTextEquals"),evaluator:(e,s,i,r)=>this.evaluateExpression(e,s,i,r,!1,(o,n)=>o===n),numOperands:1},notEqual:{displayValue:t("advancedFilterTextNotEqual"),evaluator:(e,s,i,r)=>this.evaluateExpression(e,s,i,r,!0,(o,n)=>o!=n),numOperands:1},startsWith:{displayValue:t("advancedFilterStartsWith"),evaluator:(e,s,i,r)=>this.evaluateExpression(e,s,i,r,!1,(o,n)=>o.startsWith(n)),numOperands:1},endsWith:{displayValue:t("advancedFilterEndsWith"),evaluator:(e,s,i,r)=>this.evaluateExpression(e,s,i,r,!1,(o,n)=>o.endsWith(n)),numOperands:1},blank:{displayValue:t("advancedFilterBlank"),evaluator:e=>e==null||typeof e=="string"&&e.trim().length===0,numOperands:0},notBlank:{displayValue:t("advancedFilterNotBlank"),evaluator:e=>e!=null&&(typeof e!="string"||e.trim().length>0),numOperands:0}}}evaluateExpression(t,e,s,i,r,o){return t==null?r:s.caseSensitive?o(s.valueConverter(t,e),i):o(s.valueConverter(t,e).toLocaleLowerCase(),i.toLocaleLowerCase())}},Tt=class{constructor(t){this.params=t,this.initOperators()}getEntries(t){return qt(this.operators,t)}findOperator(t){return mt(t,this.operators,({displayValue:e})=>e)}initOperators(){const{translate:t,equals:e}=this.params;this.operators={equals:{displayValue:t("advancedFilterEquals"),evaluator:(s,i,r,o)=>this.evaluateSingleOperandExpression(s,i,r,o,!!r.includeBlanksInEquals,e),numOperands:1},notEqual:{displayValue:t("advancedFilterNotEqual"),evaluator:(s,i,r,o)=>this.evaluateSingleOperandExpression(s,i,r,o,!!r.includeBlanksInEquals,(n,a)=>!e(n,a)),numOperands:1},greaterThan:{displayValue:t("advancedFilterGreaterThan"),evaluator:(s,i,r,o)=>this.evaluateSingleOperandExpression(s,i,r,o,!!r.includeBlanksInGreaterThan,(n,a)=>n>a),numOperands:1},greaterThanOrEqual:{displayValue:t("advancedFilterGreaterThanOrEqual"),evaluator:(s,i,r,o)=>this.evaluateSingleOperandExpression(s,i,r,o,!!r.includeBlanksInGreaterThan,(n,a)=>n>=a),numOperands:1},lessThan:{displayValue:t("advancedFilterLessThan"),evaluator:(s,i,r,o)=>this.evaluateSingleOperandExpression(s,i,r,o,!!r.includeBlanksInLessThan,(n,a)=>n<a),numOperands:1},lessThanOrEqual:{displayValue:t("advancedFilterLessThanOrEqual"),evaluator:(s,i,r,o)=>this.evaluateSingleOperandExpression(s,i,r,o,!!r.includeBlanksInLessThan,(n,a)=>n<=a),numOperands:1},blank:{displayValue:t("advancedFilterBlank"),evaluator:s=>s==null,numOperands:0},notBlank:{displayValue:t("advancedFilterNotBlank"),evaluator:s=>s!=null,numOperands:0}}}evaluateSingleOperandExpression(t,e,s,i,r,o){return t==null?r:o(s.valueConverter(t,e),i)}},sr=class{constructor(t){this.params=t,this.initOperators()}getEntries(t){return qt(this.operators,t)}findOperator(t){return mt(t,this.operators,({displayValue:e})=>e)}initOperators(){const{translate:t}=this.params;this.operators={true:{displayValue:t("advancedFilterTrue"),evaluator:e=>!!e,numOperands:0},false:{displayValue:t("advancedFilterFalse"),evaluator:e=>e===!1,numOperands:0},blank:{displayValue:t("advancedFilterBlank"),evaluator:e=>e==null,numOperands:0},notBlank:{displayValue:t("advancedFilterNotBlank"),evaluator:e=>e!=null,numOperands:0}}}},ye=class extends T{constructor(){super(...arguments),this.columnNameToIdMap={},this.columnAutocompleteEntries=null,this.expressionEvaluatorParams={}}postConstruct(){this.expressionJoinOperators=this.generateExpressionJoinOperators(),this.expressionOperators=this.generateExpressionOperators()}parseJoinOperator(t){var e;const{type:s}=t;return(e=this.expressionJoinOperators[s])!=null?e:s}getColumnDisplayValue(t){const{colId:e}=t,i=this.getColumnAutocompleteEntries().find(({key:o})=>o===e);let r;return i?(r=i.displayValue,this.columnNameToIdMap[r.toLocaleUpperCase()]={colId:e,columnName:r}):r=e,r}getOperatorDisplayValue(t){var e,s;return(s=(e=this.getExpressionOperator(t.filterType,t.type))==null?void 0:e.displayValue)!=null?s:t.type}getOperandModelValue(t,e,s){var i;switch(e){case"number":return d.exists(t)?Number(t):null;case"date":return d.serialiseDate(this.valueService.parseValue(s,null,t,void 0),!1);case"dateString":const r=this.valueService.parseValue(s,null,t,void 0);return d.serialiseDate((i=this.dataTypeService.getDateParserFunction(s)(r))!=null?i:null,!1)}return t}getOperandDisplayValue(t,e){var s,i;const{colId:r,filter:o}=t,n=this.columnModel.getPrimaryColumn(r);let a="";if(o!=null){let l;switch(t.filterType){case"number":l=(s=d.toStringOrNull(o))!=null?s:"";break;case"date":const u=d.parseDateTimeFromString(o);l=n?this.valueService.formatValue(n,null,u):null;break;case"dateString":const c=d.parseDateTimeFromString(o),h=n?this.dataTypeService.getDateFormatterFunction(n)(c!=null?c:void 0):null;l=n?this.valueService.formatValue(n,null,h):null;break}t.filterType!=="number"&&(l=(i=l!=null?l:d.toStringOrNull(o))!=null?i:"",e||(l=`"${l}"`)),a=e?l:` ${l}`}return a}parseColumnFilterModel(t){var e,s;const i=(e=this.getColumnDisplayValue(t))!=null?e:"",r=(s=this.getOperatorDisplayValue(t))!=null?s:"",o=this.getOperandDisplayValue(t);return`[${i}] ${r}${o}`}updateAutocompleteCache(t,e){if(e==="column"){const{key:s,displayValue:i}=t;this.columnNameToIdMap[t.displayValue.toLocaleUpperCase()]={colId:s,columnName:i}}}translate(t,e){let s=Yi[t];return typeof s=="function"&&(s=s(e)),this.localeService.getLocaleTextFunc()(t,s,e)}generateAutocompleteListParams(t,e,s){return{enabled:!0,type:e,searchString:s,entries:t}}getColumnAutocompleteEntries(){var t;if(this.columnAutocompleteEntries)return this.columnAutocompleteEntries;const e=(t=this.columnModel.getAllPrimaryColumns())!=null?t:[],s=[],i=this.gos.get("includeHiddenColumnsInAdvancedFilter");return e.forEach(r=>{r.getColDef().filter&&(i||r.isVisible()||r.isRowGroupActive())&&s.push({key:r.getColId(),displayValue:this.columnModel.getDisplayNameForColumn(r,"advancedFilter")})}),s.sort((r,o)=>{var n,a;const l=(n=r.displayValue)!=null?n:"",u=(a=o.displayValue)!=null?a:"";return l<u?-1:u>l?1:0}),s}getOperatorAutocompleteEntries(t,e){const s=this.getActiveOperators(t);return this.getDataTypeExpressionOperator(e).getEntries(s)}getJoinOperatorAutocompleteEntries(){return Object.entries(this.expressionJoinOperators).map(([t,e])=>({key:t,displayValue:e}))}getDefaultAutocompleteListParams(t){return this.generateAutocompleteListParams(this.getColumnAutocompleteEntries(),"column",t)}getDataTypeExpressionOperator(t){return this.expressionOperators[t]}getExpressionOperator(t,e){var s,i;return(i=(s=this.getDataTypeExpressionOperator(t))==null?void 0:s.operators)==null?void 0:i[e]}getExpressionJoinOperators(){return this.expressionJoinOperators}getColId(t){const e=t.toLocaleUpperCase(),s=this.columnNameToIdMap[e];if(s)return s;const r=this.getColumnAutocompleteEntries().find(({displayValue:o})=>o.toLocaleUpperCase()===e);if(r){const{key:o,displayValue:n}=r,a={colId:o,columnName:n};return this.columnNameToIdMap[e]=a,a}return null}getExpressionEvaluatorParams(t){let e=this.expressionEvaluatorParams[t];if(e)return e;const s=this.columnModel.getPrimaryColumn(t);if(!s)return{valueConverter:o=>o};switch(this.dataTypeService.getBaseDataType(s)){case"dateString":e={valueConverter:this.dataTypeService.getDateParserFunction(s)};break;case"object":s.getColDef().filterValueGetter?e={valueConverter:o=>o}:e={valueConverter:(o,n)=>{var a;return(a=this.valueService.formatValue(s,n,o))!=null?a:typeof o.toString=="function"?o.toString():""}};break;case"text":case void 0:e={valueConverter:o=>d.toStringOrNull(o)};break;default:e={valueConverter:o=>o};break}const{filterParams:r}=s.getColDef();return r&&["caseSensitive","includeBlanksInEquals","includeBlanksInLessThan","includeBlanksInGreaterThan"].forEach(o=>{const n=r[o];n&&(e[o]=n)}),this.expressionEvaluatorParams[t]=e,e}getColumnDetails(t){var e,s;const i=(e=this.columnModel.getPrimaryColumn(t))!=null?e:void 0,r=(s=i?this.dataTypeService.getBaseDataType(i):void 0)!=null?s:"text";return{column:i,baseCellDataType:r}}generateExpressionOperators(){const t=(e,s)=>this.translate(e,s);return{text:new ls({translate:t}),boolean:new sr({translate:t}),object:new ls({translate:t}),number:new Tt({translate:t,equals:(e,s)=>e===s}),date:new Tt({translate:t,equals:(e,s)=>e.getTime()===s.getTime()}),dateString:new Tt({translate:t,equals:(e,s)=>e.getTime()===s.getTime()})}}getColumnValue({displayValue:t}){return`${ie.COL_START_CHAR}${t}${ie.COL_END_CHAR}`}generateExpressionJoinOperators(){return{AND:this.translate("advancedFilterAnd"),OR:this.translate("advancedFilterOr")}}getActiveOperators(t){var e;const s=(e=t.getColDef().filterParams)==null?void 0:e.filterOptions;return s&&s.every(r=>typeof r=="string")?s:void 0}resetColumnCaches(){this.columnAutocompleteEntries=null,this.columnNameToIdMap={},this.expressionEvaluatorParams={}}};v([p("valueService")],ye.prototype,"valueService",2);v([p("columnModel")],ye.prototype,"columnModel",2);v([p("dataTypeService")],ye.prototype,"dataTypeService",2);v([b],ye.prototype,"postConstruct",1);ye=v([G("advancedFilterExpressionService")],ye);var ir=class{constructor(t){this.params=t,this.operators=[],this.operatorStartPositions=[],this.operatorEndPositions=[],this.activeOperator=0,this.validationError=null}parseExpression(t){this.operators.push(""),this.operatorStartPositions.push(t),this.operatorEndPositions.push(void 0);const{expression:e}=this.params;for(;t<e.length;){const s=e[t];if(s===" "){if(this.parseOperator(t-1))return this.activeOperator++,t-1;this.operators[this.activeOperator]+=s}else this.operators[this.activeOperator]+=s;t++}return this.parseOperator(t-1),t}isValid(){return!this.validationError&&(!this.operators.length||!!this.parsedOperator)}getValidationError(){return this.validationError}getFunction(){return this.parsedOperator==="OR"?"||":"&&"}getModel(){return this.parsedOperator==="OR"?"OR":"AND"}getAutocompleteListParams(t,e){let s;if(e==null)s="";else{const r=this.operators[e],o=this.operatorEndPositions[e];s=_t(r,t,o==null?this.params.expression.length:o+1)}let i=this.params.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries();return(e||e==null&&this.activeOperator)&&(i=i.filter(({key:r})=>r===this.parsedOperator)),this.params.advancedFilterExpressionService.generateAutocompleteListParams(i,"join",s)}updateExpression(t,e,s){var i,r;let{expression:o}=this.params;const n=(i=e.displayValue)!=null?i:e.key;if(s===0)for(let u=this.operatorEndPositions.length-1;u>0;u--){const c=this.operatorEndPositions[u];c!=null&&(o=le(o,this.operatorStartPositions[u],c,n).updatedValue)}const a=this.operatorStartPositions.length>s?this.operatorStartPositions[s]:t,l=(r=this.operatorEndPositions.length>s?this.operatorEndPositions[s]:void 0)!=null?r:Vt(o,t,!0).endPosition;return le(o,a,l,n,!0)}getNumOperators(){return this.operators.length}getLastOperatorEndPosition(){return this.operatorEndPositions[this.operatorEndPositions.length-1]}parseOperator(t){const e=this.operators.length>this.activeOperator?this.operators[this.activeOperator]:"",s=this.params.advancedFilterExpressionService.getExpressionJoinOperators(),i=mt(e,s,r=>r);if(i){this.operatorEndPositions[this.activeOperator]=t;const r=s[i];if(this.activeOperator){if(i!==this.parsedOperator)return this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationJoinOperatorMismatch"),startPosition:t-e.length+1,endPosition:t}),!1}else this.parsedOperator=i;return e!==r&&(zt(this.params,e,r,t),this.operators[this.activeOperator]=r),!0}else return i===null?!1:(this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidJoinOperator"),startPosition:t-e.length+1,endPosition:t}),!0)}},rr=class Rs{constructor(e,s){this.params=e,this.startPosition=s,this.expectingExpression=!0,this.expectingOperator=!1,this.expressionParsers=[],this.operatorParser=new ir(this.params),this.missingEndBracket=!1,this.extraEndBracket=!1}parseExpression(){let e=this.startPosition;const{expression:s}=this.params;for(;e<s.length;){const i=s[e];if(i==="("&&!this.expectingOperator){const r=new Rs(this.params,e+1);e=r.parseExpression(),this.expressionParsers.push(r),this.expectingExpression=!1,this.expectingOperator=!0}else{if(i===")")return this.endPosition=e-1,this.startPosition===0&&(this.extraEndBracket=!0),e;if(i!==" ")if(this.expectingExpression){const r=new ie(this.params,e);e=r.parseExpression(),this.expressionParsers.push(r),this.expectingExpression=!1,this.expectingOperator=!0}else this.expectingOperator&&(e=this.operatorParser.parseExpression(e),this.expectingOperator=!1,this.expectingExpression=!0)}e++}return this.startPosition>0&&(this.missingEndBracket=!0),e}isValid(){return!this.missingEndBracket&&!this.extraEndBracket&&this.expressionParsers.length===this.operatorParser.getNumOperators()+1&&this.operatorParser.isValid()&&this.expressionParsers.every(e=>e.isValid())}getValidationError(){const e=this.operatorParser.getValidationError();for(let i=0;i<this.expressionParsers.length;i++){const r=this.expressionParsers[i].getValidationError();if(r)return e&&e.startPosition<r.startPosition?e:r}if(e)return e;if(this.extraEndBracket)return{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationExtraEndBracket"),startPosition:this.endPosition+1,endPosition:this.endPosition+1};let s;return this.expressionParsers.length===this.operatorParser.getNumOperators()?s="advancedFilterValidationMissingCondition":this.missingEndBracket&&(s="advancedFilterValidationMissingEndBracket"),s?{message:this.params.advancedFilterExpressionService.translate(s),startPosition:this.params.expression.length,endPosition:this.params.expression.length}:null}getFunctionString(e){const s=this.expressionParsers.length>1,i=this.expressionParsers.map(r=>r.getFunctionString(e)).join(` ${this.operatorParser.getFunction()} `);return s?`(${i})`:i}getFunctionParsed(e){const s=this.operatorParser.getFunction(),i=this.expressionParsers.map(o=>o.getFunctionParsed(e)),r=s==="&&"?"every":"some";return(o,n,a)=>i[r](l=>l(o,n,a))}getAutocompleteListParams(e){if(this.endPosition!=null&&e>this.endPosition+1)return;if(!this.expressionParsers.length)return this.getColumnAutocompleteListParams();const s=this.getExpressionParserIndex(e);if(s==null)return this.params.expression[e]==="("?{enabled:!1}:this.getColumnAutocompleteListParams();const r=this.expressionParsers[s].getAutocompleteListParams(e);if(!r){if(s<this.expressionParsers.length-1)return this.operatorParser.getAutocompleteListParams(e,s);if(this.expressionParsers.length===this.operatorParser.getNumOperators()){const o=this.operatorParser.getLastOperatorEndPosition();return o==null||e<=o+1?this.operatorParser.getAutocompleteListParams(e,this.operatorParser.getNumOperators()-1):this.getColumnAutocompleteListParams()}return this.params.expression[e-1]===")"?{enabled:!1}:this.operatorParser.getAutocompleteListParams(e)}return r}updateExpression(e,s,i){var r;const o=this.params.expression,n=this.getExpressionParserIndex(e);if(n==null){const u=i==="column"?this.params.advancedFilterExpressionService.getColumnValue(s):(r=s.displayValue)!=null?r:s.key;return le(o,this.startPosition,this.startPosition,u,!0)}const l=this.expressionParsers[n].updateExpression(e,s,i);return l==null?i==="column"?le(o,e,o.length-1,this.params.advancedFilterExpressionService.getColumnValue(s),!0):this.endPosition!=null&&e>this.endPosition+1?null:this.operatorParser.updateExpression(e,s,n):l}getModel(){return this.expressionParsers.length>1?{filterType:"join",type:this.operatorParser.getModel(),conditions:this.expressionParsers.map(e=>e.getModel())}:this.expressionParsers[0].getModel()}getColumnAutocompleteListParams(){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column","")}getExpressionParserIndex(e){let s;for(let i=0;i<this.expressionParsers.length&&!(this.expressionParsers[i].startPosition>e);i++)s=i;return s}},or=class{constructor(t){this.params=t,this.valid=!1}parseExpression(){this.joinExpressionParser=new rr(this.params,0);const t=this.joinExpressionParser.parseExpression();return this.valid=t>=this.params.expression.length-1&&this.joinExpressionParser.isValid(),this.params.expression}isValid(){return this.valid}getValidationMessage(){const t=this.joinExpressionParser.getValidationError();if(!t)return null;const{message:e,startPosition:s,endPosition:i}=t;return s<this.params.expression.length?this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessage",[e,this.params.expression.slice(s,i+1).trim()]):this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessageAtEnd",[e])}getFunctionString(){const t=this.createFunctionParams();return{functionString:`return ${this.joinExpressionParser.getFunctionString(t)};`,params:t}}getFunctionParsed(){const t=this.createFunctionParams();return{expressionFunction:this.joinExpressionParser.getFunctionParsed(t),params:t}}getAutocompleteListParams(t){var e;return(e=this.joinExpressionParser.getAutocompleteListParams(t))!=null?e:{enabled:!1}}updateExpression(t,e,s){return this.joinExpressionParser.updateExpression(t,e,s)}getModel(){return this.isValid()?this.joinExpressionParser.getModel():null}createFunctionParams(){return{operands:[],operators:[],evaluatorParams:[]}}},re=class extends T{constructor(){super(...arguments),this.appliedExpression=null,this.expression=null,this.isValid=!0}postConstruct(){this.setEnabled(this.gos.get("enableAdvancedFilter"),!0),this.ctrl=this.createManagedBean(new Os(this.enabled)),this.expressionProxy={getValue:(t,e)=>{const s=this.columnModel.getPrimaryColumn(t);return s?this.valueService.getValue(s,e,!0):void 0}},this.addManagedPropertyListener("enableAdvancedFilter",t=>this.setEnabled(!!t.currentValue)),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,t=>this.onNewColumnsLoaded(t)),this.addManagedPropertyListener("includeHiddenColumnsInAdvancedFilter",()=>this.updateValidity())}isEnabled(){return this.enabled}isFilterPresent(){return!!this.expressionFunction}doesFilterPass(t){return this.expressionFunction(this.expressionProxy,t,this.expressionParams)}getModel(){var t;const e=this.createExpressionParser(this.appliedExpression);return e==null||e.parseExpression(),(t=e==null?void 0:e.getModel())!=null?t:null}setModel(t){const e=(i,r)=>{if(i.filterType==="join"){const o=this.advancedFilterExpressionService.parseJoinOperator(i),n=i.conditions.map(a=>e(a)).filter(a=>d.exists(a)).join(` ${o} `);return r||i.conditions.length<=1?n:`(${n})`}else return this.advancedFilterExpressionService.parseColumnFilterModel(i)},s=t?e(t,!0):null;this.setExpressionDisplayValue(s),this.applyExpression(),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp()}getExpressionDisplayValue(){return this.expression}setExpressionDisplayValue(t){this.expression=t}isCurrentExpressionApplied(){return this.appliedExpression===this.expression}createExpressionParser(t){return t?new or({expression:t,columnModel:this.columnModel,dataTypeService:this.dataTypeService,valueService:this.valueService,advancedFilterExpressionService:this.advancedFilterExpressionService}):null}getDefaultExpression(t){const e=this.advancedFilterExpressionService.getColumnValue(t)+" ";return{updatedValue:e,updatedPosition:e.length}}isHeaderActive(){return!this.gos.get("advancedFilterParent")}getCtrl(){return this.ctrl}setEnabled(t,e){const s=this.enabled,i=this.rowModel.getType(),r=i==="clientSide"||i==="serverSide";if(t&&!i&&d.warnOnce("Advanced Filter is only supported with the Client-Side Row Model or Server-Side Row Model."),this.enabled=t&&r,!e&&this.enabled!==s){const o={type:f.EVENT_ADVANCED_FILTER_ENABLED_CHANGED,enabled:this.enabled};this.eventService.dispatchEvent(o)}}applyExpression(){const t=this.createExpressionParser(this.expression);t==null||t.parseExpression(),this.applyExpressionFromParser(t)}applyExpressionFromParser(t){if(this.isValid=!t||t.isValid(),!t||!this.isValid){this.expressionFunction=null,this.expressionParams=null,this.appliedExpression=null;return}const{expressionFunction:e,params:s}=this.getFunction(t);this.expressionFunction=e,this.expressionParams=s,this.appliedExpression=this.expression}getFunction(t){if(this.gos.get("suppressAdvancedFilterEval"))return t.getFunctionParsed();{const{functionString:e,params:s}=t.getFunctionString();return{expressionFunction:new Function("expressionProxy","node","params",e),params:s}}}updateValidity(){this.advancedFilterExpressionService.resetColumnCaches();const t=this.createExpressionParser(this.expression);t==null||t.parseExpression();const s=(!t||t.isValid())!==this.isValid;return this.applyExpressionFromParser(t),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp(),s}onNewColumnsLoaded(t){if(t.source!=="gridInitializing"||!this.dataTypeService.isPendingInference())return;this.ctrl.setInputDisabled(!0);const e=this.addManagedListener(this.eventService,f.EVENT_DATA_TYPES_INFERRED,()=>{e==null||e(),this.ctrl.setInputDisabled(!1)})}};v([p("valueService")],re.prototype,"valueService",2);v([p("columnModel")],re.prototype,"columnModel",2);v([p("dataTypeService")],re.prototype,"dataTypeService",2);v([p("rowModel")],re.prototype,"rowModel",2);v([p("advancedFilterExpressionService")],re.prototype,"advancedFilterExpressionService",2);v([b],re.prototype,"postConstruct",1);re=v([G("advancedFilterService")],re);var nr="31.3.2",yo={version:nr,moduleName:x.AdvancedFilterModule,beans:[re,ye],agStackComponents:[{componentName:"agAdvancedFilter",componentClass:Y}],dependantModules:[_e]},ar=Object.defineProperty,lr=Object.getOwnPropertyDescriptor,D=(t,e,s,i)=>{for(var r=i>1?void 0:i?lr(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(r=(i?n(e,s,r):n(r))||r);return i&&r&&ar(e,s,r),r},Zt=class He{constructor(e,s,i,r,o,n){this.nextId=0,this.rowCountReady=!1,this.allNodesMap={},this.rootNode=e,this.gos=s,this.eventService=i,this.columnModel=r,this.beans=n,this.selectionService=o,this.rootNode.group=!0,this.rootNode.level=-1,this.rootNode.id=He.ROOT_NODE_ID,this.rootNode.allLeafChildren=[],this.rootNode.childrenAfterGroup=[],this.rootNode.childrenAfterSort=[],this.rootNode.childrenAfterAggFilter=[],this.rootNode.childrenAfterFilter=[]}getCopyOfNodesMap(){return d.cloneObject(this.allNodesMap)}getRowNode(e){return this.allNodesMap[e]}setRowData(e){if(typeof e=="string"){console.warn("AG Grid: rowData must be an array.");return}this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(e);const s=this.rootNode,i=this.rootNode.sibling;s.childrenAfterFilter=null,s.childrenAfterGroup=null,s.childrenAfterAggFilter=null,s.childrenAfterSort=null,s.childrenMapped=null,s.updateHasChildren(),this.nextId=0,this.allNodesMap={},e?s.allLeafChildren=e.map(r=>this.createNode(r,this.rootNode,He.TOP_LEVEL)):(s.allLeafChildren=[],s.childrenAfterGroup=[]),i&&(i.childrenAfterFilter=s.childrenAfterFilter,i.childrenAfterGroup=s.childrenAfterGroup,i.childrenAfterAggFilter=s.childrenAfterAggFilter,i.childrenAfterSort=s.childrenAfterSort,i.childrenMapped=s.childrenMapped,i.allLeafChildren=s.allLeafChildren)}updateRowData(e,s){this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(e.add);const i={remove:[],update:[],add:[]},r=[];return this.executeRemove(e,i,r),this.executeUpdate(e,i,r),this.executeAdd(e,i),this.updateSelection(r,"rowDataChanged"),s&&d.sortRowNodesByOrder(this.rootNode.allLeafChildren,s),i}isRowCountReady(){return this.rowCountReady}dispatchRowDataUpdateStartedEvent(e){const s={type:f.EVENT_ROW_DATA_UPDATE_STARTED,firstRowData:e!=null&&e.length?e[0]:null};this.eventService.dispatchEvent(s)}updateSelection(e,s){const i=e.length>0;if(i&&this.selectionService.setNodesSelected({newValue:!1,nodes:e,suppressFinishActions:!0,source:s}),this.selectionService.updateGroupsFromChildrenSelections(s),i){const r={type:f.EVENT_SELECTION_CHANGED,source:s};this.eventService.dispatchEvent(r)}}executeAdd(e,s){var i;const{add:r,addIndex:o}=e;if(d.missingOrEmpty(r))return;const n=r.map(a=>this.createNode(a,this.rootNode,He.TOP_LEVEL));if(typeof o=="number"&&o>=0){const{allLeafChildren:a}=this.rootNode,l=a.length;let u=o;if(this.gos.get("treeData")&&o>0&&l>0){for(let m=0;m<l;m++)if(((i=a[m])==null?void 0:i.rowIndex)==o-1){u=m+1;break}}const h=a.slice(0,u),g=a.slice(u,a.length);this.rootNode.allLeafChildren=[...h,...n,...g]}else this.rootNode.allLeafChildren=[...this.rootNode.allLeafChildren,...n];this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=this.rootNode.allLeafChildren),s.add=n}executeRemove(e,s,i){const{remove:r}=e;if(d.missingOrEmpty(r))return;const o={};r.forEach(n=>{const a=this.lookupRowNode(n);!a||(a.isSelected()&&i.push(a),a.clearRowTopAndRowIndex(),o[a.id]=!0,delete this.allNodesMap[a.id],s.remove.push(a))}),this.rootNode.allLeafChildren=this.rootNode.allLeafChildren.filter(n=>!o[n.id]),this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=this.rootNode.allLeafChildren)}executeUpdate(e,s,i){const{update:r}=e;d.missingOrEmpty(r)||r.forEach(o=>{const n=this.lookupRowNode(o);!n||(n.updateData(o),!n.selectable&&n.isSelected()&&i.push(n),this.setMasterForRow(n,o,He.TOP_LEVEL,!1),s.update.push(n))})}lookupRowNode(e){const s=this.gos.getCallback("getRowId");let i;if(s){const r=s({data:e,level:0});if(i=this.allNodesMap[r],!i)return console.error(`AG Grid: could not find row id=${r}, data item was not found for this id`),null}else if(i=this.rootNode.allLeafChildren.find(r=>r.data===e),!i)return console.error("AG Grid: could not find data item as object was not found",e),console.error("Consider using getRowId to help the Grid find matching row data"),null;return i||null}createNode(e,s,i){const r=new Le(this.beans);r.group=!1,this.setMasterForRow(r,e,i,!0);const o=this.gos.get("suppressParentsInRowNodes");return s&&!o&&(r.parent=s),r.level=i,r.setDataAndId(e,this.nextId.toString()),this.allNodesMap[r.id]&&console.warn(`AG Grid: duplicate node id '${r.id}' detected from getRowId callback, this could cause issues in your grid.`),this.allNodesMap[r.id]=r,this.nextId++,r}setMasterForRow(e,s,i,r){if(this.gos.get("treeData"))e.setMaster(!1),r&&(e.expanded=!1);else{if(this.gos.get("masterDetail")){const a=this.gos.get("isRowMaster");a?e.setMaster(a(s)):e.setMaster(!0)}else e.setMaster(!1);if(r){const a=this.columnModel.getRowGroupColumns(),l=a?a.length:0,u=i+l;e.expanded=e.master?this.isExpanded(u):!1}}}isExpanded(e){const s=this.gos.get("groupDefaultExpanded");return s===-1?!0:e<s}};Zt.TOP_LEVEL=0;Zt.ROOT_NODE_ID="ROOT_NODE_ID";var dr=Zt,K=class extends T{constructor(){super(...arguments),this.onRowHeightChanged_debounced=d.debounce(this.onRowHeightChanged.bind(this),100),this.rowsToDisplay=[],this.hasStarted=!1,this.shouldSkipSettingDataOnStart=!1,this.isRefreshingModel=!1,this.rowCountReady=!1}init(){const t=this.refreshModel.bind(this,{step:S.EVERYTHING}),e=!this.gos.get("suppressAnimationFrame"),s=this.refreshModel.bind(this,{step:S.EVERYTHING,afterColumnsChanged:!0,keepRenderedRows:!0,animate:e});this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,s),this.addManagedListener(this.eventService,f.EVENT_COLUMN_ROW_GROUP_CHANGED,t),this.addManagedListener(this.eventService,f.EVENT_COLUMN_VALUE_CHANGED,this.onValueChanged.bind(this)),this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_CHANGED,this.refreshModel.bind(this,{step:S.PIVOT})),this.addManagedListener(this.eventService,f.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,f.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_MODE_CHANGED,t),this.addManagedListener(this.eventService,f.EVENT_GRID_STYLES_CHANGED,this.onGridStylesChanges.bind(this)),this.addManagedListener(this.eventService,f.EVENT_GRID_READY,()=>this.onGridReady()),this.addPropertyListeners(),this.rootNode=new Le(this.beans),this.nodeManager=new dr(this.rootNode,this.gos,this.eventService,this.columnModel,this.selectionService,this.beans)}addPropertyListeners(){const t=new Set(["treeData","masterDetail"]),e=new Set(["suppressParentsInRowNodes","groupDefaultExpanded","groupAllowUnbalanced","initialGroupOrderComparator","groupHideOpenParents","groupDisplayType"]),s=new Set(["excludeChildrenWhenTreeDataFiltering"]),i=new Set(["removePivotHeaderRowWhenSingleValueColumn","pivotRowTotals","pivotColumnGroupTotals","suppressExpandablePivotGroups"]),r=new Set(["getGroupRowAgg","alwaysAggregateAtRootLevel","groupIncludeTotalFooter","suppressAggFilteredOnly","grandTotalRow"]),o=new Set(["postSortRows","groupDisplayType","accentedSort"]),n=new Set([]),a=new Set(["groupRemoveSingleChildren","groupRemoveLowestSingleChildren","groupIncludeFooter","groupTotalRow"]),l=[...t,...e,...s,...i,...i,...r,...o,...n,...a];this.addManagedPropertyListeners(l,u=>{var c;const h=(c=u.changeSet)==null?void 0:c.properties;if(!h)return;const g=m=>h.some(y=>m.has(y));if(g(t)){this.setRowData(this.rootNode.allLeafChildren.map(m=>m.data));return}if(g(e)){this.refreshModel({step:S.EVERYTHING});return}if(g(s)){this.refreshModel({step:S.FILTER});return}if(g(i)){this.refreshModel({step:S.PIVOT});return}if(g(r)){this.refreshModel({step:S.AGGREGATE});return}if(g(o)){this.refreshModel({step:S.SORT});return}if(g(n)){this.refreshModel({step:S.FILTER_AGGREGATES});return}g(a)&&this.refreshModel({step:S.MAP})}),this.addManagedPropertyListener("rowHeight",()=>this.resetRowHeights())}start(){this.hasStarted=!0,this.shouldSkipSettingDataOnStart?this.dispatchUpdateEventsAndRefresh():this.setInitialData()}setInitialData(){const t=this.gos.get("rowData");t&&(this.shouldSkipSettingDataOnStart=!0,this.setRowData(t))}ensureRowHeightsValid(t,e,s,i){let r,o=!1;do{r=!1;const n=this.getRowIndexAtPixel(t),a=this.getRowIndexAtPixel(e),l=Math.max(n,s),u=Math.min(a,i);for(let c=l;c<=u;c++){const h=this.getRow(c);if(h.rowHeightEstimated){const g=this.gos.getRowHeightForNode(h);h.setRowHeight(g.height),r=!0,o=!0}}r&&this.setRowTopAndRowIndex()}while(r);return o}setRowTopAndRowIndex(){const t=this.environment.getDefaultRowHeight();let e=0;const s=new Set,i=this.gos.isDomLayout("normal");for(let r=0;r<this.rowsToDisplay.length;r++){const o=this.rowsToDisplay[r];if(o.id!=null&&s.add(o.id),o.rowHeight==null){const n=this.gos.getRowHeightForNode(o,i,t);o.setRowHeight(n.height,n.estimated)}o.setRowTop(e),o.setRowIndex(r),e+=o.rowHeight}return s}clearRowTopAndRowIndex(t,e){const s=t.isActive(),i=o=>{o&&o.id!=null&&!e.has(o.id)&&o.clearRowTopAndRowIndex()},r=o=>{if(i(o),i(o.detailNode),i(o.sibling),o.hasChildren()&&o.childrenAfterGroup){const n=o.level==-1;s&&!n&&!o.expanded||o.childrenAfterGroup.forEach(r)}};r(this.rootNode)}ensureRowsAtPixel(t,e,s=0){const i=this.getRowIndexAtPixel(e),r=this.getRow(i),o=!this.gos.get("suppressAnimationFrame");return r===t[0]?!1:(t.forEach(n=>{d.removeFromArray(this.rootNode.allLeafChildren,n)}),t.forEach((n,a)=>{d.insertIntoArray(this.rootNode.allLeafChildren,n,Math.max(i+s,0)+a)}),this.refreshModel({step:S.EVERYTHING,keepRenderedRows:!0,keepEditingRows:!0,animate:o}),!0)}highlightRowAtPixel(t,e){const s=e!=null?this.getRowIndexAtPixel(e):null,i=s!=null?this.getRow(s):null;if(!i||!t||i===t||e==null){this.lastHighlightedRow&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null);return}const r=this.getHighlightPosition(e,i);this.lastHighlightedRow&&this.lastHighlightedRow!==i&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null),i.setHighlighted(r),this.lastHighlightedRow=i}getHighlightPosition(t,e){if(!e){const r=this.getRowIndexAtPixel(t);if(e=this.getRow(r||0),!e)return Pt.Below}const{rowTop:s,rowHeight:i}=e;return t-s<i/2?Pt.Above:Pt.Below}getLastHighlightedRowNode(){return this.lastHighlightedRow}isLastRowIndexKnown(){return!0}getRowCount(){return this.rowsToDisplay?this.rowsToDisplay.length:0}getTopLevelRowCount(){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return 1;const e=this.rootNode.childrenAfterAggFilter;return e?e.length:0}getTopLevelRowDisplayedIndex(t){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return t;let s=this.rootNode.childrenAfterSort[t];if(this.gos.get("groupHideOpenParents"))for(;s.expanded&&s.childrenAfterSort&&s.childrenAfterSort.length>0;)s=s.childrenAfterSort[0];return s.rowIndex}getRowBounds(t){if(d.missing(this.rowsToDisplay))return null;const e=this.rowsToDisplay[t];return e?{rowTop:e.rowTop,rowHeight:e.rowHeight}:null}onRowGroupOpened(){const t=this.gos.isAnimateRows();this.refreshModel({step:S.MAP,keepRenderedRows:!0,animate:t})}onFilterChanged(t){if(t.afterDataChange)return;const e=this.gos.isAnimateRows(),i=t.columns.length===0||t.columns.some(r=>r.isPrimary())?S.FILTER:S.FILTER_AGGREGATES;this.refreshModel({step:i,keepRenderedRows:!0,animate:e})}onSortChanged(){const t=this.gos.isAnimateRows();this.refreshModel({step:S.SORT,keepRenderedRows:!0,animate:t,keepEditingRows:!0})}getType(){return"clientSide"}onValueChanged(){this.columnModel.isPivotActive()?this.refreshModel({step:S.PIVOT}):this.refreshModel({step:S.AGGREGATE})}createChangePath(t){const e=d.missingOrEmpty(t),s=new Ei(!1,this.rootNode);return(e||this.gos.get("treeData"))&&s.setInactive(),s}isSuppressModelUpdateAfterUpdateTransaction(t){if(!this.gos.get("suppressModelUpdateAfterUpdateTransaction")||t.rowNodeTransactions==null)return!1;const e=t.rowNodeTransactions.filter(i=>i.add!=null&&i.add.length>0||i.remove!=null&&i.remove.length>0);return e==null||e.length==0}buildRefreshModelParams(t){let e=S.EVERYTHING;const s={everything:S.EVERYTHING,group:S.EVERYTHING,filter:S.FILTER,map:S.MAP,aggregate:S.AGGREGATE,sort:S.SORT,pivot:S.PIVOT};if(d.exists(t)&&(e=s[t]),d.missing(e)){console.error(`AG Grid: invalid step ${t}, available steps are ${Object.keys(s).join(", ")}`);return}const i=!this.gos.get("suppressAnimationFrame");return{step:e,keepRenderedRows:!0,keepEditingRows:!0,animate:i}}refreshModel(t){if(!this.hasStarted||this.isRefreshingModel||this.columnModel.shouldRowModelIgnoreRefresh())return;let e=typeof t=="object"&&"step"in t?t:this.buildRefreshModelParams(t);if(!e||this.isSuppressModelUpdateAfterUpdateTransaction(e))return;const s=this.createChangePath(e.rowNodeTransactions);switch(this.isRefreshingModel=!0,e.step){case S.EVERYTHING:this.doRowGrouping(e.rowNodeTransactions,e.rowNodeOrder,s,!!e.afterColumnsChanged);case S.FILTER:this.doFilter(s);case S.PIVOT:this.doPivot(s);case S.AGGREGATE:this.doAggregate(s);case S.FILTER_AGGREGATES:this.doFilterAggregates(s);case S.SORT:this.doSort(e.rowNodeTransactions,s);case S.MAP:this.doRowsToDisplay()}const i=this.setRowTopAndRowIndex();this.clearRowTopAndRowIndex(s,i),this.isRefreshingModel=!1;const r={type:f.EVENT_MODEL_UPDATED,animate:e.animate,keepRenderedRows:e.keepRenderedRows,newData:e.newData,newPage:!1,keepUndoRedoStack:e.keepUndoRedoStack};this.eventService.dispatchEvent(r)}isEmpty(){const t=d.missing(this.rootNode.allLeafChildren)||this.rootNode.allLeafChildren.length===0;return d.missing(this.rootNode)||t||!this.columnModel.isReady()}isRowsToRender(){return d.exists(this.rowsToDisplay)&&this.rowsToDisplay.length>0}getNodesInRangeForSelection(t,e){let s=!e,i=!1;const r=[],o=this.gos.get("groupSelectsChildren");return this.forEachNodeAfterFilterAndSort(n=>{if(i)return;if(s&&(n===e||n===t)&&(i=!0,n.group&&o)){r.push(...n.allLeafChildren);return}if(!s){if(n!==e&&n!==t)return;s=!0}if(!n.group||!o){r.push(n);return}}),r}setDatasource(t){console.error("AG Grid: should never call setDatasource on clientSideRowController")}getTopLevelNodes(){return this.rootNode?this.rootNode.childrenAfterGroup:null}getRootNode(){return this.rootNode}getRow(t){return this.rowsToDisplay[t]}isRowPresent(t){return this.rowsToDisplay.indexOf(t)>=0}getRowIndexAtPixel(t){if(this.isEmpty()||this.rowsToDisplay.length===0)return-1;let e=0,s=this.rowsToDisplay.length-1;if(t<=0)return 0;if(d.last(this.rowsToDisplay).rowTop<=t)return this.rowsToDisplay.length-1;let r=-1,o=-1;for(;;){const n=Math.floor((e+s)/2),a=this.rowsToDisplay[n];if(this.isRowInPixel(a,t)||(a.rowTop<t?e=n+1:a.rowTop>t&&(s=n-1),r===e&&o===s))return n;r=e,o=s}}isRowInPixel(t,e){const s=t.rowTop,i=t.rowTop+t.rowHeight;return s<=e&&i>e}forEachLeafNode(t){this.rootNode.allLeafChildren&&this.rootNode.allLeafChildren.forEach((e,s)=>t(e,s))}forEachNode(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterGroup||[]],callback:t,recursionType:0,index:0,includeFooterNodes:e})}forEachNodeAfterFilter(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterAggFilter||[]],callback:t,recursionType:1,index:0,includeFooterNodes:e})}forEachNodeAfterFilterAndSort(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterSort||[]],callback:t,recursionType:2,index:0,includeFooterNodes:e})}forEachPivotNode(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[this.rootNode],callback:t,recursionType:3,index:0,includeFooterNodes:e})}recursivelyWalkNodesAndCallback(t){const{nodes:e,callback:s,recursionType:i,includeFooterNodes:r}=t;let{index:o}=t;const n=a=>{var l;const u=(l=e[0])==null?void 0:l.parent;if(!u)return;const c=r&&this.gos.getGrandTotalRow(),h=this.gos.getGroupTotalRowCallback(),g=r&&h({node:u});if(u===this.rootNode){c===a&&(u.createFooter(),s(u.sibling,o++));return}g===a&&(u.createFooter(),s(u.sibling,o++))};n("top");for(let a=0;a<e.length;a++){const l=e[a];if(s(l,o++),l.hasChildren()&&!l.footer){let u=null;switch(i){case 0:u=l.childrenAfterGroup;break;case 1:u=l.childrenAfterAggFilter;break;case 2:u=l.childrenAfterSort;break;case 3:u=l.leafGroup?null:l.childrenAfterSort;break}u&&(o=this.recursivelyWalkNodesAndCallback({nodes:[...u],callback:s,recursionType:i,index:o,includeFooterNodes:r}))}}return n("bottom"),o}doAggregate(t){var e;(e=this.aggregationStage)==null||e.execute({rowNode:this.rootNode,changedPath:t})}doFilterAggregates(t){this.filterAggregatesStage?this.filterAggregatesStage.execute({rowNode:this.rootNode,changedPath:t}):this.rootNode.childrenAfterAggFilter=this.rootNode.childrenAfterFilter}expandOrCollapseAll(t){const e=this.gos.get("treeData"),s=this.columnModel.isPivotActive(),i=n=>{!n||n.forEach(a=>{const l=()=>{a.expanded=t,i(a.childrenAfterGroup)};if(e){d.exists(a.childrenAfterGroup)&&l();return}if(s){!a.leafGroup&&l();return}a.group&&l()})};this.rootNode&&i(this.rootNode.childrenAfterGroup),this.refreshModel({step:S.MAP});const r=t?"expandAll":"collapseAll",o={type:f.EVENT_EXPAND_COLLAPSE_ALL,source:r};this.eventService.dispatchEvent(o)}doSort(t,e){this.sortStage.execute({rowNode:this.rootNode,rowNodeTransactions:t,changedPath:e})}doRowGrouping(t,e,s,i){if(this.groupStage){if(t?this.groupStage.execute({rowNode:this.rootNode,rowNodeTransactions:t,rowNodeOrder:e,changedPath:s}):this.groupStage.execute({rowNode:this.rootNode,changedPath:s,afterColumnsChanged:i}),this.gos.get("groupSelectsChildren")&&this.selectionService.updateGroupsFromChildrenSelections("rowGroupChanged",s)){const o={type:f.EVENT_SELECTION_CHANGED,source:"rowGroupChanged"};this.eventService.dispatchEvent(o)}}else this.rootNode.childrenAfterGroup=this.rootNode.allLeafChildren,this.rootNode.sibling&&(this.rootNode.sibling.childrenAfterGroup=this.rootNode.childrenAfterGroup),this.rootNode.updateHasChildren();this.nodeManager.isRowCountReady()&&(this.rowCountReady=!0,this.eventService.dispatchEventOnce({type:f.EVENT_ROW_COUNT_READY}))}doFilter(t){this.filterStage.execute({rowNode:this.rootNode,changedPath:t})}doPivot(t){var e;(e=this.pivotStage)==null||e.execute({rowNode:this.rootNode,changedPath:t})}getCopyOfNodesMap(){return this.nodeManager.getCopyOfNodesMap()}getRowNode(t){if(typeof t=="string"&&t.indexOf(Le.ID_PREFIX_ROW_GROUP)==0){let s;return this.forEachNode(i=>{i.id===t&&(s=i)}),s}return this.nodeManager.getRowNode(t)}setRowData(t){this.selectionService.reset("rowDataChanged"),this.nodeManager.setRowData(t),this.hasStarted&&this.dispatchUpdateEventsAndRefresh()}dispatchUpdateEventsAndRefresh(){const t={type:f.EVENT_ROW_DATA_UPDATED};this.eventService.dispatchEvent(t),this.refreshModel({step:S.EVERYTHING,newData:!0})}batchUpdateRowData(t,e){if(this.applyAsyncTransactionsTimeout==null){this.rowDataTransactionBatch=[];const s=this.gos.getAsyncTransactionWaitMillis();this.applyAsyncTransactionsTimeout=window.setTimeout(()=>{this.executeBatchUpdateRowData()},s)}this.rowDataTransactionBatch.push({rowDataTransaction:t,callback:e})}flushAsyncTransactions(){this.applyAsyncTransactionsTimeout!=null&&(clearTimeout(this.applyAsyncTransactionsTimeout),this.executeBatchUpdateRowData())}executeBatchUpdateRowData(){this.valueCache.onDataChanged();const t=[],e=[];let s=!1;if(this.rowDataTransactionBatch&&this.rowDataTransactionBatch.forEach(i=>{const r=this.nodeManager.updateRowData(i.rowDataTransaction,void 0);e.push(r),i.callback&&t.push(i.callback.bind(null,r)),typeof i.rowDataTransaction.addIndex=="number"&&(s=!0)}),this.commonUpdateRowData(e,void 0,s),t.length>0&&window.setTimeout(()=>{t.forEach(i=>i())},0),e.length>0){const i={type:f.EVENT_ASYNC_TRANSACTIONS_FLUSHED,results:e};this.eventService.dispatchEvent(i)}this.rowDataTransactionBatch=null,this.applyAsyncTransactionsTimeout=void 0}updateRowData(t,e){this.valueCache.onDataChanged();const s=this.nodeManager.updateRowData(t,e),i=typeof t.addIndex=="number";return this.commonUpdateRowData([s],e,i),s}createRowNodeOrder(){if(this.gos.get("suppressMaintainUnsortedOrder"))return;const e={};if(this.rootNode&&this.rootNode.allLeafChildren)for(let s=0;s<this.rootNode.allLeafChildren.length;s++){const i=this.rootNode.allLeafChildren[s];e[i.id]=s}return e}commonUpdateRowData(t,e,s){if(!this.hasStarted)return;const i=!this.gos.get("suppressAnimationFrame");s&&(e=this.createRowNodeOrder());const r={type:f.EVENT_ROW_DATA_UPDATED};this.eventService.dispatchEvent(r),this.refreshModel({step:S.EVERYTHING,rowNodeTransactions:t,rowNodeOrder:e,keepRenderedRows:!0,keepEditingRows:!0,animate:i})}doRowsToDisplay(){this.rowsToDisplay=this.flattenStage.execute({rowNode:this.rootNode})}onRowHeightChanged(){this.refreshModel({step:S.MAP,keepRenderedRows:!0,keepEditingRows:!0,keepUndoRedoStack:!0})}onRowHeightChangedDebounced(){this.onRowHeightChanged_debounced()}resetRowHeights(){const t=this.resetRowHeightsForAllRowNodes();this.rootNode.setRowHeight(this.rootNode.rowHeight,!0),this.rootNode.sibling&&this.rootNode.sibling.setRowHeight(this.rootNode.sibling.rowHeight,!0),t&&this.onRowHeightChanged()}resetRowHeightsForAllRowNodes(){let t=!1;return this.forEachNode(e=>{e.setRowHeight(e.rowHeight,!0);const s=e.detailNode;s&&s.setRowHeight(s.rowHeight,!0),e.sibling&&e.sibling.setRowHeight(e.sibling.rowHeight,!0),t=!0}),t}onGridStylesChanges(){this.columnModel.isAutoRowHeightActive()||this.resetRowHeights()}onGridReady(){this.hasStarted||this.setInitialData()}isRowDataLoaded(){return this.rowCountReady}};D([p("columnModel")],K.prototype,"columnModel",2);D([p("selectionService")],K.prototype,"selectionService",2);D([p("valueCache")],K.prototype,"valueCache",2);D([p("beans")],K.prototype,"beans",2);D([p("filterStage")],K.prototype,"filterStage",2);D([p("sortStage")],K.prototype,"sortStage",2);D([p("flattenStage")],K.prototype,"flattenStage",2);D([ne("groupStage")],K.prototype,"groupStage",2);D([ne("aggregationStage")],K.prototype,"aggregationStage",2);D([ne("pivotStage")],K.prototype,"pivotStage",2);D([ne("filterAggregatesStage")],K.prototype,"filterAggregatesStage",2);D([b],K.prototype,"init",1);K=D([G("rowModel")],K);var nt=class extends T{execute(t){const{changedPath:e}=t;this.filterService.filter(e)}};D([p("filterService")],nt.prototype,"filterService",2);nt=D([G("filterStage")],nt);var je=class extends T{execute(t){const e=this.sortController.getSortOptions(),s=d.exists(e)&&e.length>0,i=s&&d.exists(t.rowNodeTransactions)&&this.gos.get("deltaSort"),r=e.some(o=>this.gos.isColumnsSortingCoupledToGroup()?o.column.isPrimary()&&o.column.isRowGroupActive():!!o.column.getColDef().showRowGroup);this.sortService.sort(e,s,i,t.rowNodeTransactions,t.changedPath,r)}};D([p("sortService")],je.prototype,"sortService",2);D([p("sortController")],je.prototype,"sortController",2);je=D([G("sortStage")],je);var at=class extends T{execute(t){const e=t.rowNode,s=[],i=this.beans.columnModel.isPivotMode(),r=i&&e.leafGroup,o=r?[e]:e.childrenAfterSort,n=this.getFlattenDetails();this.recursivelyAddToRowsToDisplay(n,o,s,i,0);const a=s.length>0;if(!r&&a&&n.grandTotalRow){e.createFooter();const u=n.grandTotalRow==="top";this.addRowNodeToRowsToDisplay(n,e.sibling,s,0,u)}return s}getFlattenDetails(){const t=this.gos.get("groupRemoveSingleChildren");return{groupRemoveLowestSingleChildren:!t&&this.gos.get("groupRemoveLowestSingleChildren"),groupRemoveSingleChildren:t,isGroupMultiAutoColumn:this.gos.isGroupMultiAutoColumn(),hideOpenParents:this.gos.get("groupHideOpenParents"),grandTotalRow:this.gos.getGrandTotalRow(),groupTotalRow:this.gos.getGroupTotalRowCallback()}}recursivelyAddToRowsToDisplay(t,e,s,i,r){if(!d.missingOrEmpty(e))for(let o=0;o<e.length;o++){const n=e[o],a=n.hasChildren(),l=i&&!a,u=t.groupRemoveSingleChildren&&a&&n.childrenAfterGroup.length===1,c=t.groupRemoveLowestSingleChildren&&a&&n.leafGroup&&n.childrenAfterGroup.length===1,h=i&&n.leafGroup,g=t.hideOpenParents&&n.expanded&&!n.master&&!h;if(!l&&!g&&!u&&!c&&this.addRowNodeToRowsToDisplay(t,n,s,r),!(i&&n.leafGroup)){if(a){const y=u||c;if(n.expanded||y){const P=t.groupTotalRow({node:n});P||n.destroyFooter();const w=y?r:r+1;P==="top"&&(n.createFooter(),this.addRowNodeToRowsToDisplay(t,n.sibling,s,w)),this.recursivelyAddToRowsToDisplay(t,n.childrenAfterSort,s,i,w),P==="bottom"&&(n.createFooter(),this.addRowNodeToRowsToDisplay(t,n.sibling,s,w))}}else if(n.master&&n.expanded){const y=this.createDetailNode(n);this.addRowNodeToRowsToDisplay(t,y,s,r)}}}}addRowNodeToRowsToDisplay(t,e,s,i,r){r?s.unshift(e):s.push(e),e.setUiLevel(t.isGroupMultiAutoColumn?0:i)}createDetailNode(t){if(d.exists(t.detailNode))return t.detailNode;const e=new Le(this.beans);return e.detail=!0,e.selectable=!1,e.parent=t,d.exists(t.id)&&(e.id="detail_"+t.id),e.data=t.data,e.level=t.level+1,t.detailNode=e,e}};D([p("beans")],at.prototype,"beans",2);at=D([G("flattenStage")],at);var ze=class extends T{sort(t,e,s,i,r,o){const n=this.gos.get("groupMaintainOrder"),a=this.columnModel.getAllGridColumns().some(g=>g.isRowGroupActive());let l={};s&&i&&(l=this.calculateDirtyNodes(i));const u=this.columnModel.isPivotMode(),c=this.gos.getCallback("postSortRows"),h=g=>{var m;this.pullDownGroupDataForHideOpenParents(g.childrenAfterAggFilter,!0);const y=u&&g.leafGroup;if(n&&a&&!g.leafGroup&&!o){const w=(m=this.columnModel.getRowGroupColumns())==null?void 0:m[g.level+1],j=(w==null?void 0:w.getSort())===null,R=g.childrenAfterAggFilter.slice(0);if(g.childrenAfterSort&&!j){const ee={};g.childrenAfterSort.forEach((ke,ve)=>{ee[ke.id]=ve}),R.sort((ke,ve)=>{var be,tt;return((be=ee[ke.id])!=null?be:0)-((tt=ee[ve.id])!=null?tt:0)})}g.childrenAfterSort=R}else!e||y?g.childrenAfterSort=g.childrenAfterAggFilter.slice(0):s?g.childrenAfterSort=this.doDeltaSort(g,l,r,t):g.childrenAfterSort=this.rowNodeSorter.doFullSort(g.childrenAfterAggFilter,t);if(g.sibling&&(g.sibling.childrenAfterSort=g.childrenAfterSort),this.updateChildIndexes(g),c){const w={nodes:g.childrenAfterSort};c(w)}};r&&r.forEachChangedNodeDepthFirst(h),this.updateGroupDataForHideOpenParents(r)}calculateDirtyNodes(t){const e={},s=i=>{i&&i.forEach(r=>e[r.id]=!0)};return t&&t.forEach(i=>{s(i.add),s(i.update),s(i.remove)}),e}doDeltaSort(t,e,s,i){const r=t.childrenAfterAggFilter,o=t.childrenAfterSort;if(!o)return this.rowNodeSorter.doFullSort(r,i);const n={},a=[];r.forEach(h=>{e[h.id]||!s.canSkip(h)?a.push(h):n[h.id]=!0});const l=o.filter(h=>n[h.id]),u=(h,g)=>({currentPos:g,rowNode:h}),c=a.map(u).sort((h,g)=>this.rowNodeSorter.compareRowNodes(i,h,g));return this.mergeSortedArrays(i,c,l.map(u)).map(({rowNode:h})=>h)}mergeSortedArrays(t,e,s){const i=[];let r=0,o=0;for(;r<e.length&&o<s.length;)this.rowNodeSorter.compareRowNodes(t,e[r],s[o])<0?i.push(e[r++]):i.push(s[o++]);for(;r<e.length;)i.push(e[r++]);for(;o<s.length;)i.push(s[o++]);return i}updateChildIndexes(t){if(d.missing(t.childrenAfterSort))return;const e=t.childrenAfterSort;for(let s=0;s<e.length;s++){const i=e[s],r=s===0,o=s===t.childrenAfterSort.length-1;i.setFirstChild(r),i.setLastChild(o),i.setChildIndex(s)}}updateGroupDataForHideOpenParents(t){if(!this.gos.get("groupHideOpenParents"))return;if(this.gos.get("treeData"))return d.warnOnce("The property hideOpenParents dose not work with Tree Data. This is because Tree Data has values at the group level, it doesn't make sense to hide them."),!1;const e=s=>{this.pullDownGroupDataForHideOpenParents(s.childrenAfterSort,!1),s.childrenAfterSort.forEach(i=>{i.hasChildren()&&e(i)})};t&&t.executeFromRootNode(s=>e(s))}pullDownGroupDataForHideOpenParents(t,e){!this.gos.get("groupHideOpenParents")||d.missing(t)||t.forEach(s=>{this.columnModel.getGroupDisplayColumns().forEach(r=>{const o=r.getColDef().showRowGroup;if(typeof o!="string"){console.error("AG Grid: groupHideOpenParents only works when specifying specific columns for colDef.showRowGroup");return}const n=o,a=this.columnModel.getPrimaryColumn(n);if(a!==s.rowGroupColumn)if(e)s.setGroupValue(r.getId(),void 0);else{const u=s.getFirstChildOfFirstChild(a);u&&s.setGroupValue(r.getId(),u.key)}})})}};D([p("columnModel")],ze.prototype,"columnModel",2);D([p("rowNodeSorter")],ze.prototype,"rowNodeSorter",2);ze=D([G("sortService")],ze);var lt=class extends T{filter(t){const e=this.filterManager.isChildFilterPresent();this.filterNodes(e,t)}filterNodes(t,e){const s=(i,r)=>{i.hasChildren()&&t&&!r?i.childrenAfterFilter=i.childrenAfterGroup.filter(o=>{const n=o.childrenAfterFilter&&o.childrenAfterFilter.length>0,a=o.data&&this.filterManager.doesRowPassFilter({rowNode:o});return n||a}):i.childrenAfterFilter=i.childrenAfterGroup,i.sibling&&(i.sibling.childrenAfterFilter=i.childrenAfterFilter)};if(this.doingTreeDataFiltering()){const i=(o,n)=>{if(o.childrenAfterGroup)for(let a=0;a<o.childrenAfterGroup.length;a++){const l=o.childrenAfterGroup[a],u=n||this.filterManager.doesRowPassFilter({rowNode:l});l.childrenAfterGroup?i(o.childrenAfterGroup[a],u):s(l,u)}s(o,n)},r=o=>i(o,!1);e.executeFromRootNode(r)}else{const i=r=>s(r,!1);e.forEachChangedNodeDepthFirst(i,!0)}}doingTreeDataFiltering(){return this.gos.get("treeData")&&!this.gos.get("excludeChildrenWhenTreeDataFiltering")}};D([p("filterManager")],lt.prototype,"filterManager",2);lt=D([G("filterService")],lt);var Ae=class extends T{postConstruct(){this.rowModel.getType()==="clientSide"&&(this.clientSideRowModel=this.rowModel,this.addManagedPropertyListener("rowData",()=>this.onRowDataUpdated()))}isActive(){const t=this.gos.exists("getRowId");return this.gos.get("resetRowDataOnUpdate")?!1:t}setRowData(t){const e=this.createTransactionForRowData(t);if(!e)return;const[s,i]=e;this.clientSideRowModel.updateRowData(s,i)}createTransactionForRowData(t){if(d.missing(this.clientSideRowModel)){console.error("AG Grid: ImmutableService only works with ClientSideRowModel");return}const e=this.gos.getCallback("getRowId");if(e==null){console.error("AG Grid: ImmutableService requires getRowId() callback to be implemented, your row data needs IDs!");return}const s={remove:[],update:[],add:[]},i=this.clientSideRowModel.getCopyOfNodesMap(),o=this.gos.get("suppressMaintainUnsortedOrder")?void 0:{};return d.exists(t)&&t.forEach((n,a)=>{const l=e({data:n,level:0}),u=i[l];o&&(o[l]=a),u?(u.data!==n&&s.update.push(n),i[l]=void 0):s.add.push(n)}),d.iterateObject(i,(n,a)=>{a&&s.remove.push(a.data)}),[s,o]}onRowDataUpdated(){const t=this.gos.get("rowData");!t||(this.isActive()?this.setRowData(t):(this.selectionService.reset("rowDataChanged"),this.clientSideRowModel.setRowData(t)))}};D([p("rowModel")],Ae.prototype,"rowModel",2);D([p("rowRenderer")],Ae.prototype,"rowRenderer",2);D([p("selectionService")],Ae.prototype,"selectionService",2);D([b],Ae.prototype,"postConstruct",1);Ae=D([G("immutableService")],Ae);var ur="31.3.2",Ao={version:ur,moduleName:x.ClientSideRowModelModule,rowModel:"clientSide",beans:[K,nt,je,at,ze,lt,Ae]},Ns=Object.defineProperty,cr=Object.defineProperties,hr=Object.getOwnPropertyDescriptor,pr=Object.getOwnPropertyDescriptors,ds=Object.getOwnPropertySymbols,gr=Object.prototype.hasOwnProperty,mr=Object.prototype.propertyIsEnumerable,us=(t,e,s)=>e in t?Ns(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,fr=(t,e)=>{for(var s in e||(e={}))gr.call(e,s)&&us(t,s,e[s]);if(ds)for(var s of ds(e))mr.call(e,s)&&us(t,s,e[s]);return t},vr=(t,e)=>cr(t,pr(e)),A=(t,e,s,i)=>{for(var r=i>1?void 0:i?hr(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(r=(i?n(e,s,r):n(r))||r);return i&&r&&Ns(e,s,r),r},we=class extends T{execute(t){const e=d.missingOrEmpty(this.columnModel.getValueColumns()),s=!this.gos.getCallback("getGroupRowAgg"),i=t.changedPath&&t.changedPath.isActive();if(e&&s&&i)return;const r=this.createAggDetails(t);this.recursivelyCreateAggData(r)}createAggDetails(t){const e=this.columnModel.isPivotActive(),s=this.columnModel.getValueColumns(),i=e?this.columnModel.getPivotColumns():[];return{alwaysAggregateAtRootLevel:this.gos.get("alwaysAggregateAtRootLevel"),groupIncludeTotalFooter:!!this.gos.getGrandTotalRow(),changedPath:t.changedPath,valueColumns:s,pivotColumns:i,filteredOnly:!this.isSuppressAggFilteredOnly(),userAggFunc:this.gos.getCallback("getGroupRowAgg")}}isSuppressAggFilteredOnly(){return this.gos.getGroupAggFiltering()!==void 0||this.gos.get("suppressAggFilteredOnly")}recursivelyCreateAggData(t){const e=s=>{if(!s.hasChildren()){s.aggData&&s.setAggData(null);return}if(s.level===-1&&!t.groupIncludeTotalFooter){const o=!this.columnModel.isPivotMode();if(!t.alwaysAggregateAtRootLevel&&o){s.setAggData(null);return}}this.aggregateRowNode(s,t)};t.changedPath.forEachChangedNodeDepthFirst(e,!0)}aggregateRowNode(t,e){const s=e.valueColumns.length===0,i=e.pivotColumns.length===0;let r;e.userAggFunc?r=e.userAggFunc({nodes:t.childrenAfterFilter}):s?r=null:i?r=this.aggregateRowNodeUsingValuesOnly(t,e):r=this.aggregateRowNodeUsingValuesAndPivot(t),t.setAggData(r),t.sibling&&t.sibling.setAggData(r)}aggregateRowNodeUsingValuesAndPivot(t){var e,s;const i={},r=(e=this.columnModel.getSecondaryColumns())!=null?e:[];let o=!0;for(let n=0;n<r.length;n++){const a=r[n],l=a.getColDef();if(l.pivotTotalColumnIds!=null){o=!1;continue}const u=(s=l.pivotKeys)!=null?s:[];let c;t.leafGroup?c=this.getValuesFromMappedSet(t.childrenMapped,u,l.pivotValueColumn):c=this.getValuesPivotNonLeaf(t,l.colId),i[l.colId]=this.aggregateValues(c,l.pivotValueColumn.getAggFunc(),l.pivotValueColumn,t,a)}if(!o)for(let n=0;n<r.length;n++){const a=r[n],l=a.getColDef();if(l.pivotTotalColumnIds==null||!l.pivotTotalColumnIds.length)continue;const u=l.pivotTotalColumnIds.map(c=>i[c]);i[l.colId]=this.aggregateValues(u,l.pivotValueColumn.getAggFunc(),l.pivotValueColumn,t,a)}return i}aggregateRowNodeUsingValuesOnly(t,e){const s={},i=e.changedPath.isActive()?e.changedPath.getValueColumnsForNode(t,e.valueColumns):e.valueColumns,r=e.changedPath.isActive()?e.changedPath.getNotValueColumnsForNode(t,e.valueColumns):null,o=this.getValuesNormal(t,i,e.filteredOnly),n=t.aggData;return i.forEach((a,l)=>{s[a.getId()]=this.aggregateValues(o[l],a.getAggFunc(),a,t)}),r&&n&&r.forEach(a=>{s[a.getId()]=n[a.getId()]}),s}getValuesPivotNonLeaf(t,e){return t.childrenAfterFilter.map(s=>s.aggData[e])}getValuesFromMappedSet(t,e,s){let i=t;for(let r=0;r<e.length;r++){const o=e[r];i=i?i[o]:null}return i?i.map(r=>this.valueService.getValue(s,r)):[]}getValuesNormal(t,e,s){const i=[];e.forEach(()=>i.push([]));const r=e.length,o=s?t.childrenAfterFilter:t.childrenAfterGroup,n=o.length;for(let a=0;a<n;a++){const l=o[a];for(let u=0;u<r;u++){const c=e[u],h=this.valueService.getValue(c,l);i[u].push(h)}}return i}aggregateValues(t,e,s,i,r){const o=typeof e=="string"?this.aggFuncService.getAggFunc(e):e;if(typeof o!="function")return console.error(`AG Grid: unrecognised aggregation function ${e}`),null;const n=o,a=this.gos.addGridCommonParams({values:t,column:s,colDef:s?s.getColDef():void 0,pivotResultColumn:r,rowNode:i,data:i?i.data:void 0});return n(a)}};A([p("columnModel")],we.prototype,"columnModel",2);A([p("valueService")],we.prototype,"valueService",2);A([p("aggFuncService")],we.prototype,"aggFuncService",2);we=A([G("aggregationStage")],we);var Dt=class{constructor(){this.allSets={},this.allParents=[]}removeFromChildrenAfterGroup(t,e){const s=this.getSet(t);s.removeFromChildrenAfterGroup[e.id]=!0}isRemoveFromAllLeafChildren(t,e){return!!this.getSet(t).removeFromAllLeafChildren[e.id]}preventRemoveFromAllLeafChildren(t,e){const s=this.getSet(t);delete s.removeFromAllLeafChildren[e.id]}removeFromAllLeafChildren(t,e){const s=this.getSet(t);s.removeFromAllLeafChildren[e.id]=!0}getSet(t){return this.allSets[t.id]||(this.allSets[t.id]={removeFromAllLeafChildren:{},removeFromChildrenAfterGroup:{}},this.allParents.push(t)),this.allSets[t.id]}getAllParents(){return this.allParents}flush(){this.allParents.forEach(t=>{const e=this.allSets[t.id];t.childrenAfterGroup=t.childrenAfterGroup.filter(s=>!e.removeFromChildrenAfterGroup[s.id]),t.allLeafChildren=t.allLeafChildren.filter(s=>!e.removeFromAllLeafChildren[s.id]),t.updateHasChildren(),t.sibling&&(t.sibling.childrenAfterGroup=t.childrenAfterGroup,t.sibling.allLeafChildren=t.allLeafChildren)}),this.allSets={},this.allParents.length=0}},ue=class extends T{execute(t){const e=this.createGroupingDetails(t);if(e.transactions)this.handleTransaction(e);else{const s=t.afterColumnsChanged===!0;this.shotgunResetEverything(e,s)}e.usingTreeData||(this.positionLeafsAndGroups(t.changedPath),this.orderGroups(e)),this.selectableService.updateSelectableAfterGrouping()}positionLeafsAndGroups(t){t.forEachChangedNodeDepthFirst(e=>{if(e.childrenAfterGroup){const s=[],i=[];let r;e.childrenAfterGroup.forEach(o=>{var n;(n=o.childrenAfterGroup)!=null&&n.length?o.key===""&&!r?r=o:i.push(o):s.push(o)}),r&&i.push(r),e.childrenAfterGroup=[...s,...i]}},!1)}createGroupingDetails(t){var e;const{rowNode:s,changedPath:i,rowNodeTransactions:r,rowNodeOrder:o}=t,n=this.gos.get("treeData"),a=n?null:this.columnModel.getRowGroupColumns();return{includeParents:!this.gos.get("suppressParentsInRowNodes"),expandByDefault:this.gos.get("groupDefaultExpanded"),groupedCols:a,rootNode:s,pivotMode:this.columnModel.isPivotMode(),groupedColCount:n||!a?0:a.length,rowNodeOrder:o,transactions:r,changedPath:i,groupAllowUnbalanced:this.gos.get("groupAllowUnbalanced"),isGroupOpenByDefault:this.gos.getCallback("isGroupOpenByDefault"),initialGroupOrderComparator:this.gos.getCallback("initialGroupOrderComparator"),usingTreeData:n,suppressGroupMaintainValueType:this.gos.get("suppressGroupMaintainValueType"),getDataPath:n?this.gos.get("getDataPath"):void 0,keyCreators:(e=a==null?void 0:a.map(u=>u.getColDef().keyCreator))!=null?e:[]}}handleTransaction(t){t.transactions.forEach(e=>{const s=t.usingTreeData?void 0:new Dt;if(d.existsAndNotEmpty(e.remove)&&this.removeNodes(e.remove,t,s),d.existsAndNotEmpty(e.update)&&this.moveNodesInWrongPath(e.update,t,s),d.existsAndNotEmpty(e.add)&&this.insertNodes(e.add,t,!1),s){const i=s.getAllParents().slice();s.flush(),this.removeEmptyGroups(i,t)}}),t.rowNodeOrder&&this.sortChildren(t)}sortChildren(t){t.changedPath.forEachChangedNodeDepthFirst(e=>{if(!e.childrenAfterGroup)return;d.sortRowNodesByOrder(e.childrenAfterGroup,t.rowNodeOrder)&&t.changedPath.addParentNode(e)},!1,!0)}orderGroups(t){const e=t.initialGroupOrderComparator;d.exists(e)&&s(t.rootNode);function s(i){d.exists(i.childrenAfterGroup)&&!i.leafGroup&&(i.childrenAfterGroup.sort((o,n)=>e({nodeA:o,nodeB:n})),i.childrenAfterGroup.forEach(o=>s(o)))}}getExistingPathForNode(t,e){const s=[];let i=e.usingTreeData?t:t.parent;for(;i&&i!==e.rootNode;)s.push({key:i.key,rowGroupColumn:i.rowGroupColumn,field:i.field}),i=i.parent;return s.reverse(),s}moveNodesInWrongPath(t,e,s){t.forEach(i=>{e.changedPath.isActive()&&e.changedPath.addParentNode(i.parent);const r=l=>l.key,o=this.getExistingPathForNode(i,e).map(r),n=this.getGroupInfo(i,e).map(r);d.areEqual(o,n)||this.moveNode(i,e,s)})}moveNode(t,e,s){if(this.removeNodesInStages([t],e,s),this.insertOneNode(t,e,!0,s),t.setData(t.data),e.changedPath.isActive()){const i=t.parent;e.changedPath.addParentNode(i)}}removeNodes(t,e,s){this.removeNodesInStages(t,e,s),e.changedPath.isActive()&&t.forEach(i=>e.changedPath.addParentNode(i.parent))}removeNodesInStages(t,e,s){if(this.removeNodesFromParents(t,e,s),e.usingTreeData){this.postRemoveCreateFillerNodes(t,e);const i=t.map(r=>r.parent);this.removeEmptyGroups(i,e)}}forEachParentGroup(t,e,s){let i=e;for(;i&&i!==t.rootNode;)s(i),i=i.parent}removeNodesFromParents(t,e,s){const i=s==null,r=s||new Dt;t.forEach(o=>{this.removeFromParent(o,r),this.forEachParentGroup(e,o.parent,n=>{r.removeFromAllLeafChildren(n,o)})}),i&&r.flush()}postRemoveCreateFillerNodes(t,e){t.forEach(s=>{if(s.hasChildren()){const r=this.getExistingPathForNode(s,e),o=this.findParentForNode(s,r,e);o.expanded=s.expanded,o.allLeafChildren=s.allLeafChildren,o.childrenAfterGroup=s.childrenAfterGroup,o.childrenMapped=s.childrenMapped,o.updateHasChildren(),o.childrenAfterGroup.forEach(n=>n.parent=o)}})}removeEmptyGroups(t,e){let s=!0;const i=r=>{const o=this.getChildrenMappedKey(r.key,r.rowGroupColumn),n=r.parent;return(n&&n.childrenMapped?!n.childrenMapped[o]:!0)?!1:!!r.isEmptyRowGroupNode()};for(;s;){s=!1;const r=new Dt;t.forEach(o=>{this.forEachParentGroup(e,o,n=>{i(n)&&(s=!0,this.removeFromParent(n,r),n.setSelectedParams({newValue:!1,source:"rowGroupChanged"}))})}),r.flush()}}removeFromParent(t,e){t.parent&&(e?e.removeFromChildrenAfterGroup(t.parent,t):(d.removeFromArray(t.parent.childrenAfterGroup,t),t.parent.updateHasChildren()));const s=this.getChildrenMappedKey(t.key,t.rowGroupColumn);t.parent&&t.parent.childrenMapped&&(t.parent.childrenMapped[s]=void 0),t.setRowTop(null),t.setRowIndex(null)}addToParent(t,e){const s=this.getChildrenMappedKey(t.key,t.rowGroupColumn);e&&(e.childrenMapped!=null&&(e.childrenMapped[s]=t),e.childrenAfterGroup.push(t),e.updateHasChildren())}areGroupColsEqual(t,e){return t==null||e==null||t.pivotMode!==e.pivotMode?!1:d.areEqual(t.groupedCols,e.groupedCols)&&d.areEqual(t.keyCreators,e.keyCreators)}checkAllGroupDataAfterColsChanged(t){const e=s=>{!s||s.forEach(i=>{if(!t.usingTreeData&&!i.group)return;const o={field:i.field,key:i.key,rowGroupColumn:i.rowGroupColumn,leafNode:i.allLeafChildren[0]};this.setGroupData(i,o,t),e(i.childrenAfterGroup)})};e(t.rootNode.childrenAfterGroup)}shotgunResetEverything(t,e){if(this.noChangeInGroupingColumns(t,e))return;this.selectionService.filterFromSelection(o=>o&&!o.group);const{rootNode:s,groupedCols:i}=t;s.leafGroup=t.usingTreeData?!1:i.length===0,s.childrenAfterGroup=[],s.childrenMapped={},s.updateHasChildren();const r=s.sibling;r&&(r.childrenAfterGroup=s.childrenAfterGroup,r.childrenMapped=s.childrenMapped),this.insertNodes(s.allLeafChildren,t,!1)}noChangeInGroupingColumns(t,e){let s=!1;const i=this.columnModel.getGroupDisplayColumns(),r=i?i.map(o=>o.getId()).join("-"):"";return e&&(s=t.usingTreeData||this.areGroupColsEqual(t,this.oldGroupingDetails),this.oldGroupDisplayColIds!==r&&this.checkAllGroupDataAfterColsChanged(t)),this.oldGroupingDetails=t,this.oldGroupDisplayColIds=r,s}insertNodes(t,e,s){t.forEach(i=>{this.insertOneNode(i,e,s),e.changedPath.isActive()&&e.changedPath.addParentNode(i.parent)})}insertOneNode(t,e,s,i){const r=this.getGroupInfo(t,e),o=this.findParentForNode(t,r,e,i);o.group||console.warn("AG Grid: duplicate group keys for row data, keys should be unique",[o.data,t.data]),e.usingTreeData?this.swapGroupWithUserNode(o,t,s):(t.parent=o,t.level=r.length,o.childrenAfterGroup.push(t),o.updateHasChildren())}findParentForNode(t,e,s,i){let r=s.rootNode;return e.forEach((o,n)=>{r=this.getOrCreateNextNode(r,o,n,s),i!=null&&i.isRemoveFromAllLeafChildren(r,t)?i==null||i.preventRemoveFromAllLeafChildren(r,t):r.allLeafChildren.push(t)}),r}swapGroupWithUserNode(t,e,s){e.parent=t.parent,e.key=t.key,e.field=t.field,e.groupData=t.groupData,e.level=t.level,s||(e.expanded=t.expanded),e.leafGroup=t.leafGroup,e.rowGroupIndex=t.rowGroupIndex,e.allLeafChildren=t.allLeafChildren,e.childrenAfterGroup=t.childrenAfterGroup,e.childrenMapped=t.childrenMapped,e.sibling=t.sibling,e.updateHasChildren(),this.removeFromParent(t),e.childrenAfterGroup.forEach(i=>i.parent=e),this.addToParent(e,t.parent)}getOrCreateNextNode(t,e,s,i){const r=this.getChildrenMappedKey(e.key,e.rowGroupColumn);let o=t.childrenMapped?t.childrenMapped[r]:void 0;return o||(o=this.createGroup(e,t,s,i),this.addToParent(o,t)),o}createGroup(t,e,s,i){const r=new Le(this.beans);return r.group=!0,r.field=t.field,r.rowGroupColumn=t.rowGroupColumn,this.setGroupData(r,t,i),r.key=t.key,r.id=this.createGroupId(r,e,i.usingTreeData,s),r.level=s,r.leafGroup=i.usingTreeData?!1:s===i.groupedColCount-1,r.allLeafChildren=[],r.setAllChildrenCount(0),r.rowGroupIndex=i.usingTreeData?null:s,r.childrenAfterGroup=[],r.childrenMapped={},r.updateHasChildren(),r.parent=i.includeParents?e:null,this.setExpandedInitialValue(i,r),r}createGroupId(t,e,s,i){let r;return s?r=(o,n,a)=>{if(a<0)return null;const l=n?r(n,n.parent,a-1):null;return`${l==null?"":l+"-"}${a}-${o.key}`}:r=(o,n)=>{if(!o.rowGroupColumn)return null;const a=n?r(n,n.parent,0):null;return`${a==null?"":a+"-"}${o.rowGroupColumn.getColId()}-${o.key}`},Le.ID_PREFIX_ROW_GROUP+r(t,e,i)}setGroupData(t,e,s){t.groupData={},this.columnModel.getGroupDisplayColumns().forEach(r=>{if(s.usingTreeData){t.groupData[r.getColId()]=e.key;return}const n=t.rowGroupColumn;n!==null&&r.isRowGroupDisplayed(n.getId())&&(s.suppressGroupMaintainValueType?t.groupData[r.getColId()]=e.key:t.groupData[r.getColId()]=this.valueService.getValue(n,e.leafNode))})}getChildrenMappedKey(t,e){return e?e.getId()+"-"+t:t}setExpandedInitialValue(t,e){if(t.pivotMode&&e.leafGroup){e.expanded=!1;return}const s=t.isGroupOpenByDefault;if(s){const r={rowNode:e,field:e.field,key:e.key,level:e.level,rowGroupColumn:e.rowGroupColumn};e.expanded=s(r)==!0;return}const{expandByDefault:i}=t;if(t.expandByDefault===-1){e.expanded=!0;return}e.expanded=e.level<i}getGroupInfo(t,e){return e.usingTreeData?this.getGroupInfoFromCallback(t,e):this.getGroupInfoFromGroupColumns(t,e)}getGroupInfoFromCallback(t,e){const s=e.getDataPath?e.getDataPath(t.data):null;(s==null||s.length===0)&&d.warnOnce(`getDataPath() should not return an empty path for data ${t.data}`);const i=r=>({key:r,field:null,rowGroupColumn:null});return s?s.map(i):[]}getGroupInfoFromGroupColumns(t,e){const s=[];return e.groupedCols.forEach(i=>{let r=this.valueService.getKeyForNode(i,t),o=r!=null&&r!=="";if((e.pivotMode||!e.groupAllowUnbalanced)&&!o&&(r="",o=!0),o){const a={key:r,field:i.getColDef().field,rowGroupColumn:i,leafNode:t};s.push(a)}}),s}};A([p("columnModel")],ue.prototype,"columnModel",2);A([p("selectableService")],ue.prototype,"selectableService",2);A([p("valueService")],ue.prototype,"valueService",2);A([p("beans")],ue.prototype,"beans",2);A([p("selectionService")],ue.prototype,"selectionService",2);ue=A([G("groupStage")],ue);var ce=class extends T{init(){const t=()=>{var s;return(s=this.gos.get("serverSidePivotResultFieldSeparator"))!=null?s:"_"};this.fieldSeparator=t(),this.addManagedPropertyListener("serverSidePivotResultFieldSeparator",()=>{this.fieldSeparator=t()});const e=()=>this.gos.get("pivotDefaultExpanded");this.pivotDefaultExpanded=e(),this.addManagedPropertyListener("pivotDefaultExpanded",()=>{this.pivotDefaultExpanded=e()})}createPivotColumnDefs(t){const e=this.createPivotColumnsFromUniqueValues(t);function s(o,n=[]){return o.forEach(a=>{a.children!==void 0?s(a.children,n):n.push(a)}),n}const i=s(e);this.addRowGroupTotals(e,i),this.addExpandablePivotGroups(e,i),this.addPivotTotalsToGroups(e,i);const r=i.map(o=>d.cloneObject(o));return{pivotColumnGroupDefs:e,pivotColumnDefs:r}}createPivotColumnsFromUniqueValues(t){const e=this.columnModel.getPivotColumns(),s=e.length;return this.recursivelyBuildGroup(0,t,[],s,e)}recursivelyBuildGroup(t,e,s,i,r){const o=this.columnModel.getValueColumns();if(t>=i)return this.buildMeasureCols(s);const n=r[t].getColDef(),a=this.headerNameComparator.bind(this,n.pivotComparator);if(o.length===1&&this.gos.get("removePivotHeaderRowWhenSingleValueColumn")&&t===i-1){const u=[];return d.iterateObject(e,c=>{const h=[...s,c],g=this.createColDef(o[0],c,h);g.columnGroupShow="open",u.push(g)}),u.sort(a),u}const l=[];return d.iterateObject(e,(u,c)=>{const h=this.pivotDefaultExpanded===-1||t<this.pivotDefaultExpanded,g=[...s,u];l.push({children:this.recursivelyBuildGroup(t+1,c,g,i,r),headerName:u,pivotKeys:g,columnGroupShow:"open",openByDefault:h,groupId:this.generateColumnGroupId(g)})}),l.sort(a),l}buildMeasureCols(t){const e=this.columnModel.getValueColumns();return e.length===0?[this.createColDef(null,"-",t)]:e.map(s=>{const i=this.columnModel.getDisplayNameForColumn(s,"header");return vr(fr({},this.createColDef(s,i,t)),{columnGroupShow:"open"})})}addExpandablePivotGroups(t,e){if(this.gos.get("suppressExpandablePivotGroups")||this.gos.get("pivotColumnGroupTotals"))return;const s=(i,r,o)=>{const n=i;if(n.children){const a=new Map;n.children.forEach(u=>{s(u,r,a)});const l=!n.children.some(u=>u.children);this.columnModel.getValueColumns().forEach(u=>{const c=this.columnModel.getDisplayNameForColumn(u,"header"),h=this.createColDef(u,c,i.pivotKeys);h.pivotTotalColumnIds=a.get(u.getColId()),h.columnGroupShow="closed",h.aggFunc=u.getAggFunc(),l||(i.children.push(h),r.push(h))}),this.merge(o,a)}else{const a=i;if(!a.pivotValueColumn)return;const l=a.pivotValueColumn.getColId(),u=o.has(l)?o.get(l):[];u.push(a.colId),o.set(l,u)}};t.forEach(i=>{s(i,e,new Map)})}addPivotTotalsToGroups(t,e){if(!this.gos.get("pivotColumnGroupTotals"))return;const s=this.gos.get("pivotColumnGroupTotals")==="after",i=this.columnModel.getValueColumns(),r=i.map(n=>n.getAggFunc());if(!r||r.length<1||!this.sameAggFuncs(r))return;const o=i[0];t.forEach(n=>{this.recursivelyAddPivotTotal(n,e,o,s)})}recursivelyAddPivotTotal(t,e,s,i){const r=t;if(!r.children){const n=t;return n.colId?[n.colId]:null}let o=[];if(r.children.forEach(n=>{const a=this.recursivelyAddPivotTotal(n,e,s,i);a&&(o=o.concat(a))}),r.children.length>1){const a=this.localeService.getLocaleTextFunc()("pivotColumnGroupTotals","Total"),l=this.createColDef(s,a,t.pivotKeys,!0);l.pivotTotalColumnIds=o,l.aggFunc=s.getAggFunc();const u=t.children;i?u.push(l):u.unshift(l),e.push(l)}return o}addRowGroupTotals(t,e){if(!this.gos.get("pivotRowTotals"))return;const s=this.gos.get("pivotRowTotals")==="after",i=this.columnModel.getValueColumns(),r=s?i.slice():i.slice().reverse();for(let o=0;o<r.length;o++){const n=r[o];let a=[];t.forEach(u=>{a=a.concat(this.extractColIdsForValueColumn(u,n))});const l=r.length>1||!this.gos.get("removePivotHeaderRowWhenSingleValueColumn");this.createRowGroupTotal(t,e,n,a,s,l)}}extractColIdsForValueColumn(t,e){const s=t;if(!s.children){const r=s;return r.pivotValueColumn===e&&r.colId?[r.colId]:[]}let i=[];return s.children.forEach(r=>{this.extractColIdsForValueColumn(r,e);const o=this.extractColIdsForValueColumn(r,e);i=i.concat(o)}),i}createRowGroupTotal(t,e,s,i,r,o){const n=this.columnModel.getValueColumns();let a;if(n.length===0)a=this.createColDef(null,"-",[]);else{const u=this.columnModel.getDisplayNameForColumn(s,"header");a=this.createColDef(s,u,[]),a.pivotTotalColumnIds=i}a.colId=ce.PIVOT_ROW_TOTAL_PREFIX+a.colId,e.push(a);const l=o?{children:[a],pivotKeys:[],groupId:`${ce.PIVOT_ROW_TOTAL_PREFIX}_pivotGroup_${s.getColId()}`}:a;r?t.push(l):t.unshift(l)}createColDef(t,e,s,i=!1){const r={};if(t){const o=t.getColDef();Object.assign(r,o),r.hide=!1}return r.headerName=e,r.colId=this.generateColumnId(s||[],t&&!i?t.getColId():""),r.field=r.colId,r.valueGetter=o=>{var n;return(n=o.data)==null?void 0:n[o.colDef.field]},r.pivotKeys=s,r.pivotValueColumn=t,r.filter===!0&&(r.filter="agNumberColumnFilter"),r}sameAggFuncs(t){if(t.length==1)return!0;for(let e=1;e<t.length;e++)if(t[e]!==t[0])return!1;return!0}headerNameComparator(t,e,s){return t?t(e.headerName,s.headerName):e.headerName&&!s.headerName?1:!e.headerName&&s.headerName?-1:!e.headerName||!s.headerName?0:e.headerName<s.headerName?-1:e.headerName>s.headerName?1:0}merge(t,e){e.forEach((s,i,r)=>{const n=[...t.has(i)?t.get(i):[],...s];t.set(i,n)})}generateColumnGroupId(t){return`pivotGroup_${this.columnModel.getPivotColumns().map(s=>s.getColId()).join("-")}_${t.join("-")}`}generateColumnId(t,e){return`pivot_${this.columnModel.getPivotColumns().map(i=>i.getColId()).join("-")}_${t.join("-")}_${e}`}createColDefsFromFields(t){const e={};for(let r=0;r<t.length;r++){const n=t[r].split(this.fieldSeparator);let a=e;for(let l=0;l<n.length;l++){const u=n[l];a[u]==null&&(a[u]={}),a=a[u]}}const s=(r,o,n,a)=>{var l;const u=[];for(let g in n){const m=n[g],y=s(`${r}${this.fieldSeparator}${g}`,g,m,a+1);u.push(y)}if(u.length===0){const g=this.columnModel.getPrimaryColumn(o);if(g){const y=(l=this.columnModel.getDisplayNameForColumn(g,"header"))!=null?l:o,P=this.createColDef(g,y,void 0,!1);return P.colId=r,P.aggFunc=g.getAggFunc(),P.valueGetter=w=>{var j;return(j=w.data)==null?void 0:j[r]},P}return{colId:r,headerName:o,valueGetter:y=>{var P;return(P=y.data)==null?void 0:P[r]}}}return this.gos.get("removePivotHeaderRowWhenSingleValueColumn")&&u.length===1&&"colId"in u[0]?(u[0].headerName=o,u[0]):{openByDefault:this.pivotDefaultExpanded===-1||a<this.pivotDefaultExpanded,groupId:r,headerName:o,children:u}},i=[];for(let r in e){const o=e[r],n=s(r,r,o,0);i.push(n)}return i}};ce.PIVOT_ROW_TOTAL_PREFIX="PivotRowTotal_";A([p("columnModel")],ce.prototype,"columnModel",2);A([b],ce.prototype,"init",1);ce=A([G("pivotColDefService")],ce);var oe=class extends T{constructor(){super(...arguments),this.uniqueValues={},this.lastTimeFailed=!1,this.maxUniqueValues=-1,this.currentUniqueCount=0}execute(t){const e=t.changedPath;this.columnModel.isPivotActive()?this.executePivotOn(e):this.executePivotOff(e)}executePivotOff(t){this.aggregationColumnsHashLastTime=null,this.uniqueValues={},this.columnModel.isSecondaryColumnsPresent()&&(this.columnModel.setSecondaryColumns(null,"rowModelUpdated"),t&&t.setInactive())}executePivotOn(t){var e;const s=(e=this.columnModel.getValueColumns().length)!=null?e:1,i=this.gos.get("pivotMaxGeneratedColumns");this.maxUniqueValues=i===-1?-1:i/s;let r;try{r=this.bucketUpRowNodes(t)}catch(R){if(R.message===oe.EXCEEDED_MAX_UNIQUE_VALUES){this.columnModel.setSecondaryColumns([],"rowModelUpdated");const ee={type:f.EVENT_PIVOT_MAX_COLUMNS_EXCEEDED,message:R.message};this.eventService.dispatchEvent(ee),this.lastTimeFailed=!0;return}throw R}const o=this.setUniqueValues(r),n=this.columnModel.getValueColumns(),a=n.map(R=>`${R.getId()}-${R.getColDef().headerName}`).join("#"),l=n.map(R=>R.getAggFunc().toString()).join("#"),u=this.aggregationColumnsHashLastTime!==a,c=this.aggregationFuncsHashLastTime!==l;this.aggregationColumnsHashLastTime=a,this.aggregationFuncsHashLastTime=l;const h=this.columnModel.getRowGroupColumns().map(R=>R.getId()).join("#"),g=h!==this.groupColumnsHashLastTime;this.groupColumnsHashLastTime=h;const m=this.gos.get("pivotRowTotals"),y=this.gos.get("pivotColumnGroupTotals"),P=this.gos.get("suppressExpandablePivotGroups"),w=this.gos.get("removePivotHeaderRowWhenSingleValueColumn"),j=m!==this.pivotRowTotalsLastTime||y!==this.pivotColumnGroupTotalsLastTime||P!==this.suppressExpandablePivotGroupsLastTime||w!==this.removePivotHeaderRowWhenSingleValueColumnLastTime;if(this.pivotRowTotalsLastTime=m,this.pivotColumnGroupTotalsLastTime=y,this.suppressExpandablePivotGroupsLastTime=P,this.removePivotHeaderRowWhenSingleValueColumnLastTime=w,this.lastTimeFailed||o||u||g||c||j){const{pivotColumnGroupDefs:R,pivotColumnDefs:ee}=this.pivotColDefService.createPivotColumnDefs(this.uniqueValues);this.pivotColumnDefs=ee,this.columnModel.setSecondaryColumns(R,"rowModelUpdated"),t&&t.setInactive()}this.lastTimeFailed=!1}setUniqueValues(t){const e=JSON.stringify(t),s=JSON.stringify(this.uniqueValues);return e!==s?(this.uniqueValues=t,!0):!1}bucketUpRowNodes(t){this.currentUniqueCount=0;const e={};t.forEachChangedNodeDepthFirst(i=>{i.leafGroup&&(i.childrenMapped=null)});const s=i=>{var r;i.leafGroup?this.bucketRowNode(i,e):(r=i.childrenAfterFilter)==null||r.forEach(s)};return t.executeFromRootNode(s),e}bucketRowNode(t,e){const s=this.columnModel.getPivotColumns();s.length===0?t.childrenMapped=null:t.childrenMapped=this.bucketChildren(t.childrenAfterFilter,s,0,e),t.sibling&&(t.sibling.childrenMapped=t.childrenMapped)}bucketChildren(t,e,s,i){const r={},o=e[s];if(t.forEach(n=>{let a=this.valueService.getKeyForNode(o,n);if(d.missing(a)&&(a=""),!i[a]){this.currentUniqueCount+=1,i[a]={};const l=this.maxUniqueValues!==-1,u=this.currentUniqueCount>this.maxUniqueValues;if(l&&u)throw Error(oe.EXCEEDED_MAX_UNIQUE_VALUES)}r[a]||(r[a]=[]),r[a].push(n)}),s===e.length-1)return r;{const n={};return d.iterateObject(r,(a,l)=>{n[a]=this.bucketChildren(l,e,s+1,i[a])}),n}}getPivotColumnDefs(){return this.pivotColumnDefs}};oe.EXCEEDED_MAX_UNIQUE_VALUES="Exceeded maximum allowed pivot column count.";A([p("valueService")],oe.prototype,"valueService",2);A([p("columnModel")],oe.prototype,"columnModel",2);A([p("pivotColDefService")],oe.prototype,"pivotColDefService",2);oe=A([G("pivotStage")],oe);var Cr={sum:"Sum",first:"First",last:"Last",min:"Min",max:"Max",count:"Count",avg:"Average"},_=class extends T{constructor(){super(...arguments),this.aggFuncsMap={},this.initialised=!1}init(){this.initialised||(this.initialiseWithDefaultAggregations(),this.addAggFuncs(this.gos.get("aggFuncs")))}initialiseWithDefaultAggregations(){this.aggFuncsMap[_.AGG_SUM]=Er,this.aggFuncsMap[_.AGG_FIRST]=yr,this.aggFuncsMap[_.AGG_LAST]=Ar,this.aggFuncsMap[_.AGG_MIN]=Fr,this.aggFuncsMap[_.AGG_MAX]=Sr,this.aggFuncsMap[_.AGG_COUNT]=Mr,this.aggFuncsMap[_.AGG_AVG]=Pr,this.initialised=!0}isAggFuncPossible(t,e){const s=this.getFuncNames(t),i=d.includes(s,e),r=d.exists(this.aggFuncsMap[e]);return i&&r}getDefaultFuncLabel(t){var e;return(e=Cr[t])!=null?e:t}getDefaultAggFunc(t){const e=t.getColDef().defaultAggFunc;if(d.exists(e)&&this.isAggFuncPossible(t,e))return e;if(this.isAggFuncPossible(t,_.AGG_SUM))return _.AGG_SUM;const s=this.getFuncNames(t);return d.existsAndNotEmpty(s)?s[0]:null}addAggFuncs(t){this.init(),d.iterateObject(t,(e,s)=>{this.aggFuncsMap[e]=s})}getAggFunc(t){return this.init(),this.aggFuncsMap[t]}getFuncNames(t){const e=t.getColDef().allowedAggFuncs;return e==null?Object.keys(this.aggFuncsMap).sort():e}clear(){this.aggFuncsMap={}}};_.AGG_SUM="sum";_.AGG_FIRST="first";_.AGG_LAST="last";_.AGG_MIN="min";_.AGG_MAX="max";_.AGG_COUNT="count";_.AGG_AVG="avg";A([b],_.prototype,"init",1);_=A([G("aggFuncService")],_);function Er(t){const{values:e}=t;let s=null;for(let i=0;i<e.length;i++){const r=e[i];typeof r=="number"?s===null?s=r:s+=typeof s=="number"?r:BigInt(r):typeof r=="bigint"&&(s===null?s=r:s=(typeof s=="bigint"?s:BigInt(s))+r)}return s}function yr(t){return t.values.length>0?t.values[0]:null}function Ar(t){return t.values.length>0?d.last(t.values):null}function Fr(t){const{values:e}=t;let s=null;for(let i=0;i<e.length;i++){const r=e[i];(typeof r=="number"||typeof r=="bigint")&&(s===null||s>r)&&(s=r)}return s}function Sr(t){const{values:e}=t;let s=null;for(let i=0;i<e.length;i++){const r=e[i];(typeof r=="number"||typeof r=="bigint")&&(s===null||s<r)&&(s=r)}return s}function Mr(t){var e,s;const{values:i}=t;let r=0;for(let n=0;n<i.length;n++){const a=i[n];r+=a!=null&&typeof a.value=="number"?a.value:1}const o=(s=(e=t.rowNode)==null?void 0:e.aggData)==null?void 0:s[t.column.getColId()];return o&&o.value===r?o:{value:r,toString:function(){return this.value.toString()},toNumber:function(){return this.value}}}function Pr(t){var e,s,i;const{values:r}=t;let o=0,n=0;for(let u=0;u<r.length;u++){const c=r[u];let h=null;typeof c=="number"||typeof c=="bigint"?(h=c,n++):c!=null&&(typeof c.value=="number"||typeof c.value=="bigint")&&typeof c.count=="number"&&(h=c.value*(typeof c.value=="number"?c.count:BigInt(c.count)),n+=c.count),typeof h=="number"?o+=typeof o=="number"?h:BigInt(h):typeof h=="bigint"&&(o=(typeof o=="bigint"?o:BigInt(o))+h)}let a=null;n>0&&(a=o/(typeof o=="number"?n:BigInt(n)));const l=(i=(e=t.rowNode)==null?void 0:e.aggData)==null?void 0:i[(s=t.column)==null?void 0:s.getColId()];return l&&l.count===n&&l.value===a?l:{count:n,value:a,toString:function(){return typeof this.value=="number"||typeof this.value=="bigint"?this.value.toString():""},toNumber:function(){return this.value}}}var Ve=class extends Ai{constructor(t,e,s,i,r){super(e,s,r,`
                <span role="option">
                    <span ref="eDragHandle" class="ag-drag-handle ag-column-drop-cell-drag-handle" role="presentation"></span>
                    <span ref="eText" class="ag-column-drop-cell-text" aria-hidden="true"></span>
                    <ag-sort-indicator ref="eSortIndicator"></ag-sort-indicator>
                    <span ref="eButton" class="ag-column-drop-cell-button" role="presentation"></span>
                </span>
            `),this.column=t,this.dropZonePurpose=i,this.popupShowing=!1}init(){this.displayName=this.columnModel.getDisplayNameForColumn(this.column,"columnDrop"),super.init(),this.setupSort(),this.addManagedListener(this.eventService,z.EVENT_SORT_CHANGED,()=>{this.setupAria()}),this.isGroupingZone()&&this.addManagedPropertyListener("groupLockGroupColumns",()=>{this.refreshRemove(),this.refreshDraggable(),this.setupAria()})}getItem(){return this.column}getDisplayName(){return this.displayName}getTooltip(){return this.column.getColDef().headerTooltip}addAdditionalAriaInstructions(t,e){const s=this.gos.get("rowGroupPanelSuppressSort"),i=this.gos.get("functionsReadOnly");if(this.isAggregationZone()&&!i){const r=e("ariaDropZoneColumnValueItemDescription","Press ENTER to change the aggregation type");t.push(r)}if(this.isGroupingZone()&&this.column.isSortable()&&!s){const r=e("ariaDropZoneColumnGroupItemDescription","Press ENTER to sort");t.push(r)}super.addAdditionalAriaInstructions(t,e)}isDraggable(){return this.isReadOnly()}isRemovable(){return this.isReadOnly()}isReadOnly(){return!this.isGroupingAndLocked()&&!this.gos.get("functionsReadOnly")}getAriaDisplayName(){const t=this.localeService.getLocaleTextFunc(),{name:e,aggFuncName:s}=this.getColumnAndAggFuncName(),i=t("ariaDropZoneColumnComponentAggFuncSeparator"," of "),r={asc:t("ariaDropZoneColumnComponentSortAscending","ascending"),desc:t("ariaDropZoneColumnComponentSortDescending","descending")},o=this.column.getSort(),n=this.gos.get("rowGroupPanelSuppressSort");return[s&&`${s}${i}`,e,this.isGroupingZone()&&!n&&o&&`, ${r[o]}`].filter(a=>!!a).join("")}getColumnAndAggFuncName(){const t=this.displayName;let e="";if(this.isAggregationZone()){const s=this.column.getAggFunc(),i=typeof s=="string"?s:"agg";e=this.localeService.getLocaleTextFunc()(i,i)}return{name:t,aggFuncName:e}}setupSort(){const t=this.column.isSortable(),e=this.isGroupingZone();if(!(!t||!e)&&!this.gos.get("rowGroupPanelSuppressSort")){this.eSortIndicator.setupSort(this.column,!0);const s=i=>{i.preventDefault();const o=this.gos.get("multiSortKey")==="ctrl"?i.ctrlKey||i.metaKey:i.shiftKey;this.sortController.progressSort(this.column,o,"uiColumnSorted")};this.addGuiEventListener("click",s),this.addGuiEventListener("keydown",i=>{i.key===M.ENTER&&this.isGroupingZone()&&s(i)})}}getDefaultIconName(){return q.ICON_HIDE}createGetDragItem(){const{column:t}=this;return()=>{const e={};return e[t.getId()]=t.isVisible(),{columns:[t],visibleState:e}}}setupComponents(){super.setupComponents(),this.isAggregationZone()&&!this.gos.get("functionsReadOnly")&&this.addGuiEventListener("click",this.onShowAggFuncSelection.bind(this))}onKeyDown(t){super.onKeyDown(t),t.key===M.ENTER&&this.isAggregationZone()&&!this.gos.get("functionsReadOnly")&&(t.preventDefault(),this.onShowAggFuncSelection())}getDisplayValue(){const{name:t,aggFuncName:e}=this.getColumnAndAggFuncName();return this.isAggregationZone()?`${e}(${t})`:t}onShowAggFuncSelection(){if(this.popupShowing)return;this.popupShowing=!0;const t=new pt({cssIdentifier:"select-agg-func"}),e=this.aggFuncService.getFuncNames(this.column),s=this.getGui(),i=t.getGui();t.setModel({getRow:function(c){return e[c]},getRowCount:function(){return e.length}}),this.getContext().createBean(t);const r=d.loadTemplate('<div class="ag-select-agg-func-popup"></div>');r.style.top="0px",r.style.left="0px",r.appendChild(i),r.style.width=`${s.clientWidth}px`;const o=this.addManagedListener(r,"focusout",c=>{!r.contains(c.relatedTarget)&&l&&l.hideFunc()}),n=c=>{this.destroyBean(t),this.popupShowing=!1,(c==null?void 0:c.key)==="Escape"&&s.focus(),o&&o()},a=this.localeService.getLocaleTextFunc(),l=this.popupService.addPopup({modal:!0,eChild:r,closeOnEsc:!0,closedCallback:n,ariaLabel:a("ariaLabelAggregationFunction","Aggregation Function")});l&&t.setComponentCreator(this.createAggSelect.bind(this,l.hideFunc)),t.addGuiEventListener("keydown",c=>{if(c.key===M.ENTER||c.key===M.SPACE){const h=t.getLastFocusedRow();if(h==null)return;const g=t.getComponentAt(h);g&&g.selectItem()}}),this.popupService.positionPopupByComponent({type:"aggFuncSelect",eventSource:s,ePopup:r,keepWithinBounds:!0,column:this.column,position:"under"}),t.refresh();let u=e.findIndex(c=>c===this.column.getAggFunc());u===-1&&(u=0),t.focusRow(u)}createAggSelect(t,e){const s=()=>{if(t(),this.gos.get("functionsPassive")){const a={type:f.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST,columns:[this.column],aggFunc:e};this.eventService.dispatchEvent(a)}else this.columnModel.setColumnAggFunc(this.column,e,"toolPanelDragAndDrop")},i=this.localeService.getLocaleTextFunc(),r=e.toString(),o=i(r,r);return new br(s,o)}isGroupingAndLocked(){return this.isGroupingZone()&&this.columnModel.isColumnGroupingLocked(this.column)}isAggregationZone(){return this.dropZonePurpose==="aggregation"}isGroupingZone(){return this.dropZonePurpose==="rowGroup"}getDragSourceType(){return de.ToolPanel}destroy(){super.destroy(),this.column=null}};A([p("popupService")],Ve.prototype,"popupService",2);A([p("sortController")],Ve.prototype,"sortController",2);A([p("columnModel")],Ve.prototype,"columnModel",2);A([ne("aggFuncService")],Ve.prototype,"aggFuncService",2);A([E("eSortIndicator")],Ve.prototype,"eSortIndicator",2);var br=class extends L{constructor(t,e){super('<div class="ag-select-agg-func-item"/>'),this.selectItem=t,this.getGui().innerText=e,this.addGuiEventListener("click",this.selectItem)}},ft=class extends Fi{constructor(t,e){super(t),this.dropZonePurpose=e}init(t){super.init(t),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,this.refreshGui.bind(this)),this.addManagedPropertyListeners(["functionsReadOnly","rowGroupPanelSuppressSort","groupLockGroupColumns"],this.refreshGui.bind(this))}getItems(t){var e;return(e=t.columns)!=null?e:[]}isInterestedIn(t){return t===de.HeaderCell||t===de.ToolPanel}minimumAllowedNewInsertIndex(){const t=this.gos.get("groupLockGroupColumns"),e=this.columnModel.getRowGroupColumns().length;return t===-1?e:Math.min(t,e)}showOrHideColumnOnExit(t){return this.isRowGroupPanel()&&!this.gos.get("suppressRowGroupHidesColumns")&&!t.fromNudge}handleDragEnterEnd(t){if(this.showOrHideColumnOnExit(t)){const i=t.dragSource.getDragItem().columns;this.setColumnsVisible(i,!1,"uiColumnDragged")}}handleDragLeaveEnd(t){if(this.showOrHideColumnOnExit(t)){const s=t.dragSource.getDragItem();this.setColumnsVisible(s.columns,!0,"uiColumnDragged")}}setColumnsVisible(t,e,s){if(t){const i=t.filter(r=>!r.getColDef().lockVisible);this.columnModel.setColumnsVisible(i,e,s)}}isRowGroupPanel(){return this.dropZonePurpose==="rowGroup"}refreshOnDragStop(){return!this.gos.get("functionsPassive")}createPillComponent(t,e,s,i){return new Ve(t,e,s,this.dropZonePurpose,i)}};A([p("columnModel")],ft.prototype,"columnModel",2);var dt=class extends ft{constructor(t){super(t,"rowGroup")}passBeansUp(){const t=this.localeService.getLocaleTextFunc(),e=t("rowGroupColumnsEmptyMessage","Drag here to set row groups"),s=t("groups","Row Groups");super.init({icon:d.createIconNoSpan("rowGroupPanel",this.gos,null),emptyMessage:e,title:s}),this.addManagedListener(this.eventService,f.EVENT_COLUMN_ROW_GROUP_CHANGED,this.refreshGui.bind(this))}getAriaLabel(){return this.localeService.getLocaleTextFunc()("ariaRowGroupDropZonePanelLabel","Row Groups")}getTooltipParams(){const t=super.getTooltipParams();return t.location="rowGroupColumnsList",t}isItemDroppable(t,e){return this.gos.get("functionsReadOnly")||!t.isPrimary()?!1:t.isAllowRowGroup()&&(!t.isRowGroupActive()||this.isSourceEventFromTarget(e))}updateItems(t){if(this.gos.get("functionsPassive")){const e={type:f.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST,columns:t};this.eventService.dispatchEvent(e)}else this.columnModel.setRowGroupColumns(t,"toolPanelUi")}getIconName(){return this.isPotentialDndItems()?q.ICON_GROUP:q.ICON_NOT_ALLOWED}getExistingItems(){return this.columnModel.getRowGroupColumns()}};A([b],dt.prototype,"passBeansUp",1);var ut=class extends ft{constructor(t){super(t,"pivot")}passBeansUp(){const t=this.localeService.getLocaleTextFunc(),e=t("pivotColumnsEmptyMessage","Drag here to set column labels"),s=t("pivots","Column Labels");super.init({icon:d.createIconNoSpan("pivotPanel",this.gos,null),emptyMessage:e,title:s}),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,this.refresh.bind(this)),this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_CHANGED,this.refresh.bind(this)),this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.checkVisibility.bind(this)),this.refresh()}getAriaLabel(){return this.localeService.getLocaleTextFunc()("ariaPivotDropZonePanelLabel","Column Labels")}getTooltipParams(){const t=super.getTooltipParams();return t.location="pivotColumnsList",t}refresh(){this.checkVisibility(),this.refreshGui()}checkVisibility(){const t=this.columnModel.isPivotMode();if(this.isHorizontal())switch(this.gos.get("pivotPanelShow")){case"always":this.setDisplayed(t);break;case"onlyWhenPivoting":const e=this.columnModel.isPivotActive();this.setDisplayed(t&&e);break;default:this.setDisplayed(!1);break}else this.setDisplayed(t)}isItemDroppable(t,e){return this.gos.get("functionsReadOnly")||!t.isPrimary()?!1:t.isAllowPivot()&&(!t.isPivotActive()||this.isSourceEventFromTarget(e))}updateItems(t){if(this.gos.get("functionsPassive")){const e={type:f.EVENT_COLUMN_PIVOT_CHANGE_REQUEST,columns:t};this.eventService.dispatchEvent(e)}else this.columnModel.setPivotColumns(t,"toolPanelUi")}getIconName(){return this.isPotentialDndItems()?q.ICON_PIVOT:q.ICON_NOT_ALLOWED}getExistingItems(){return this.columnModel.getPivotColumns()}};A([b],ut.prototype,"passBeansUp",1);var Yt=class extends L{constructor(){super()}postConstruct(){this.setGui(this.createNorthPanel()),this.addManagedListener(this.eventService,f.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.onRowGroupChanged()),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,()=>this.onRowGroupChanged()),this.addManagedPropertyListener("rowGroupPanelShow",()=>this.onRowGroupChanged()),this.addManagedPropertyListener("pivotPanelShow",()=>this.onPivotPanelShow()),this.onRowGroupChanged()}createNorthPanel(){const t=document.createElement("div");return t.classList.add("ag-column-drop-wrapper"),d.setAriaRole(t,"presentation"),this.rowGroupComp=new dt(!0),this.createManagedBean(this.rowGroupComp),this.pivotComp=new ut(!0),this.createManagedBean(this.pivotComp),t.appendChild(this.rowGroupComp.getGui()),t.appendChild(this.pivotComp.getGui()),this.addManagedListener(this.rowGroupComp,L.EVENT_DISPLAYED_CHANGED,()=>this.onDropPanelVisible()),this.addManagedListener(this.pivotComp,L.EVENT_DISPLAYED_CHANGED,()=>this.onDropPanelVisible()),this.onDropPanelVisible(),t}onDropPanelVisible(){const t=this.rowGroupComp.isDisplayed()&&this.pivotComp.isDisplayed();this.rowGroupComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",t),this.pivotComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",t)}onRowGroupChanged(){if(!this.rowGroupComp)return;const t=this.gos.get("rowGroupPanelShow");if(t==="always")this.rowGroupComp.setDisplayed(!0);else if(t==="onlyWhenGrouping"){const e=!this.columnModel.isRowGroupEmpty();this.rowGroupComp.setDisplayed(e)}else this.rowGroupComp.setDisplayed(!1)}onPivotPanelShow(){if(!this.pivotComp)return;const t=this.gos.get("pivotPanelShow");if(t==="always")this.pivotComp.setDisplayed(!0);else if(t==="onlyWhenPivoting"){const e=this.columnModel.isPivotActive();this.pivotComp.setDisplayed(e)}else this.pivotComp.setDisplayed(!1)}};A([p("columnModel")],Yt.prototype,"columnModel",2);A([b],Yt.prototype,"postConstruct",1);var qe=class extends T{execute(t){const e=this.columnModel.isPivotMode(),s=this.filterManager.isAggregateFilterPresent()||this.filterManager.isAggregateQuickFilterPresent(),i=u=>!u.node.group,r=u=>u.node.leafGroup,o=this.gos.getGroupAggFiltering()||(e?r:i),{changedPath:n}=t,a=(u,c=!1)=>{u.childrenAfterFilter&&(u.childrenAfterAggFilter=u.childrenAfterFilter,c&&u.childrenAfterAggFilter.forEach(h=>a(h,c)),this.setAllChildrenCount(u)),u.sibling&&(u.sibling.childrenAfterAggFilter=u.childrenAfterAggFilter)},l=u=>{var c;u.childrenAfterAggFilter=((c=u.childrenAfterFilter)==null?void 0:c.filter(h=>{var g;return o({node:h})&&this.filterManager.doesRowPassAggregateFilters({rowNode:h})?(a(h,!0),!0):(g=h.childrenAfterAggFilter)==null?void 0:g.length}))||null,this.setAllChildrenCount(u),u.sibling&&(u.sibling.childrenAfterAggFilter=u.childrenAfterAggFilter)};n.forEachChangedNodeDepthFirst(s?l:a,!0)}setAllChildrenCountTreeData(t){let e=0;t.childrenAfterAggFilter.forEach(s=>{e++,e+=s.allChildrenCount}),t.setAllChildrenCount(e)}setAllChildrenCountGridGrouping(t){let e=0;t.childrenAfterAggFilter.forEach(s=>{s.group?e+=s.allChildrenCount:e++}),t.setAllChildrenCount(e)}setAllChildrenCount(t){if(!t.hasChildren()){t.setAllChildrenCount(null);return}this.gos.get("treeData")?this.setAllChildrenCountTreeData(t):this.setAllChildrenCountGridGrouping(t)}};A([p("filterManager")],qe.prototype,"filterManager",2);A([p("columnModel")],qe.prototype,"columnModel",2);qe=A([G("filterAggregatesStage")],qe);var Tr="31.3.2",pe=class Ot extends Ms{constructor(){super(`
            <div class="ag-group-filter">
                <div ref="eGroupField"></div>
                <div ref="eUnderlyingFilter"></div>
            </div>
        `)}postConstruct(){this.initialiseTabGuard({})}init(e){return this.params=e,this.validateParams(),this.updateGroups().then(()=>{this.addManagedListener(this.eventService,f.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.onColumnRowGroupChanged())})}validateParams(){const{colDef:e}=this.params;e.field&&d.warnOnce('Group Column Filter does not work with the colDef property "field". This property will be ignored.'),e.filterValueGetter&&d.warnOnce('Group Column Filter does not work with the colDef property "filterValueGetter". This property will be ignored.'),e.filterParams&&d.warnOnce('Group Column Filter does not work with the colDef property "filterParams". This property will be ignored.')}updateGroups(){const e=this.updateGroupField();return this.getUnderlyingFilters(e)}getSourceColumns(){if(this.groupColumn=this.params.column,this.gos.get("treeData"))return d.warnOnce("Group Column Filter does not work with Tree Data enabled. Please disable Tree Data, or use a different filter."),[];const e=this.columnModel.getSourceColumnsForGroupColumn(this.groupColumn);return e||(d.warnOnce("Group Column Filter only works on group columns. Please use a different filter."),[])}updateGroupField(){d.clearElement(this.eGroupField),this.eGroupFieldSelect&&this.destroyBean(this.eGroupFieldSelect);const e=this.getSourceColumns(),s=e.filter(i=>i.isFilterAllowed());return s.length?(e.length===1?(this.selectedColumn=s[0],d.setDisplayed(this.eGroupField,!1)):((!this.selectedColumn||!s.some(i=>i.getId()===this.selectedColumn.getId()))&&(this.selectedColumn=s[0]),this.createGroupFieldSelectElement(s),this.eGroupField.appendChild(this.eGroupFieldSelect.getGui()),this.eGroupField.appendChild(d.loadTemplate('<div class="ag-filter-separator"></div>')),d.setDisplayed(this.eGroupField,!0)),s):(this.selectedColumn=void 0,d.setDisplayed(this.eGroupField,!1),null)}createGroupFieldSelectElement(e){this.eGroupFieldSelect=this.createManagedBean(new yi);const s=this.localeService.getLocaleTextFunc();this.eGroupFieldSelect.setLabel(s("groupFilterSelect","Select field:")),this.eGroupFieldSelect.setLabelAlignment("top"),this.eGroupFieldSelect.addOptions(e.map(i=>{var r;return{value:i.getId(),text:(r=this.columnModel.getDisplayNameForColumn(i,"groupFilter",!1))!=null?r:void 0}})),this.eGroupFieldSelect.setValue(this.selectedColumn.getId()),this.eGroupFieldSelect.onValueChange(i=>this.updateSelectedColumn(i)),this.eGroupFieldSelect.addCssClass("ag-group-filter-field-select-wrapper"),e.length===1&&this.eGroupFieldSelect.setDisabled(!0)}getUnderlyingFilters(e){if(!e)return this.filterColumnPairs=void 0,this.selectedFilter=void 0,this.groupColumn.setFilterActive(!1,"columnRowGroupChanged"),V.resolve();const s=[],i=[];return e.forEach(r=>{const o=this.filterManager.getOrCreateFilterWrapper(r,"COLUMN_MENU");o!=null&&o.filterPromise&&s.push(o.filterPromise.then(n=>(n&&i.push({filter:n,column:r}),r.getId()===this.selectedColumn.getId()&&(this.selectedFilter=n!=null?n:void 0),n)))}),V.all(s).then(()=>{this.filterColumnPairs=i,this.groupColumn.setFilterActive(this.isFilterActive(),"columnRowGroupChanged")})}addUnderlyingFilterElement(){var e,s;if(d.clearElement(this.eUnderlyingFilter),!this.selectedColumn)return V.resolve();const i=this.createManagedBean(new bs(this.selectedColumn,"COLUMN_MENU"));return this.filterWrapperComp=i,i.hasFilter()?(this.eUnderlyingFilter.appendChild(i.getGui()),(s=(e=i.getFilter())==null?void 0:e.then(()=>{var r,o;(r=i.afterGuiAttached)==null||r.call(i,this.afterGuiAttachedParams),!((o=this.afterGuiAttachedParams)!=null&&o.suppressFocus)&&this.eGroupFieldSelect&&!this.eGroupFieldSelect.isDisabled()&&this.eGroupFieldSelect.getFocusableElement().focus()}))!=null?s:V.resolve()):V.resolve()}updateSelectedColumn(e){var s;if(!e)return;(s=this.filterWrapperComp)==null||s.afterGuiDetached(),this.destroyBean(this.filterWrapperComp);const i=this.getFilterColumnPair(e);this.selectedColumn=i==null?void 0:i.column,this.selectedFilter=i==null?void 0:i.filter,this.dispatchEvent({type:Ot.EVENT_SELECTED_COLUMN_CHANGED}),this.addUnderlyingFilterElement()}isFilterActive(){var e;return!!((e=this.filterColumnPairs)!=null&&e.some(({filter:s})=>s.isFilterActive()))}doesFilterPass(){return!0}getModel(){return null}setModel(){return V.resolve()}afterGuiAttached(e){this.afterGuiAttachedParams=e,this.addUnderlyingFilterElement()}afterGuiDetached(){var e,s;d.clearElement(this.eUnderlyingFilter),(s=(e=this.selectedFilter)==null?void 0:e.afterGuiDetached)==null||s.call(e)}onColumnRowGroupChanged(){this.updateGroups().then(()=>{this.dispatchEvent({type:Ot.EVENT_COLUMN_ROW_GROUP_CHANGED}),this.eventService.dispatchEvent({type:"filterAllowedUpdated"})})}getFilterColumnPair(e){var s;if(!!e)return(s=this.filterColumnPairs)==null?void 0:s.find(({column:i})=>i.getId()===e)}getSelectedFilter(){return this.selectedFilter}getSelectedColumn(){return this.selectedColumn}isFilterAllowed(){return!!this.selectedColumn}destroy(){super.destroy()}};pe.EVENT_COLUMN_ROW_GROUP_CHANGED="columnRowGroupChanged";pe.EVENT_SELECTED_COLUMN_CHANGED="selectedColumnChanged";A([p("filterManager")],pe.prototype,"filterManager",2);A([p("columnModel")],pe.prototype,"columnModel",2);A([E("eGroupField")],pe.prototype,"eGroupField",2);A([E("eUnderlyingFilter")],pe.prototype,"eUnderlyingFilter",2);A([b],pe.prototype,"postConstruct",1);var Rt=pe,vt=class extends L{constructor(){super(`
            <div ref="eFloatingFilter" class="ag-group-floating-filter ag-floating-filter-input" role="presentation"></div>
        `),this.haveAddedColumnListeners=!1}init(t){this.params=t;const e=this.gos.get("groupDisplayType")==="multipleColumns";return new V(s=>{this.params.parentFilterInstance(i=>{this.parentFilterInstance=i,e?this.setupUnderlyingFloatingFilterElement().then(()=>s()):(this.setupReadOnlyFloatingFilterElement(),s())})}).then(()=>{this.addManagedListener(this.parentFilterInstance,Rt.EVENT_SELECTED_COLUMN_CHANGED,()=>this.onSelectedColumnChanged()),this.addManagedListener(this.parentFilterInstance,Rt.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.onColumnRowGroupChanged())})}onParamsUpdated(t){this.refresh(t)}refresh(t){this.params=t,this.setParams()}setParams(){var t;const e=this.columnModel.getDisplayNameForColumn(this.params.column,"header",!0),s=this.localeService.getLocaleTextFunc();(t=this.eFloatingFilterText)==null||t.setInputAriaLabel(`${e} ${s("ariaFilterInput","Filter Input")}`)}setupReadOnlyFloatingFilterElement(){this.eFloatingFilterText||(this.eFloatingFilterText=this.createManagedBean(new Ss),this.eFloatingFilterText.setDisabled(!0).addGuiEventListener("click",()=>this.params.showParentFilter()),this.setParams()),this.updateDisplayedValue(),this.eFloatingFilter.appendChild(this.eFloatingFilterText.getGui())}setupUnderlyingFloatingFilterElement(){this.showingUnderlyingFloatingFilter=!1,this.underlyingFloatingFilter=void 0,d.clearElement(this.eFloatingFilter);const t=this.parentFilterInstance.getSelectedColumn();if(t&&!t.isVisible()){const e=this.filterManager.getFloatingFilterCompDetails(t,this.params.showParentFilter);if(e)return this.compDetails=e,this.haveAddedColumnListeners||(this.haveAddedColumnListeners=!0,this.addManagedListener(t,z.EVENT_VISIBLE_CHANGED,this.onColumnVisibleChanged.bind(this)),this.addManagedListener(t,z.EVENT_COL_DEF_CHANGED,this.onColDefChanged.bind(this))),e.newAgStackInstance().then(s=>{var i,r;this.underlyingFloatingFilter=s,(r=this.underlyingFloatingFilter)==null||r.onParentModelChanged((i=this.parentFilterInstance.getSelectedFilter())==null?void 0:i.getModel()),this.appendChild(s.getGui()),this.showingUnderlyingFloatingFilter=!0})}return this.setupReadOnlyFloatingFilterElement(),V.resolve()}onColumnVisibleChanged(){this.setupUnderlyingFloatingFilterElement()}onColDefChanged(t){var e,s,i;if(!t.column)return;const r=this.filterManager.getFloatingFilterCompDetails(t.column,this.params.showParentFilter);r&&((e=this.underlyingFloatingFilter)!=null&&e.refresh?this.underlyingFloatingFilter.refresh(r.params):(i=(s=this.underlyingFloatingFilter)==null?void 0:s.onParamsUpdated)==null||i.call(s,r.params))}onParentModelChanged(t,e){var s,i;this.showingUnderlyingFloatingFilter?(i=this.underlyingFloatingFilter)==null||i.onParentModelChanged((s=this.parentFilterInstance.getSelectedFilter())==null?void 0:s.getModel(),e):this.updateDisplayedValue()}updateDisplayedValue(){if(!this.parentFilterInstance||!this.eFloatingFilterText)return;const t=this.parentFilterInstance.getSelectedFilter();if(!t){this.eFloatingFilterText.setValue(""),this.eFloatingFilterText.setDisplayed(!1);return}if(this.eFloatingFilterText.setDisplayed(!0),t.getModelAsString){const e=t.getModel();this.eFloatingFilterText.setValue(e==null?"":t.getModelAsString(e))}else this.eFloatingFilterText.setValue("")}onSelectedColumnChanged(){this.showingUnderlyingFloatingFilter||this.updateDisplayedValue()}onColumnRowGroupChanged(){this.showingUnderlyingFloatingFilter||this.updateDisplayedValue()}destroy(){super.destroy()}};A([p("columnModel")],vt.prototype,"columnModel",2);A([p("filterManager")],vt.prototype,"filterManager",2);A([E("eFloatingFilter")],vt.prototype,"eFloatingFilter",2);var Dr={version:Tr,moduleName:x.RowGroupingModule,beans:[we,qe,ue,ce,oe,_],agStackComponents:[{componentName:"AgGridHeaderDropZones",componentClass:Yt}],userComponents:[{componentName:"agGroupColumnFilter",componentClass:Rt},{componentName:"agGroupColumnFloatingFilter",componentClass:vt}],dependantModules:[_e]},Nt=class extends ft{constructor(t){super(t,"aggregation")}passBeansUp(){const t=this.localeService.getLocaleTextFunc(),e=t("valueColumnsEmptyMessage","Drag here to aggregate"),s=t("values","Values");super.init({icon:d.createIconNoSpan("valuePanel",this.gos,null),emptyMessage:e,title:s}),this.addManagedListener(this.eventService,f.EVENT_COLUMN_VALUE_CHANGED,this.refreshGui.bind(this))}getAriaLabel(){return this.localeService.getLocaleTextFunc()("ariaValuesDropZonePanelLabel","Values")}getTooltipParams(){const t=super.getTooltipParams();return t.location="valueColumnsList",t}getIconName(){return this.isPotentialDndItems()?q.ICON_AGGREGATE:q.ICON_NOT_ALLOWED}isItemDroppable(t,e){return this.gos.get("functionsReadOnly")||!t.isPrimary()?!1:t.isAllowValue()&&(!t.isValueActive()||this.isSourceEventFromTarget(e))}updateItems(t){if(this.gos.get("functionsPassive")){const e={type:f.EVENT_COLUMN_VALUE_CHANGE_REQUEST,columns:t};this.eventService.dispatchEvent(e)}else this.columnModel.setValueColumns(t,"toolPanelUi")}getExistingItems(){return this.columnModel.getValueColumns()}};A([b],Nt.prototype,"passBeansUp",1);var Bs=Object.defineProperty,Lr=Object.defineProperties,wr=Object.getOwnPropertyDescriptor,xr=Object.getOwnPropertyDescriptors,cs=Object.getOwnPropertySymbols,Gr=Object.prototype.hasOwnProperty,Ir=Object.prototype.propertyIsEnumerable,hs=(t,e,s)=>e in t?Bs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_r=(t,e)=>{for(var s in e||(e={}))Gr.call(e,s)&&hs(t,s,e[s]);if(cs)for(var s of cs(e))Ir.call(e,s)&&hs(t,s,e[s]);return t},Vr=(t,e)=>Lr(t,xr(e)),O=(t,e,s,i)=>{for(var r=i>1?void 0:i?wr(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(r=(i?n(e,s,r):n(r))||r);return i&&r&&Bs(e,s,r),r},Ct=class extends L{constructor(){super('<div class="ag-tool-panel-horizontal-resize"></div>'),this.minWidth=100,this.maxWidth=null}setElementToResize(t){this.elementToResize=t}postConstruct(){const t=this.horizontalResizeService.addResizeBar({eResizeBar:this.getGui(),dragStartPixels:1,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this),onResizeEnd:this.onResizeEnd.bind(this)});this.addDestroyFunc(t),this.setInverted(this.gos.get("enableRtl"))}dispatchResizeEvent(t,e,s){const i={type:f.EVENT_TOOL_PANEL_SIZE_CHANGED,width:s,started:t,ended:e};this.eventService.dispatchEvent(i)}onResizeStart(){this.startingWidth=this.elementToResize.offsetWidth,this.dispatchResizeEvent(!0,!1,this.startingWidth)}onResizeEnd(t){return this.onResizing(t,!0)}onResizing(t,e=!1){const s=this.inverted?-1:1;let i=Math.max(this.minWidth,Math.floor(this.startingWidth-t*s));this.maxWidth!=null&&(i=Math.min(this.maxWidth,i)),this.elementToResize.style.width=`${i}px`,this.dispatchResizeEvent(!1,e,i)}setInverted(t){this.inverted=t}setMaxWidth(t){this.maxWidth=t}setMinWidth(t){t!=null?this.minWidth=t:this.minWidth=100}};O([p("horizontalResizeService")],Ct.prototype,"horizontalResizeService",2);O([b],Ct.prototype,"postConstruct",1);var Oe=class ks extends L{constructor(e){super(),this.toolPanelDef=e}getToolPanelId(){return this.toolPanelDef.id}postConstruct(){const e=this.createTemplate();this.setTemplate(e),this.setLabel(),this.setIcon(),this.addManagedListener(this.eToggleButton,"click",this.onButtonPressed.bind(this)),this.eToggleButton.setAttribute("id",`ag-${this.getCompId()}-button`)}createTemplate(){return`<div class="ag-side-button" role="presentation">
                <button type="button" ref="eToggleButton" tabindex="-1" role="tab" aria-expanded="false" class="ag-button ag-side-button-button">
                    <div ref="eIconWrapper" class="ag-side-button-icon-wrapper" aria-hidden="true"></div>
                    <span ref ="eLabel" class="ag-side-button-label"></span>
                </button>
            </div>`}setLabel(){const e=this.localeService.getLocaleTextFunc(),s=this.toolPanelDef,i=e(s.labelKey,s.labelDefault);this.eLabel.innerText=i}setIcon(){this.eIconWrapper.insertAdjacentElement("afterbegin",d.createIconNoSpan(this.toolPanelDef.iconKey,this.gos))}onButtonPressed(){this.dispatchEvent({type:ks.EVENT_TOGGLE_BUTTON_CLICKED})}setSelected(e){this.addOrRemoveCssClass("ag-selected",e),d.setAriaExpanded(this.eToggleButton,e)}getButtonElement(){return this.eToggleButton}};Oe.EVENT_TOGGLE_BUTTON_CLICKED="toggleButtonClicked";O([E("eToggleButton")],Oe.prototype,"eToggleButton",2);O([E("eIconWrapper")],Oe.prototype,"eIconWrapper",2);O([E("eLabel")],Oe.prototype,"eLabel",2);O([b],Oe.prototype,"postConstruct",1);var ps=Oe,Me=class Bt extends L{constructor(){super(Bt.TEMPLATE),this.buttonComps=[]}postConstruct(){this.addManagedListener(this.getFocusableElement(),"keydown",this.handleKeyDown.bind(this))}handleKeyDown(e){if(e.key!==M.TAB||!e.shiftKey)return;const s=d.last(this.columnModel.getAllDisplayedColumns());this.focusService.focusGridView(s,!0)&&e.preventDefault()}setActiveButton(e){this.buttonComps.forEach(s=>{s.setSelected(e===s.getToolPanelId())})}addButtonComp(e){const s=this.createBean(new ps(e));return this.buttonComps.push(s),this.appendChild(s),s.addEventListener(ps.EVENT_TOGGLE_BUTTON_CLICKED,()=>{this.dispatchEvent({type:Bt.EVENT_SIDE_BAR_BUTTON_CLICKED,toolPanelId:e.id})}),s}clearButtons(){this.buttonComps=this.destroyBeans(this.buttonComps),d.clearElement(this.getGui())}};Me.EVENT_SIDE_BAR_BUTTON_CLICKED="sideBarButtonClicked";Me.TEMPLATE='<div class="ag-side-buttons" role="tablist"></div>';O([p("focusService")],Me.prototype,"focusService",2);O([p("columnModel")],Me.prototype,"columnModel",2);O([b],Me.prototype,"postConstruct",1);O([Ts],Me.prototype,"clearButtons",1);var Us=Me,De=class te{static parse(e){if(!e)return;if(e===!0)return{toolPanels:[te.DEFAULT_COLUMN_COMP,te.DEFAULT_FILTER_COMP],defaultToolPanel:"columns"};if(typeof e=="string")return te.parse([e]);if(Array.isArray(e)){const i=[];return e.forEach(r=>{const o=te.DEFAULT_BY_KEY[r];if(!o){console.warn(`AG Grid: the key ${r} is not a valid key for specifying a tool panel, valid keys are: ${Object.keys(te.DEFAULT_BY_KEY).join(",")}`);return}i.push(o)}),i.length===0?void 0:{toolPanels:i,defaultToolPanel:i[0].id}}return{toolPanels:te.parseComponents(e.toolPanels),defaultToolPanel:e.defaultToolPanel,hiddenByDefault:e.hiddenByDefault,position:e.position}}static parseComponents(e){const s=[];return e&&e.forEach(i=>{let r=null;if(typeof i=="string"){const o=te.DEFAULT_BY_KEY[i];if(!o){console.warn(`AG Grid: the key ${i} is not a valid key for specifying a tool panel, valid keys are: ${Object.keys(te.DEFAULT_BY_KEY).join(",")}`);return}r=o}else r=i;s.push(r)}),s}};De.DEFAULT_COLUMN_COMP={id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"};De.DEFAULT_FILTER_COMP={id:"filters",labelDefault:"Filters",labelKey:"filters",iconKey:"filter",toolPanel:"agFiltersToolPanel"};De.DEFAULT_BY_KEY={columns:De.DEFAULT_COLUMN_COMP,filters:De.DEFAULT_FILTER_COMP};var gs=De,Et=class Hs extends L{constructor(){super(Hs.TEMPLATE)}setupResize(){const e=this.getGui(),s=this.resizeBar=this.createManagedBean(new Ct);e.setAttribute("id",`ag-${this.getCompId()}`),s.setElementToResize(e),this.appendChild(s)}getToolPanelId(){return this.toolPanelId}setToolPanelDef(e,s){const{id:i,minWidth:r,maxWidth:o,width:n}=e;this.toolPanelId=i,this.width=n;const a=this.userComponentFactory.getToolPanelCompDetails(e,s),l=a.newAgStackInstance();if(this.params=a.params,l==null){console.warn(`AG Grid: error processing tool panel component ${i}. You need to specify 'toolPanel'`);return}l.then(this.setToolPanelComponent.bind(this)),r!=null&&this.resizeBar.setMinWidth(r),o!=null&&this.resizeBar.setMaxWidth(o)}setToolPanelComponent(e){this.toolPanelCompInstance=e,this.appendChild(e.getGui()),this.addDestroyFunc(()=>{this.destroyBean(e)}),this.width&&(this.getGui().style.width=`${this.width}px`)}getToolPanelInstance(){return this.toolPanelCompInstance}setResizerSizerSide(e){const s=this.gos.get("enableRtl"),i=e==="left",r=s?i:!i;this.resizeBar.setInverted(r)}refresh(){this.toolPanelCompInstance.refresh(this.params)}};Et.TEMPLATE='<div class="ag-tool-panel-wrapper" role="tabpanel"/>';O([p("userComponentFactory")],Et.prototype,"userComponentFactory",2);O([b],Et.prototype,"setupResize",1);var Or=Et,Pe=class Ks extends L{constructor(){super(Ks.TEMPLATE),this.toolPanelWrappers=[]}postConstruct(){var e;this.sideBarButtonsComp.addEventListener(Us.EVENT_SIDE_BAR_BUTTON_CLICKED,this.onToolPanelButtonClicked.bind(this));const{sideBar:s}=(e=this.gos.get("initialState"))!=null?e:{};this.setSideBarDef({sideBarDef:gs.parse(this.gos.get("sideBar")),sideBarState:s}),this.addManagedPropertyListener("sideBar",this.onSideBarUpdated.bind(this)),this.sideBarService.registerSideBarComp(this),this.createManagedBean(new Si(this.getFocusableElement(),{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this)}))}onTabKeyDown(e){if(e.defaultPrevented)return;const{focusService:s,sideBarButtonsComp:i}=this,r=this.getGui(),o=i.getGui(),n=this.gos.getActiveDomElement(),a=r.querySelector(".ag-tool-panel-wrapper:not(.ag-hidden)"),l=e.target;if(!a)return;if(o.contains(n)){s.focusInto(a,e.shiftKey)&&e.preventDefault();return}if(!e.shiftKey)return;let u=null;a.contains(n)?u=this.focusService.findNextFocusableElement(a,void 0,!0):s.isTargetUnderManagedComponent(a,l)&&e.shiftKey&&(u=this.focusService.findFocusableElementBeforeTabGuard(a,l)),u||(u=o.querySelector(".ag-selected button")),u&&u!==e.target&&(e.preventDefault(),u.focus())}handleKeyDown(e){const s=this.gos.getActiveDomElement();if(!this.sideBarButtonsComp.getGui().contains(s))return;const i=this.sideBarButtonsComp.getGui(),r=Array.prototype.slice.call(i.querySelectorAll(".ag-side-button")),o=r.findIndex(l=>l.contains(s));let n=null;switch(e.key){case M.LEFT:case M.UP:n=Math.max(0,o-1);break;case M.RIGHT:case M.DOWN:n=Math.min(o+1,r.length-1);break}if(n===null)return;const a=r[n].querySelector("button");a&&(a.focus(),e.preventDefault())}onToolPanelButtonClicked(e){const s=e.toolPanelId;this.openedItem()===s?this.openToolPanel(void 0,"sideBarButtonClicked"):this.openToolPanel(s,"sideBarButtonClicked")}clearDownUi(){this.sideBarButtonsComp.clearButtons(),this.destroyToolPanelWrappers()}setSideBarDef({sideBarDef:e,sideBarState:s,existingToolPanelWrappers:i}){if(this.setDisplayed(!1),this.sideBar=e,!!this.sideBar&&!!this.sideBar.toolPanels){const r=this.sideBar.toolPanels;if(this.createToolPanelsAndSideButtons(r,s,i),!this.toolPanelWrappers.length)return;const o=s?s.visible:!this.sideBar.hiddenByDefault;if(this.setDisplayed(o),this.setSideBarPosition(s?s.position:this.sideBar.position),o)if(s){const{openToolPanel:n}=s;n&&this.openToolPanel(n,"sideBarInitializing")}else this.openToolPanel(this.sideBar.defaultToolPanel,"sideBarInitializing")}}getDef(){return this.sideBar}setSideBarPosition(e){e||(e="right"),this.position=e;const s=e==="left",i=s?"right":"left";return this.addOrRemoveCssClass("ag-side-bar-left",s),this.addOrRemoveCssClass("ag-side-bar-right",!s),this.toolPanelWrappers.forEach(r=>{r.setResizerSizerSide(i)}),this.eventService.dispatchEvent({type:f.EVENT_SIDE_BAR_UPDATED}),this}setDisplayed(e,s){super.setDisplayed(e,s),this.eventService.dispatchEvent({type:f.EVENT_SIDE_BAR_UPDATED})}getState(){const e={};return this.toolPanelWrappers.forEach(s=>{var i,r;e[s.getToolPanelId()]=(r=(i=s.getToolPanelInstance())==null?void 0:i.getState)==null?void 0:r.call(i)}),{visible:this.isDisplayed(),position:this.position,openToolPanel:this.openedItem(),toolPanels:e}}createToolPanelsAndSideButtons(e,s,i){var r;for(const o of e)this.createToolPanelAndSideButton(o,(r=s==null?void 0:s.toolPanels)==null?void 0:r[o.id],i==null?void 0:i[o.id])}validateDef(e){if(e.id==null)return console.warn("AG Grid: please review all your toolPanel components, it seems like at least one of them doesn't have an id"),!1;if(e.toolPanel==="agColumnsToolPanel"&&!N.__assertRegistered(x.ColumnsToolPanelModule,"Column Tool Panel",this.context.getGridId()))return!1;if(e.toolPanel==="agFiltersToolPanel"){if(!N.__assertRegistered(x.FiltersToolPanelModule,"Filters Tool Panel",this.context.getGridId()))return!1;if(this.filterManager.isAdvancedFilterEnabled())return d.warnOnce("Advanced Filter does not work with Filters Tool Panel. Filters Tool Panel has been disabled."),!1}return!0}createToolPanelAndSideButton(e,s,i){if(!this.validateDef(e))return;const r=this.sideBarButtonsComp.addButtonComp(e);let o;i?o=i:(o=this.getContext().createBean(new Or),o.setToolPanelDef(e,{initialState:s,onStateUpdated:()=>this.eventService.dispatchEvent({type:f.EVENT_SIDE_BAR_UPDATED})})),o.setDisplayed(!1);const n=o.getGui();this.appendChild(n),this.toolPanelWrappers.push(o),d.setAriaControls(r.getButtonElement(),n)}refresh(){this.toolPanelWrappers.forEach(e=>e.refresh())}openToolPanel(e,s="api"){const i=this.openedItem();if(i===e)return;this.toolPanelWrappers.forEach(n=>{const a=e===n.getToolPanelId();n.setDisplayed(a)});const r=this.openedItem();i!==r&&(this.sideBarButtonsComp.setActiveButton(e),this.raiseToolPanelVisibleEvent(e,i!=null?i:void 0,s))}getToolPanelInstance(e){const s=this.toolPanelWrappers.filter(i=>i.getToolPanelId()===e)[0];if(!s){console.warn(`AG Grid: unable to lookup Tool Panel as invalid key supplied: ${e}`);return}return s.getToolPanelInstance()}raiseToolPanelVisibleEvent(e,s,i){const r=!!e&&!!s;if(s){const o={type:f.EVENT_TOOL_PANEL_VISIBLE_CHANGED,source:i,key:s,visible:!1,switchingToolPanel:r};this.eventService.dispatchEvent(o)}if(e){const o={type:f.EVENT_TOOL_PANEL_VISIBLE_CHANGED,source:i,key:e,visible:!0,switchingToolPanel:r};this.eventService.dispatchEvent(o)}}close(e="api"){this.openToolPanel(void 0,e)}isToolPanelShowing(){return!!this.openedItem()}openedItem(){let e=null;return this.toolPanelWrappers.forEach(s=>{s.isDisplayed()&&(e=s.getToolPanelId())}),e}onSideBarUpdated(){var e;const s=gs.parse(this.gos.get("sideBar"));let i={};s&&this.sideBar&&((e=s.toolPanels)==null||e.forEach(r=>{var o,n;const{id:a}=r;if(!a)return;const l=(o=this.sideBar.toolPanels)==null?void 0:o.find(g=>g.id===a);if(!l||r.toolPanel!==l.toolPanel)return;const u=this.toolPanelWrappers.find(g=>g.getToolPanelId()===a);if(!u)return;const c=this.gos.addGridCommonParams(Vr(_r({},(n=r.toolPanelParams)!=null?n:{}),{onStateUpdated:()=>this.eventService.dispatchEvent({type:f.EVENT_SIDE_BAR_UPDATED})}));u.getToolPanelInstance().refresh(c)===!0&&(this.toolPanelWrappers=this.toolPanelWrappers.filter(g=>g!==u),d.removeFromParent(u.getGui()),i[a]=u)})),this.clearDownUi(),this.setSideBarDef({sideBarDef:s,existingToolPanelWrappers:i})}destroyToolPanelWrappers(){this.toolPanelWrappers.forEach(e=>{d.removeFromParent(e.getGui()),this.destroyBean(e)}),this.toolPanelWrappers.length=0}destroy(){this.destroyToolPanelWrappers(),super.destroy()}};Pe.TEMPLATE=`<div class="ag-side-bar ag-unselectable">
            <ag-side-bar-buttons ref="sideBarButtons"></ag-side-bar-buttons>
        </div>`;O([p("focusService")],Pe.prototype,"focusService",2);O([p("filterManager")],Pe.prototype,"filterManager",2);O([p("sideBarService")],Pe.prototype,"sideBarService",2);O([E("sideBarButtons")],Pe.prototype,"sideBarButtonsComp",2);O([b],Pe.prototype,"postConstruct",1);var Rr=Pe,ct=class extends T{constructor(){super(...arguments),this.isColGroupDef=t=>t&&typeof t.children!="undefined",this.getId=t=>this.isColGroupDef(t)?t.groupId:t.colId}createColumnTree(t){const e=[],s=(r,o)=>{if(this.isColGroupDef(r)){const n=r,a=typeof n.groupId!="undefined"?n.groupId:n.headerName,l=new $e(n,a,!1,o),u=[];return n.children.forEach(c=>{const h=s(c,o+1);h&&u.push(h)}),l.setChildren(u),l}else{const n=r,a=n.colId?n.colId:n.field,l=this.columnModel.getPrimaryColumn(a);return l||e.push(n),l}},i=[];return t.forEach(r=>{const o=s(r,0);o&&i.push(o)}),e.length>0&&console.warn("AG Grid: unable to find grid columns for the supplied colDef(s):",e),i}syncLayoutWithGrid(t){const e=this.getLeafPathTrees(),s=this.mergeLeafPathTrees(e);t(s)}getLeafPathTrees(){const t=(i,r)=>{let o;if(i instanceof $e)if(i.isPadding())o=r;else{const a=Object.assign({},i.getColGroupDef());a.groupId=i.getGroupId(),a.children=[r],o=a}else{const a=Object.assign({},i.getColDef());a.colId=i.getColId(),o=a}const n=i.getOriginalParent();return n?t(n,o):o};return this.columnModel.getAllGridColumns().filter(i=>{const r=i.getColDef();return i.isPrimary()&&!r.showRowGroup}).map(i=>t(i,i.getColDef()))}mergeLeafPathTrees(t){const e=(r,o)=>this.isColGroupDef(r)&&this.isColGroupDef(o)&&this.getId(r)===this.getId(o),s=(r,o)=>{if(!this.isColGroupDef(o))return r;const n=r,a=o;return a.children&&a.groupId&&this.addChildrenToGroup(n,a.groupId,a.children[0])||a.children.forEach(l=>s(n,l)),n},i=[];for(let r=1;r<=t.length;r++){const o=t[r-1],n=t[r];e(o,n)?t[r]=s(o,n):i.push(o)}return i}addChildrenToGroup(t,e,s){const i=(n,a)=>{const l=n.children.map(this.getId),u=d.includes(l,this.getId(a)),c=d.last(n.children),h=c&&this.getId(c)!==this.getId(a);return u&&h};if(!this.isColGroupDef(t))return!0;const r=t,o=s;if(i(r,o))return r.children.push(o),!0;if(r.groupId===e){const n=r.children.map(this.getId);if(!d.includes(n,this.getId(o)))return r.children.push(o),!0}return r.children.forEach(n=>this.addChildrenToGroup(n,e,s)),!1}};O([p("columnModel")],ct.prototype,"columnModel",2);ct=O([G("toolPanelColDefService")],ct);var Nr="31.3.2",kt=class extends T{registerSideBarComp(t){this.sideBarComp=t}getSideBarComp(){return this.sideBarComp}};kt=O([G("sideBarService")],kt);var Br={version:Nr,moduleName:x.SideBarModule,beans:[ct,kt],agStackComponents:[{componentName:"AgHorizontalResize",componentClass:Ct},{componentName:"AgSideBar",componentClass:Rr},{componentName:"AgSideBarButtons",componentClass:Us}],dependantModules:[_e]},Ws=Object.defineProperty,kr=Object.getOwnPropertyDescriptor,ms=Object.getOwnPropertySymbols,Ur=Object.prototype.hasOwnProperty,Hr=Object.prototype.propertyIsEnumerable,fs=(t,e,s)=>e in t?Ws(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,vs=(t,e)=>{for(var s in e||(e={}))Ur.call(e,s)&&fs(t,s,e[s]);if(ms)for(var s of ms(e))Hr.call(e,s)&&fs(t,s,e[s]);return t},F=(t,e,s,i)=>{for(var r=i>1?void 0:i?kr(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(r=(i?n(e,s,r):n(r))||r);return i&&r&&Ws(e,s,r),r},ge=class ot extends L{constructor(){super(ot.TEMPLATE)}postConstruct(){this.createExpandIcons(),this.addManagedListener(this.eExpand,"click",this.onExpandClicked.bind(this)),this.addManagedListener(this.eExpand,"keydown",s=>{s.key===M.SPACE&&(s.preventDefault(),this.onExpandClicked())}),this.addManagedListener(this.eSelect.getInputElement(),"click",this.onSelectClicked.bind(this)),this.addManagedPropertyListener("functionsReadOnly",()=>this.onFunctionsReadOnlyPropChanged()),this.eFilterTextField.setAutoComplete(!1).onValueChange(()=>this.onFilterTextChanged()),this.addManagedListener(this.eFilterTextField.getInputElement(),"keydown",this.onMiniFilterKeyDown.bind(this)),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,this.showOrHideOptions.bind(this));const e=this.localeService.getLocaleTextFunc();this.eSelect.setInputAriaLabel(e("ariaColumnSelectAll","Toggle Select All Columns")),this.eFilterTextField.setInputAriaLabel(e("ariaFilterColumnsInput","Filter Columns Input")),this.activateTabIndex([this.eExpand])}onFunctionsReadOnlyPropChanged(){const e=this.gos.get("functionsReadOnly");this.eSelect.setReadOnly(e),this.eSelect.addOrRemoveCssClass("ag-column-select-column-readonly",e)}init(e){this.params=e;const s=this.gos.get("functionsReadOnly");this.eSelect.setReadOnly(s),this.eSelect.addOrRemoveCssClass("ag-column-select-column-readonly",s),this.columnModel.isReady()&&this.showOrHideOptions()}createExpandIcons(){this.eExpand.appendChild(this.eExpandChecked=d.createIconNoSpan("columnSelectOpen",this.gos)),this.eExpand.appendChild(this.eExpandUnchecked=d.createIconNoSpan("columnSelectClosed",this.gos)),this.eExpand.appendChild(this.eExpandIndeterminate=d.createIconNoSpan("columnSelectIndeterminate",this.gos)),this.setExpandState(0)}showOrHideOptions(){const e=!this.params.suppressColumnFilter,s=!this.params.suppressColumnSelectAll,i=!this.params.suppressColumnExpandAll,r=this.columnModel.isPrimaryColumnGroupsPresent(),o=this.localeService.getLocaleTextFunc();this.eFilterTextField.setInputPlaceholder(o("searchOoo","Search...")),d.setDisplayed(this.eFilterTextField.getGui(),e),d.setDisplayed(this.eSelect.getGui(),s),d.setDisplayed(this.eExpand,i&&r)}onFilterTextChanged(){this.onFilterTextChangedDebounced||(this.onFilterTextChangedDebounced=d.debounce(()=>{const e=this.eFilterTextField.getValue();this.dispatchEvent({type:"filterChanged",filterText:e})},ot.DEBOUNCE_DELAY)),this.onFilterTextChangedDebounced()}onMiniFilterKeyDown(e){e.key===M.ENTER&&setTimeout(()=>this.onSelectClicked(),ot.DEBOUNCE_DELAY)}onSelectClicked(){this.dispatchEvent({type:this.selectState?"unselectAll":"selectAll"})}onExpandClicked(){this.dispatchEvent({type:this.expandState===0?"collapseAll":"expandAll"})}setExpandState(e){this.expandState=e,d.setDisplayed(this.eExpandChecked,this.expandState===0),d.setDisplayed(this.eExpandUnchecked,this.expandState===1),d.setDisplayed(this.eExpandIndeterminate,this.expandState===2)}setSelectionState(e){this.selectState=e,this.eSelect.setValue(this.selectState)}};ge.DEBOUNCE_DELAY=300;ge.TEMPLATE=`<div class="ag-column-select-header" role="presentation">
            <div ref="eExpand" class="ag-column-select-header-icon"></div>
            <ag-checkbox ref="eSelect" class="ag-column-select-header-checkbox"></ag-checkbox>
            <ag-input-text-field class="ag-column-select-header-filter-wrapper" ref="eFilterTextField"></ag-input-text-field>
        </div>`;F([p("columnModel")],ge.prototype,"columnModel",2);F([E("eExpand")],ge.prototype,"eExpand",2);F([E("eSelect")],ge.prototype,"eSelect",2);F([E("eFilterTextField")],ge.prototype,"eFilterTextField",2);F([b],ge.prototype,"postConstruct",1);var Kr=ge,$s=class js{constructor(e,s,i,r=!1,o){this.eventService=new Ls,this.displayName=e,this.dept=i,this.group=r,r?(this.columnGroup=s,this.expanded=o,this.children=[]):this.column=s}isGroup(){return this.group}getDisplayName(){return this.displayName}getColumnGroup(){return this.columnGroup}getColumn(){return this.column}getDept(){return this.dept}isExpanded(){return!!this.expanded}getChildren(){return this.children}isPassesFilter(){return this.passesFilter}setExpanded(e){e!==this.expanded&&(this.expanded=e,this.eventService.dispatchEvent({type:js.EVENT_EXPANDED_CHANGED}))}setPassesFilter(e){this.passesFilter=e}addEventListener(e,s){this.eventService.addEventListener(e,s)}removeEventListener(e,s){this.eventService.removeEventListener(e,s)}};$s.EVENT_EXPANDED_CHANGED="expandedChanged";var Ke=$s,Re=class extends L{constructor(t,e,s){super('<div class="ag-menu"></div>'),this.column=t,this.mouseEvent=e,this.parentEl=s,this.displayName=null}postConstruct(){if(this.initializeProperties(this.column),this.buildMenuItemMap(),this.column instanceof z?this.displayName=this.columnModel.getDisplayNameForColumn(this.column,"columnToolPanel"):this.displayName=this.columnModel.getDisplayNameForProvidedColumnGroup(null,this.column,"columnToolPanel"),this.isActive()){this.mouseEvent.preventDefault();const t=this.getMappedMenuItems();if(t.length===0)return;this.displayContextMenu(t)}}initializeProperties(t){t instanceof $e?this.columns=t.getLeafColumns():this.columns=[t],this.allowGrouping=this.columns.some(e=>e.isPrimary()&&e.isAllowRowGroup()),this.allowValues=this.columns.some(e=>e.isPrimary()&&e.isAllowValue()),this.allowPivoting=this.columnModel.isPivotMode()&&this.columns.some(e=>e.isPrimary()&&e.isAllowPivot())}buildMenuItemMap(){const t=this.localeService.getLocaleTextFunc();this.menuItemMap=new Map,this.menuItemMap.set("rowGroup",{allowedFunction:e=>e.isPrimary()&&e.isAllowRowGroup()&&!this.columnModel.isColumnGroupingLocked(e),activeFunction:e=>e.isRowGroupActive(),activateLabel:()=>`${t("groupBy","Group by")} ${this.displayName}`,deactivateLabel:()=>`${t("ungroupBy","Un-Group by")} ${this.displayName}`,activateFunction:()=>{const e=this.columnModel.getRowGroupColumns();this.columnModel.setRowGroupColumns(this.addColumnsToList(e),"toolPanelUi")},deActivateFunction:()=>{const e=this.columnModel.getRowGroupColumns();this.columnModel.setRowGroupColumns(this.removeColumnsFromList(e),"toolPanelUi")},addIcon:"menuAddRowGroup",removeIcon:"menuRemoveRowGroup"}),this.menuItemMap.set("value",{allowedFunction:e=>e.isPrimary()&&e.isAllowValue(),activeFunction:e=>e.isValueActive(),activateLabel:()=>t("addToValues",`Add ${this.displayName} to values`,[this.displayName]),deactivateLabel:()=>t("removeFromValues",`Remove ${this.displayName} from values`,[this.displayName]),activateFunction:()=>{const e=this.columnModel.getValueColumns();this.columnModel.setValueColumns(this.addColumnsToList(e),"toolPanelUi")},deActivateFunction:()=>{const e=this.columnModel.getValueColumns();this.columnModel.setValueColumns(this.removeColumnsFromList(e),"toolPanelUi")},addIcon:"valuePanel",removeIcon:"valuePanel"}),this.menuItemMap.set("pivot",{allowedFunction:e=>this.columnModel.isPivotMode()&&e.isPrimary()&&e.isAllowPivot(),activeFunction:e=>e.isPivotActive(),activateLabel:()=>t("addToLabels",`Add ${this.displayName} to labels`,[this.displayName]),deactivateLabel:()=>t("removeFromLabels",`Remove ${this.displayName} from labels`,[this.displayName]),activateFunction:()=>{const e=this.columnModel.getPivotColumns();this.columnModel.setPivotColumns(this.addColumnsToList(e),"toolPanelUi")},deActivateFunction:()=>{const e=this.columnModel.getPivotColumns();this.columnModel.setPivotColumns(this.removeColumnsFromList(e),"toolPanelUi")},addIcon:"pivotPanel",removeIcon:"pivotPanel"})}addColumnsToList(t){return[...t].concat(this.columns.filter(e=>t.indexOf(e)===-1))}removeColumnsFromList(t){return t.filter(e=>this.columns.indexOf(e)===-1)}displayContextMenu(t){const e=this.getGui(),s=this.createBean(new Ht),i=this.localeService.getLocaleTextFunc();let r=()=>{};e.appendChild(s.getGui()),s.addMenuItems(t),s.addManagedListener(s,Ye.EVENT_CLOSE_MENU,()=>{this.parentEl.focus(),r()});const o=this.popupService.addPopup({modal:!0,eChild:e,closeOnEsc:!0,afterGuiAttached:()=>this.focusService.focusInto(s.getGui()),ariaLabel:i("ariaLabelContextMenu","Context Menu"),closedCallback:n=>{n instanceof KeyboardEvent&&this.parentEl.focus(),this.destroyBean(s)}});o&&(r=o.hideFunc),this.popupService.positionPopupUnderMouseEvent({type:"columnContextMenu",mouseEvent:this.mouseEvent,ePopup:e})}isActive(){return this.allowGrouping||this.allowValues||this.allowPivoting}getMappedMenuItems(){const t=[];for(const e of this.menuItemMap.values()){const s=this.columns.some(r=>e.allowedFunction(r)&&!e.activeFunction(r)),i=this.columns.some(r=>e.allowedFunction(r)&&e.activeFunction(r));s&&t.push({name:e.activateLabel(this.displayName),icon:d.createIconNoSpan(e.addIcon,this.gos,null),action:()=>e.activateFunction()}),i&&t.push({name:e.deactivateLabel(this.displayName),icon:d.createIconNoSpan(e.removeIcon,this.gos,null),action:()=>e.deActivateFunction()})}return t}};F([p("columnModel")],Re.prototype,"columnModel",2);F([p("popupService")],Re.prototype,"popupService",2);F([p("focusService")],Re.prototype,"focusService",2);F([b],Re.prototype,"postConstruct",1);var X=class zs extends L{constructor(e,s,i,r){super(),this.modelItem=e,this.allowDragging=s,this.eventType=i,this.focusWrapper=r,this.processingColumnStateChange=!1,this.modelItem=e,this.columnGroup=e.getColumnGroup(),this.columnDept=e.getDept(),this.displayName=e.getDisplayName(),this.allowDragging=s}init(){this.setTemplate(zs.TEMPLATE),this.eDragHandle=d.createIconNoSpan("columnDrag",this.gos),this.eDragHandle.classList.add("ag-drag-handle","ag-column-select-column-group-drag-handle");const e=this.cbSelect.getGui(),s=this.cbSelect.getInputElement();e.insertAdjacentElement("afterend",this.eDragHandle),s.setAttribute("tabindex","-1"),this.eLabel.innerHTML=this.displayName?this.displayName:"",this.setupExpandContract(),this.addCssClass("ag-column-select-indent-"+this.columnDept),this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.eLabel,"click",this.onLabelClicked.bind(this)),this.addManagedListener(this.cbSelect,f.EVENT_FIELD_VALUE_CHANGED,this.onCheckboxChanged.bind(this)),this.addManagedListener(this.modelItem,Ke.EVENT_EXPANDED_CHANGED,this.onExpandChanged.bind(this)),this.addManagedListener(this.focusWrapper,"keydown",this.handleKeyDown.bind(this)),this.addManagedListener(this.focusWrapper,"contextmenu",this.onContextMenu.bind(this)),this.setOpenClosedIcons(),this.setupDragging(),this.onColumnStateChanged(),this.addVisibilityListenersToAllChildren(),this.refreshAriaExpanded(),this.refreshAriaLabel(),this.setupTooltip(),Ds.getToolPanelClassesFromColDef(this.columnGroup.getColGroupDef(),this.gos,null,this.columnGroup).forEach(r=>this.addOrRemoveCssClass(r,!0))}getColumns(){return this.columnGroup.getLeafColumns()}setupTooltip(){const e=this.columnGroup.getColGroupDef();if(!e)return;const s=this.gos.get("tooltipShowMode")==="whenTruncated";let i;s&&(i=()=>this.eLabel.scrollWidth>this.eLabel.clientWidth);const r=()=>{const o=e.headerTooltip;this.setTooltip({newTooltipText:o,location:"columnToolPanelColumnGroup",shouldDisplayTooltip:i})};r(),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,r)}getTooltipParams(){const e=super.getTooltipParams();return e.location="columnToolPanelColumnGroup",e}handleKeyDown(e){switch(e.key){case M.LEFT:e.preventDefault(),this.modelItem.setExpanded(!1);break;case M.RIGHT:e.preventDefault(),this.modelItem.setExpanded(!0);break;case M.SPACE:e.preventDefault(),this.isSelectable()&&this.onSelectAllChanged(!this.isSelected());break}}onContextMenu(e){const{columnGroup:s,gos:i}=this;if(i.get("functionsReadOnly"))return;const r=this.createBean(new Re(s,e,this.focusWrapper));this.addDestroyFunc(()=>{r.isAlive()&&this.destroyBean(r)})}addVisibilityListenersToAllChildren(){this.columnGroup.getLeafColumns().forEach(e=>{this.addManagedListener(e,z.EVENT_VISIBLE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(e,z.EVENT_VALUE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(e,z.EVENT_PIVOT_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(e,z.EVENT_ROW_GROUP_CHANGED,this.onColumnStateChanged.bind(this))})}setupDragging(){if(!this.allowDragging){d.setDisplayed(this.eDragHandle,!1);return}let e=!this.gos.get("suppressDragLeaveHidesColumns");const s={type:de.ToolPanel,eElement:this.eDragHandle,dragItemName:this.displayName,getDefaultIconName:()=>e?q.ICON_HIDE:q.ICON_NOT_ALLOWED,getDragItem:()=>this.createDragItem(),onDragStarted:()=>{e=!this.gos.get("suppressDragLeaveHidesColumns");const i={type:f.EVENT_COLUMN_PANEL_ITEM_DRAG_START,column:this.columnGroup};this.eventService.dispatchEvent(i)},onDragStopped:()=>{const i={type:f.EVENT_COLUMN_PANEL_ITEM_DRAG_END};this.eventService.dispatchEvent(i)},onGridEnter:i=>{e&&this.modelItemUtils.updateColumns({columns:this.columnGroup.getLeafColumns(),visibleState:i==null?void 0:i.visibleState,pivotState:i==null?void 0:i.pivotState,eventType:this.eventType})},onGridExit:()=>{e&&this.onChangeCommon(!1)}};this.dragAndDropService.addDragSource(s,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(s))}createDragItem(){const e=this.columnGroup.getLeafColumns(),s={},i={};return e.forEach(r=>{const o=r.getId();s[o]=r.isVisible(),i[o]=this.modelItemUtils.createPivotState(r)}),{columns:e,visibleState:s,pivotState:i}}setupExpandContract(){this.eGroupClosedIcon.appendChild(d.createIcon("columnSelectClosed",this.gos,null)),this.eGroupOpenedIcon.appendChild(d.createIcon("columnSelectOpen",this.gos,null)),this.addManagedListener(this.eGroupClosedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.addManagedListener(this.eGroupOpenedIcon,"click",this.onExpandOrContractClicked.bind(this));const e=new ts(this.eColumnGroupIcons,!0);this.addManagedListener(e,ts.EVENT_TAP,this.onExpandOrContractClicked.bind(this)),this.addDestroyFunc(e.destroy.bind(e))}onLabelClicked(){const e=!this.cbSelect.getValue();this.onChangeCommon(e)}onCheckboxChanged(e){this.onChangeCommon(e.selected)}getVisibleLeafColumns(){const e=[],s=i=>{i.forEach(r=>{!r.isPassesFilter()||(r.isGroup()?s(r.getChildren()):e.push(r.getColumn()))})};return s(this.modelItem.getChildren()),e}onChangeCommon(e){this.refreshAriaLabel(),!this.processingColumnStateChange&&this.modelItemUtils.selectAllChildren(this.modelItem.getChildren(),e,this.eventType)}refreshAriaLabel(){const e=this.localeService.getLocaleTextFunc(),s=e("ariaColumnGroup","Column Group"),i=this.cbSelect.getValue(),r=i===void 0?e("ariaIndeterminate","indeterminate"):i?e("ariaVisible","visible"):e("ariaHidden","hidden"),o=e("ariaToggleVisibility","Press SPACE to toggle visibility");d.setAriaLabel(this.focusWrapper,`${this.displayName} ${s}`),this.cbSelect.setInputAriaLabel(`${o} (${r})`),d.setAriaDescribedBy(this.focusWrapper,this.cbSelect.getInputElement().id)}onColumnStateChanged(){const e=this.workOutSelectedValue(),s=this.workOutReadOnlyValue();this.processingColumnStateChange=!0,this.cbSelect.setValue(e),this.cbSelect.setReadOnly(s),this.addOrRemoveCssClass("ag-column-select-column-group-readonly",s),this.processingColumnStateChange=!1}workOutSelectedValue(){const e=this.columnModel.isPivotMode(),s=this.getVisibleLeafColumns();let i=0,r=0;if(s.forEach(o=>{!e&&o.getColDef().lockVisible||(this.isColumnChecked(o,e)?i++:r++)}),!(i>0&&r>0))return i>0}workOutReadOnlyValue(){const e=this.columnModel.isPivotMode();let s=0;return this.columnGroup.getLeafColumns().forEach(i=>{e?i.isAnyFunctionAllowed()&&s++:i.getColDef().lockVisible||s++}),s===0}isColumnChecked(e,s){if(s){const i=e.isPivotActive(),r=e.isRowGroupActive(),o=e.isValueActive();return i||r||o}return e.isVisible()}onExpandOrContractClicked(){const e=this.modelItem.isExpanded();this.modelItem.setExpanded(!e)}onExpandChanged(){this.setOpenClosedIcons(),this.refreshAriaExpanded()}setOpenClosedIcons(){const e=this.modelItem.isExpanded();d.setDisplayed(this.eGroupClosedIcon,!e),d.setDisplayed(this.eGroupOpenedIcon,e)}refreshAriaExpanded(){d.setAriaExpanded(this.focusWrapper,this.modelItem.isExpanded())}getDisplayName(){return this.displayName}onSelectAllChanged(e){const s=this.cbSelect.getValue();!this.cbSelect.isReadOnly()&&(e&&!s||!e&&s)&&this.cbSelect.toggle()}isSelected(){return this.cbSelect.getValue()}isSelectable(){return!this.cbSelect.isReadOnly()}setSelected(e){this.cbSelect.setValue(e,!0)}};X.TEMPLATE=`<div class="ag-column-select-column-group" aria-hidden="true">
            <span class="ag-column-group-icons" ref="eColumnGroupIcons" >
                <span class="ag-column-group-closed-icon" ref="eGroupClosedIcon"></span>
                <span class="ag-column-group-opened-icon" ref="eGroupOpenedIcon"></span>
            </span>
            <ag-checkbox ref="cbSelect" class="ag-column-select-checkbox"></ag-checkbox>
            <span class="ag-column-select-column-label" ref="eLabel"></span>
        </div>`;F([p("columnModel")],X.prototype,"columnModel",2);F([p("dragAndDropService")],X.prototype,"dragAndDropService",2);F([p("modelItemUtils")],X.prototype,"modelItemUtils",2);F([E("cbSelect")],X.prototype,"cbSelect",2);F([E("eLabel")],X.prototype,"eLabel",2);F([E("eGroupOpenedIcon")],X.prototype,"eGroupOpenedIcon",2);F([E("eGroupClosedIcon")],X.prototype,"eGroupClosedIcon",2);F([E("eColumnGroupIcons")],X.prototype,"eColumnGroupIcons",2);F([b],X.prototype,"init",1);var qs=X,Jt=class extends T{constructor(t,e){super(),this.comp=t,this.virtualList=e}postConstruct(){this.createManagedBean(new Fs(this.comp,this.virtualList,{dragSourceType:de.ToolPanel,listItemDragStartEvent:f.EVENT_COLUMN_PANEL_ITEM_DRAG_START,listItemDragEndEvent:f.EVENT_COLUMN_PANEL_ITEM_DRAG_END,eventSource:this.eventService,getCurrentDragValue:t=>this.getCurrentDragValue(t),isMoveBlocked:t=>this.isMoveBlocked(t),getNumRows:t=>t.getDisplayedColsList().length,moveItem:(t,e)=>this.moveItem(t,e)}))}getCurrentDragValue(t){return t.column}isMoveBlocked(t){return this.gos.get("suppressMovableColumns")?!0:!!this.getCurrentColumns(t).find(r=>{const o=r.getColDef();return!!o.suppressMovable||!!o.lockPosition})}moveItem(t,e){const s=this.getTargetIndex(t,e),i=this.getCurrentColumns(t);s!=null&&this.columnModel.moveColumns(i,s,"toolPanelUi")}getMoveDiff(t,e){const s=this.columnModel.getAllGridColumns(),i=this.getCurrentColumns(t),r=i[0],o=i.length;return s.indexOf(r)<e?o:0}getCurrentColumns(t){return t instanceof $e?t.getLeafColumns():[t]}getTargetIndex(t,e){if(!e)return null;const s=e.component;let i=e.position==="top",r;if(s instanceof qs?(r=s.getColumns()[0],i=!0):r=s.getColumn(),this.getCurrentColumns(t).indexOf(r)!==-1)return null;const n=this.columnModel.getAllGridColumns().indexOf(r),a=i?n:n+1,l=this.getMoveDiff(t,a);return a-l}};F([p("columnModel")],Jt.prototype,"columnModel",2);F([b],Jt.prototype,"postConstruct",1);var me=class Zs extends L{constructor(e,s,i,r){super(),this.allowDragging=s,this.groupsExist=i,this.focusWrapper=r,this.processingColumnStateChange=!1,this.column=e.getColumn(),this.columnDept=e.getDept(),this.displayName=e.getDisplayName()}init(){this.setTemplate(Zs.TEMPLATE),this.eDragHandle=d.createIconNoSpan("columnDrag",this.gos),this.eDragHandle.classList.add("ag-drag-handle","ag-column-select-column-drag-handle");const e=this.cbSelect.getGui(),s=this.cbSelect.getInputElement();e.insertAdjacentElement("afterend",this.eDragHandle),s.setAttribute("tabindex","-1");const i=d.escapeString(this.displayName);this.eLabel.innerHTML=i;const r=this.columnDept;this.groupsExist&&this.addCssClass("ag-column-select-add-group-indent"),this.addCssClass(`ag-column-select-indent-${r}`),this.setupDragging(),this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,z.EVENT_VALUE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,z.EVENT_PIVOT_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,z.EVENT_ROW_GROUP_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,z.EVENT_VISIBLE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.focusWrapper,"keydown",this.handleKeyDown.bind(this)),this.addManagedListener(this.focusWrapper,"contextmenu",this.onContextMenu.bind(this)),this.addManagedPropertyListener("functionsReadOnly",this.onColumnStateChanged.bind(this)),this.addManagedListener(this.cbSelect,f.EVENT_FIELD_VALUE_CHANGED,this.onCheckboxChanged.bind(this)),this.addManagedListener(this.eLabel,"click",this.onLabelClicked.bind(this)),this.onColumnStateChanged(),this.refreshAriaLabel(),this.setupTooltip(),Ds.getToolPanelClassesFromColDef(this.column.getColDef(),this.gos,this.column,null).forEach(n=>this.addOrRemoveCssClass(n,!0))}getColumn(){return this.column}setupTooltip(){const e=this.gos.get("tooltipShowMode")==="whenTruncated";let s;e&&(s=()=>this.eLabel.scrollWidth>this.eLabel.clientWidth);const i=()=>{const r=this.column.getColDef().headerTooltip;this.setTooltip({newTooltipText:r,location:"columnToolPanelColumn",shouldDisplayTooltip:s})};i(),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,i)}getTooltipParams(){const e=super.getTooltipParams();return e.location="columnToolPanelColumn",e.colDef=this.column.getColDef(),e}onContextMenu(e){const{column:s,gos:i}=this;if(i.get("functionsReadOnly"))return;const r=this.createBean(new Re(s,e,this.focusWrapper));this.addDestroyFunc(()=>{r.isAlive()&&this.destroyBean(r)})}handleKeyDown(e){e.key===M.SPACE&&(e.preventDefault(),this.isSelectable()&&this.onSelectAllChanged(!this.isSelected()))}onLabelClicked(){if(this.gos.get("functionsReadOnly"))return;const e=!this.cbSelect.getValue();this.onChangeCommon(e)}onCheckboxChanged(e){this.onChangeCommon(e.selected)}onChangeCommon(e){this.cbSelect.isReadOnly()||(this.refreshAriaLabel(),!this.processingColumnStateChange&&this.modelItemUtils.setColumn(this.column,e,"toolPanelUi"))}refreshAriaLabel(){const e=this.localeService.getLocaleTextFunc(),s=e("ariaColumn","Column"),i=this.cbSelect.getValue()?e("ariaVisible","visible"):e("ariaHidden","hidden"),r=e("ariaToggleVisibility","Press SPACE to toggle visibility");d.setAriaLabel(this.focusWrapper,`${this.displayName} ${s}`),this.cbSelect.setInputAriaLabel(`${r} (${i})`),d.setAriaDescribedBy(this.focusWrapper,this.cbSelect.getInputElement().id)}setupDragging(){if(!this.allowDragging){d.setDisplayed(this.eDragHandle,!1);return}let e=!this.gos.get("suppressDragLeaveHidesColumns");const s={type:de.ToolPanel,eElement:this.eDragHandle,dragItemName:this.displayName,getDefaultIconName:()=>e?q.ICON_HIDE:q.ICON_NOT_ALLOWED,getDragItem:()=>this.createDragItem(),onDragStarted:()=>{e=!this.gos.get("suppressDragLeaveHidesColumns");const i={type:f.EVENT_COLUMN_PANEL_ITEM_DRAG_START,column:this.column};this.eventService.dispatchEvent(i)},onDragStopped:()=>{const i={type:f.EVENT_COLUMN_PANEL_ITEM_DRAG_END};this.eventService.dispatchEvent(i)},onGridEnter:i=>{e&&this.modelItemUtils.updateColumns({columns:[this.column],visibleState:i==null?void 0:i.visibleState,pivotState:i==null?void 0:i.pivotState,eventType:"toolPanelUi"})},onGridExit:()=>{e&&this.onChangeCommon(!1)}};this.dragAndDropService.addDragSource(s,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(s))}createDragItem(){const e=this.column.getColId(),s={[e]:this.column.isVisible()},i={[e]:this.modelItemUtils.createPivotState(this.column)};return{columns:[this.column],visibleState:s,pivotState:i}}onColumnStateChanged(){this.processingColumnStateChange=!0;const e=this.columnModel.isPivotMode();if(e){const o=this.column.isAnyFunctionActive();this.cbSelect.setValue(o)}else this.cbSelect.setValue(this.column.isVisible());let s=!0,i=!0;if(e){const o=this.gos.get("functionsReadOnly"),n=!this.column.isAnyFunctionAllowed();s=!o&&!n,i=s}else{const{enableRowGroup:o,enableValue:n,lockPosition:a,suppressMovable:l,lockVisible:u}=this.column.getColDef(),c=!!o||!!n,h=!!a||!!l;s=!u,i=c||!h}this.cbSelect.setReadOnly(!s),this.eDragHandle.classList.toggle("ag-column-select-column-readonly",!i),this.addOrRemoveCssClass("ag-column-select-column-readonly",!i&&!s);const r=e&&this.gos.get("functionsPassive");this.cbSelect.setPassive(r),this.processingColumnStateChange=!1}getDisplayName(){return this.displayName}onSelectAllChanged(e){e!==this.cbSelect.getValue()&&(this.cbSelect.isReadOnly()||this.cbSelect.toggle())}isSelected(){return this.cbSelect.getValue()}isSelectable(){return!this.cbSelect.isReadOnly()}isExpandable(){return!1}setExpanded(e){console.warn("AG Grid: can not expand a column item that does not represent a column group header")}};me.TEMPLATE=`<div class="ag-column-select-column" aria-hidden="true">
            <ag-checkbox ref="cbSelect" class="ag-column-select-checkbox"></ag-checkbox>
            <span class="ag-column-select-column-label" ref="eLabel"></span>
        </div>`;F([p("columnModel")],me.prototype,"columnModel",2);F([p("dragAndDropService")],me.prototype,"dragAndDropService",2);F([p("modelItemUtils")],me.prototype,"modelItemUtils",2);F([E("eLabel")],me.prototype,"eLabel",2);F([E("cbSelect")],me.prototype,"cbSelect",2);F([b],me.prototype,"init",1);var Wr=me,$r=class{constructor(t){this.items=t}getRowCount(){return this.items.length}getRow(t){return this.items[t]}},jr="ag-column-select-list",Ne=class Ys extends L{constructor(){super(Ys.TEMPLATE),this.destroyColumnItemFuncs=[],this.hasLoadedInitialState=!1,this.isInitialState=!1}destroyColumnTree(){this.allColsTree=[],this.destroyColumnItemFuncs.forEach(e=>e()),this.destroyColumnItemFuncs=[]}init(e,s,i){this.params=e,this.allowDragging=s,this.eventType=i,this.params.suppressSyncLayoutWithGrid||this.addManagedListener(this.eventService,f.EVENT_COLUMN_MOVED,this.onColumnsChanged.bind(this)),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,this.onColumnsChanged.bind(this)),[f.EVENT_COLUMN_PIVOT_CHANGED,f.EVENT_COLUMN_PIVOT_MODE_CHANGED,f.EVENT_COLUMN_ROW_GROUP_CHANGED,f.EVENT_COLUMN_VALUE_CHANGED,f.EVENT_COLUMN_VISIBLE,f.EVENT_NEW_COLUMNS_LOADED].forEach(o=>{this.addManagedListener(this.eventService,o,this.fireSelectionChangedEvent.bind(this))}),this.expandGroupsByDefault=!this.params.contractColumnSelection,this.virtualList=this.createManagedBean(new pt({cssIdentifier:"column-select",ariaRole:"tree"})),this.appendChild(this.virtualList.getGui()),this.virtualList.setComponentCreator((o,n)=>(d.setAriaLevel(n,o.getDept()+1),this.createComponentFromItem(o,n))),this.columnModel.isReady()&&this.onColumnsChanged(),!this.params.suppressColumnMove&&this.createManagedBean(new Jt(this,this.virtualList))}createComponentFromItem(e,s){if(e.isGroup()){const r=new qs(e,this.allowDragging,this.eventType,s);return this.getContext().createBean(r),r}const i=new Wr(e,this.allowDragging,this.groupsExist,s);return this.getContext().createBean(i),i}onColumnsChanged(){this.hasLoadedInitialState||(this.hasLoadedInitialState=!0,this.isInitialState=!!this.params.initialState);const e=this.getExpandedStates(),s=this.columnModel.isPivotMode();!this.params.suppressSyncLayoutWithGrid&&!s?this.buildTreeFromWhatGridIsDisplaying():this.buildTreeFromProvidedColumnDefs(),this.setExpandedStates(e),this.markFilteredColumns(),this.flattenAndFilterModel(),this.isInitialState=!1}getDisplayedColsList(){return this.displayedColsList}getExpandedStates(){const e={};if(this.isInitialState){const{expandedGroupIds:s}=this.params.initialState;return s.forEach(i=>{e[i]=!0}),e}return this.allColsTree?(this.forEachItem(s=>{if(!s.isGroup())return;const i=s.getColumnGroup();i&&(e[i.getId()]=s.isExpanded())}),e):{}}setExpandedStates(e){if(!this.allColsTree)return;const{isInitialState:s}=this;this.forEachItem(i=>{if(!i.isGroup())return;const r=i.getColumnGroup();if(r){const o=e[r.getId()];(o!=null||s)&&i.setExpanded(!!o)}})}buildTreeFromWhatGridIsDisplaying(){this.colDefService.syncLayoutWithGrid(this.setColumnLayout.bind(this))}setColumnLayout(e){const s=this.colDefService.createColumnTree(e);this.buildListModel(s),this.groupsExist=e.some(i=>i&&typeof i.children!="undefined"),this.markFilteredColumns(),this.flattenAndFilterModel()}buildTreeFromProvidedColumnDefs(){this.buildListModel(this.columnModel.getPrimaryColumnTree()),this.groupsExist=this.columnModel.isPrimaryColumnGroupsPresent()}buildListModel(e){const s=this.onColumnExpanded.bind(this),i=a=>{a.addEventListener(Ke.EVENT_EXPANDED_CHANGED,s);const l=a.removeEventListener.bind(a,Ke.EVENT_EXPANDED_CHANGED,s);this.destroyColumnItemFuncs.push(l)},r=(a,l,u)=>{a.forEach(c=>{c instanceof $e?o(c,l,u):n(c,l,u)})},o=(a,l,u)=>{const c=a.getColGroupDef();if(c&&c.suppressColumnsToolPanel)return;if(a.isPadding()){r(a.getChildren(),l,u);return}const g=this.columnModel.getDisplayNameForProvidedColumnGroup(null,a,"columnToolPanel"),m=new Ke(g,a,l,!0,this.expandGroupsByDefault);u.push(m),i(m),r(a.getChildren(),l+1,m.getChildren())},n=(a,l,u)=>{if(a.getColDef()&&a.getColDef().suppressColumnsToolPanel)return;const h=this.columnModel.getDisplayNameForColumn(a,"columnToolPanel");u.push(new Ke(h,a,l))};this.destroyColumnTree(),r(e,0,this.allColsTree)}onColumnExpanded(){this.flattenAndFilterModel()}flattenAndFilterModel(){this.displayedColsList=[];const e=i=>{!i.isPassesFilter()||(this.displayedColsList.push(i),i.isGroup()&&i.isExpanded()&&i.getChildren().forEach(e))};this.allColsTree.forEach(e),this.virtualList.setModel(new $r(this.displayedColsList));const s=this.virtualList.getLastFocusedRow();this.virtualList.refresh(),s!=null&&this.focusRowIfAlive(s),this.notifyListeners(),this.refreshAriaLabel()}refreshAriaLabel(){const e=this.localeService.getLocaleTextFunc(),s=e("ariaColumnPanelList","Column List"),i=e("columns","Columns"),r=this.displayedColsList.length;d.setAriaLabel(this.virtualList.getAriaElement(),`${s} ${r} ${i}`)}focusRowIfAlive(e){window.setTimeout(()=>{this.isAlive()&&this.virtualList.focusRow(e)},0)}forEachItem(e){const s=i=>{i.forEach(r=>{e(r),r.isGroup()&&s(r.getChildren())})};!this.allColsTree||s(this.allColsTree)}doSetExpandedAll(e){this.forEachItem(s=>{s.isGroup()&&s.setExpanded(e)})}setGroupsExpanded(e,s){if(!s){this.doSetExpandedAll(e);return}const i=[];this.forEachItem(o=>{if(!o.isGroup())return;const n=o.getColumnGroup().getId();s.indexOf(n)>=0&&(o.setExpanded(e),i.push(n))});const r=s.filter(o=>!d.includes(i,o));r.length>0&&console.warn("AG Grid: unable to find group(s) for supplied groupIds:",r)}getExpandState(){let e=0,s=0;return this.forEachItem(i=>{!i.isGroup()||(i.isExpanded()?e++:s++)}),e>0&&s>0?2:s>0?1:0}doSetSelectedAll(e){this.modelItemUtils.selectAllChildren(this.allColsTree,e,this.eventType)}getSelectionState(){let e=0,s=0;const i=this.columnModel.isPivotMode();if(this.forEachItem(r=>{if(r.isGroup()||!r.isPassesFilter())return;const o=r.getColumn(),n=o.getColDef();let a;if(i){if(!o.isAllowPivot()&&!o.isAllowRowGroup()&&!o.isAllowValue())return;a=o.isValueActive()||o.isPivotActive()||o.isRowGroupActive()}else{if(n.lockVisible)return;a=o.isVisible()}a?e++:s++}),!(e>0&&s>0))return!(e===0||s>0)}setFilterText(e){this.filterText=d.exists(e)?e.toLowerCase():null,this.markFilteredColumns(),this.flattenAndFilterModel()}markFilteredColumns(){const e=i=>{if(!d.exists(this.filterText))return!0;const r=i.getDisplayName();return r==null||r.toLowerCase().indexOf(this.filterText)!==-1},s=(i,r)=>{let o=!1;if(i.isGroup()){const a=e(i);i.getChildren().forEach(l=>{const u=s(l,a||r);u&&(o=u)})}const n=r||o?!0:e(i);return i.setPassesFilter(n),n};this.allColsTree.forEach(i=>s(i,!1))}notifyListeners(){this.fireGroupExpandedEvent(),this.fireSelectionChangedEvent()}fireGroupExpandedEvent(){const e=this.getExpandState();this.dispatchEvent({type:"groupExpanded",state:e})}fireSelectionChangedEvent(){if(!this.allColsTree)return;const e=this.getSelectionState();this.dispatchEvent({type:"selectionChanged",state:e})}getExpandedGroups(){const e=[];return this.allColsTree&&this.forEachItem(s=>{s.isGroup()&&s.isExpanded()&&e.push(s.getColumnGroup().getId())}),e}};Ne.TEMPLATE=`<div class="${jr}" role="presentation"></div>`;F([p("columnModel")],Ne.prototype,"columnModel",2);F([p("toolPanelColDefService")],Ne.prototype,"colDefService",2);F([p("modelItemUtils")],Ne.prototype,"modelItemUtils",2);F([Ts],Ne.prototype,"destroyColumnTree",1);var zr=Ne,xe=class extends L{createTemplate(){return`<div class="ag-pivot-mode-panel">
                <ag-toggle-button ref="cbPivotMode" class="ag-pivot-mode-select"></ag-toggle-button>
            </div>`}init(){this.setTemplate(this.createTemplate()),this.cbPivotMode.setValue(this.columnModel.isPivotMode());const t=this.localeService.getLocaleTextFunc();this.cbPivotMode.setLabel(t("pivotMode","Pivot Mode")),this.addManagedListener(this.cbPivotMode,f.EVENT_FIELD_VALUE_CHANGED,this.onBtPivotMode.bind(this)),this.addManagedListener(this.eventService,f.EVENT_NEW_COLUMNS_LOADED,this.onPivotModeChanged.bind(this)),this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onPivotModeChanged.bind(this))}onBtPivotMode(){const t=!!this.cbPivotMode.getValue();if(t!==this.columnModel.isPivotMode()){this.gos.updateGridOptions({options:{pivotMode:t},source:"toolPanelUi"});const{api:e}=this;e&&e.refreshHeader()}}onPivotModeChanged(){const t=this.columnModel.isPivotMode();this.cbPivotMode.setValue(t)}};F([p("columnModel")],xe.prototype,"columnModel",2);F([p("gridApi")],xe.prototype,"api",2);F([E("cbPivotMode")],xe.prototype,"cbPivotMode",2);F([Mi],xe.prototype,"init",1);var yt=class Js extends L{constructor(){super(Js.TEMPLATE)}init(e,s,i){this.allowDragging=e,this.params=s,this.eventType=i,this.primaryColsHeaderPanel.init(this.params);const r=this.params.suppressColumnFilter,o=this.params.suppressColumnSelectAll;this.params.suppressColumnExpandAll&&r&&o&&this.primaryColsHeaderPanel.setDisplayed(!1),this.addManagedListener(this.primaryColsListPanel,"groupExpanded",this.onGroupExpanded.bind(this)),this.addManagedListener(this.primaryColsListPanel,"selectionChanged",this.onSelectionChange.bind(this)),this.primaryColsListPanel.init(this.params,this.allowDragging,this.eventType),this.addManagedListener(this.primaryColsHeaderPanel,"expandAll",this.onExpandAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"collapseAll",this.onCollapseAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"selectAll",this.onSelectAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"unselectAll",this.onUnselectAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"filterChanged",this.onFilterChanged.bind(this)),this.positionableFeature=new Pi(this.getGui(),{minHeight:100}),this.createManagedBean(this.positionableFeature)}toggleResizable(e){this.positionableFeature.setResizable(e?{bottom:!0}:!1)}onExpandAll(){this.primaryColsListPanel.doSetExpandedAll(!0)}onCollapseAll(){this.primaryColsListPanel.doSetExpandedAll(!1)}expandGroups(e){this.primaryColsListPanel.setGroupsExpanded(!0,e)}collapseGroups(e){this.primaryColsListPanel.setGroupsExpanded(!1,e)}setColumnLayout(e){this.primaryColsListPanel.setColumnLayout(e)}onFilterChanged(e){this.primaryColsListPanel.setFilterText(e.filterText)}syncLayoutWithGrid(){this.primaryColsListPanel.onColumnsChanged()}onSelectAll(){this.primaryColsListPanel.doSetSelectedAll(!0)}onUnselectAll(){this.primaryColsListPanel.doSetSelectedAll(!1)}onGroupExpanded(e){this.primaryColsHeaderPanel.setExpandState(e.state),this.params.onStateUpdated()}onSelectionChange(e){this.primaryColsHeaderPanel.setSelectionState(e.state)}getExpandedGroups(){return this.primaryColsListPanel.getExpandedGroups()}};yt.TEMPLATE=`<div class="ag-column-select">
            <ag-primary-cols-header ref="primaryColsHeaderPanel"></ag-primary-cols-header>
            <ag-primary-cols-list ref="primaryColsListPanel"></ag-primary-cols-list>
        </div>`;F([E("primaryColsHeaderPanel")],yt.prototype,"primaryColsHeaderPanel",2);F([E("primaryColsListPanel")],yt.prototype,"primaryColsListPanel",2);var Xt=yt,Xs=class Qs extends L{constructor(){super(Qs.TEMPLATE),this.initialised=!1,this.childDestroyFuncs=[]}setVisible(e){super.setDisplayed(e),e&&!this.initialised&&this.init(this.params)}init(e){const s=this.gos.addGridCommonParams({suppressColumnMove:!1,suppressColumnSelectAll:!1,suppressColumnFilter:!1,suppressColumnExpandAll:!1,contractColumnSelection:!1,suppressPivotMode:!1,suppressRowGroups:!1,suppressValues:!1,suppressPivots:!1,suppressSyncLayoutWithGrid:!1});if(this.params=vs(vs({},s),e),this.isRowGroupingModuleLoaded()&&!this.params.suppressPivotMode&&(this.pivotModePanel=this.createBean(new xe),this.childDestroyFuncs.push(()=>this.destroyBean(this.pivotModePanel)),this.appendChild(this.pivotModePanel)),this.primaryColsPanel=this.createBean(new Xt),this.childDestroyFuncs.push(()=>this.destroyBean(this.primaryColsPanel)),this.primaryColsPanel.init(!0,this.params,"toolPanelUi"),this.primaryColsPanel.addCssClass("ag-column-panel-column-select"),this.appendChild(this.primaryColsPanel),this.isRowGroupingModuleLoaded()){this.params.suppressRowGroups||(this.rowGroupDropZonePanel=this.createBean(new dt(!1)),this.childDestroyFuncs.push(()=>this.destroyBean(this.rowGroupDropZonePanel)),this.appendChild(this.rowGroupDropZonePanel)),this.params.suppressValues||(this.valuesDropZonePanel=this.createBean(new Nt(!1)),this.childDestroyFuncs.push(()=>this.destroyBean(this.valuesDropZonePanel)),this.appendChild(this.valuesDropZonePanel)),this.params.suppressPivots||(this.pivotDropZonePanel=this.createBean(new ut(!1)),this.childDestroyFuncs.push(()=>this.destroyBean(this.pivotDropZonePanel)),this.appendChild(this.pivotDropZonePanel)),this.setLastVisible();const i=this.addManagedListener(this.eventService,f.EVENT_COLUMN_PIVOT_MODE_CHANGED,()=>{this.resetChildrenHeight(),this.setLastVisible()});this.childDestroyFuncs.push(()=>i())}this.initialised=!0}setPivotModeSectionVisible(e){!this.isRowGroupingModuleLoaded()||(this.pivotModePanel?this.pivotModePanel.setDisplayed(e):e&&(this.pivotModePanel=this.createBean(new xe),this.getGui().insertBefore(this.pivotModePanel.getGui(),this.getGui().firstChild),this.childDestroyFuncs.push(()=>this.destroyBean(this.pivotModePanel))),this.setLastVisible())}setRowGroupsSectionVisible(e){!this.isRowGroupingModuleLoaded()||(this.rowGroupDropZonePanel?this.rowGroupDropZonePanel.setDisplayed(e):e&&(this.rowGroupDropZonePanel=this.createManagedBean(new dt(!1)),this.appendChild(this.rowGroupDropZonePanel)),this.setLastVisible())}setValuesSectionVisible(e){!this.isRowGroupingModuleLoaded()||(this.valuesDropZonePanel?this.valuesDropZonePanel.setDisplayed(e):e&&(this.valuesDropZonePanel=this.createManagedBean(new Nt(!1)),this.appendChild(this.valuesDropZonePanel)),this.setLastVisible())}setPivotSectionVisible(e){!this.isRowGroupingModuleLoaded()||(this.pivotDropZonePanel?this.pivotDropZonePanel.setDisplayed(e):e&&(this.pivotDropZonePanel=this.createManagedBean(new ut(!1)),this.appendChild(this.pivotDropZonePanel),this.pivotDropZonePanel.setDisplayed(e)),this.setLastVisible())}setResizers(){[this.primaryColsPanel,this.rowGroupDropZonePanel,this.valuesDropZonePanel,this.pivotDropZonePanel].forEach(e=>{if(!e)return;const s=e.getGui();e.toggleResizable(!s.classList.contains("ag-last-column-drop")&&!s.classList.contains("ag-hidden"))})}setLastVisible(){const e=this.getGui();Array.prototype.slice.call(e.querySelectorAll(".ag-column-drop")).forEach(o=>o.classList.remove("ag-last-column-drop"));const i=e.querySelectorAll(".ag-column-drop:not(.ag-hidden)"),r=d.last(i);r&&r.classList.add("ag-last-column-drop"),this.setResizers()}resetChildrenHeight(){const s=this.getGui().children;for(let i=0;i<s.length;i++){const r=s[i];r.style.removeProperty("height"),r.style.removeProperty("flex")}}isRowGroupingModuleLoaded(){return N.__assertRegistered(x.RowGroupingModule,"Row Grouping",this.context.getGridId())}expandColumnGroups(e){this.primaryColsPanel.expandGroups(e)}collapseColumnGroups(e){this.primaryColsPanel.collapseGroups(e)}setColumnLayout(e){this.primaryColsPanel.setColumnLayout(e)}syncLayoutWithGrid(){this.primaryColsPanel.syncLayoutWithGrid()}destroyChildren(){this.childDestroyFuncs.forEach(e=>e()),this.childDestroyFuncs.length=0,d.clearElement(this.getGui())}refresh(e){return this.destroyChildren(),this.init(e),!0}getState(){return{expandedGroupIds:this.primaryColsPanel.getExpandedGroups()}}destroy(){this.destroyChildren(),super.destroy()}};Xs.TEMPLATE='<div class="ag-column-panel"></div>';var qr=Xs,Fe=class{selectAllChildren(t,e,s){const i=this.extractAllLeafColumns(t);this.setAllColumns(i,e,s)}setColumn(t,e,s){this.setAllColumns([t],e,s)}setAllColumns(t,e,s){this.columnModel.isPivotMode()?this.setAllPivot(t,e,s):this.setAllVisible(t,e,s)}extractAllLeafColumns(t){const e=[],s=i=>{i.forEach(r=>{!r.isPassesFilter()||(r.isGroup()?s(r.getChildren()):e.push(r.getColumn()))})};return s(t),e}setAllVisible(t,e,s){const i=[];t.forEach(r=>{r.getColDef().lockVisible||r.isVisible()!=e&&i.push({colId:r.getId(),hide:!e})}),i.length>0&&this.columnModel.applyColumnState({state:i},s)}setAllPivot(t,e,s){this.gos.get("functionsPassive")?this.setAllPivotPassive(t,e):this.setAllPivotActive(t,e,s)}setAllPivotPassive(t,e){const s=this.columnModel.getPivotColumns().slice(),i=this.columnModel.getValueColumns().slice(),r=this.columnModel.getRowGroupColumns().slice();let o=!1,n=!1,a=!1;const c=e?h=>{h.isAnyFunctionActive()||(h.isAllowValue()?(i.push(h),n=!0):h.isAllowRowGroup()?(r.push(h),o=!0):h.isAllowPivot()&&(s.push(h),a=!0))}:h=>{!h.isAnyFunctionActive()||(s.indexOf(h)>=0&&(d.removeFromArray(s,h),o=!0),i.indexOf(h)>=0&&(d.removeFromArray(i,h),n=!0),r.indexOf(h)>=0&&(d.removeFromArray(r,h),a=!0))};if(t.forEach(c),o){const h={type:f.EVENT_COLUMN_PIVOT_CHANGE_REQUEST,columns:s};this.eventService.dispatchEvent(h)}if(a){const h={type:f.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST,columns:r};this.eventService.dispatchEvent(h)}if(n){const h={type:f.EVENT_COLUMN_VALUE_CHANGE_REQUEST,columns:r};this.eventService.dispatchEvent(h)}}setAllPivotActive(t,e,s){const i=[],n=e?a=>{if(!a.isAnyFunctionActive())if(a.isAllowValue()){const l=typeof a.getAggFunc()=="string"?a.getAggFunc():this.aggFuncService.getDefaultAggFunc(a);i.push({colId:a.getId(),aggFunc:l})}else a.isAllowRowGroup()?i.push({colId:a.getId(),rowGroup:!0}):a.isAllowPivot()&&i.push({colId:a.getId(),pivot:!0})}:a=>{(a.isPivotActive()||a.isRowGroupActive()||a.isValueActive())&&i.push({colId:a.getId(),pivot:!1,rowGroup:!1,aggFunc:null})};t.forEach(n),i.length>0&&this.columnModel.applyColumnState({state:i},s)}updateColumns(t){const{columns:e,visibleState:s,pivotState:i,eventType:r}=t,o=e.map(n=>{const a=n.getColId();if(this.columnModel.isPivotMode()){const l=i==null?void 0:i[a];return{colId:a,pivot:l==null?void 0:l.pivot,rowGroup:l==null?void 0:l.rowGroup,aggFunc:l==null?void 0:l.aggFunc}}else return{colId:a,hide:!(s!=null&&s[a])}});this.columnModel.applyColumnState({state:o},r)}createPivotState(t){return{pivot:t.isPivotActive(),rowGroup:t.isRowGroupActive(),aggFunc:t.isValueActive()?t.getAggFunc():void 0}}};F([p("aggFuncService")],Fe.prototype,"aggFuncService",2);F([p("columnModel")],Fe.prototype,"columnModel",2);F([p("gridOptionsService")],Fe.prototype,"gos",2);F([p("eventService")],Fe.prototype,"eventService",2);Fe=F([G("modelItemUtils")],Fe);var Zr="31.3.2";x.ColumnsToolPanelModule,_e;var ei=Object.defineProperty,Yr=Object.defineProperties,Jr=Object.getOwnPropertyDescriptor,Xr=Object.getOwnPropertyDescriptors,Cs=Object.getOwnPropertySymbols,Qr=Object.prototype.hasOwnProperty,eo=Object.prototype.propertyIsEnumerable,Es=(t,e,s)=>e in t?ei(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ht=(t,e)=>{for(var s in e||(e={}))Qr.call(e,s)&&Es(t,s,e[s]);if(Cs)for(var s of Cs(e))eo.call(e,s)&&Es(t,s,e[s]);return t},Ut=(t,e)=>Yr(t,Xr(e)),C=(t,e,s,i)=>{for(var r=i>1?void 0:i?Jr(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(r=(i?n(e,s,r):n(r))||r);return i&&r&&ei(e,s,r),r},Q=class extends T{hideActiveMenu(){this.destroyBean(this.activeMenu)}showMenuAfterMouseEvent(t,e,s,i){const r=i?"filterMenuTab":void 0;this.showMenu(t,o=>{var n;const a=o.getGui();this.popupService.positionPopupUnderMouseEvent({type:s,column:t,mouseEvent:e,ePopup:a}),r&&((n=o.showTab)==null||n.call(o,r)),this.dispatchVisibleChangedEvent(!0,!1,t,r)},s,r,void 0,e.target)}showMenuAfterButtonClick(t,e,s,i){let r=-1,o="left";this.gos.get("enableRtl")&&(r=1,o="right");const n=i?"filterMenuTab":void 0,a=n?[n]:void 0,l=this.menuService.isLegacyMenuEnabled();let u=(l?9:4)*r,c=l?-23:4;this.showMenu(t,h=>{var g;const m=h.getGui();this.popupService.positionPopupByComponent({type:s,column:t,eventSource:e,ePopup:m,alignSide:o,nudgeX:u,nudgeY:c,position:"under",keepWithinBounds:!0}),n&&((g=h.showTab)==null||g.call(h,n)),this.dispatchVisibleChangedEvent(!0,!1,t,n)},s,n,a,e)}showMenu(t,e,s,i,r,o){var n;const{menu:a,eMenuGui:l,anchorToElement:u,restoreFocusParams:c}=this.getMenuParams(t,r,o),h=[];h.push(m=>{const y=a.getGui();this.destroyBean(a),t&&(t.setMenuVisible(!1,"contextMenu"),this.menuUtils.restoreFocusOnClose(c,y,m))});const g=this.localeService.getLocaleTextFunc();if(this.popupService.addPopup({modal:!0,eChild:l,closeOnEsc:!0,closedCallback:m=>{h.forEach(y=>y(m)),this.dispatchVisibleChangedEvent(!1,!1,t,i)},afterGuiAttached:m=>a.afterGuiAttached(Object.assign({},{container:s},m)),positionCallback:i?()=>e(a):void 0,ariaLabel:g("ariaLabelColumnMenu","Column Menu")}),i||((n=a.showTabBasedOnPreviousSelection)==null||n.call(a),e(a)),this.menuService.isColumnMenuAnchoringEnabled()){const m=this.popupService.setPopupPositionRelatedToElement(l,u);m&&t&&this.addStopAnchoring(m,t,h)}a.addEventListener(Ue.EVENT_TAB_SELECTED,m=>{this.dispatchVisibleChangedEvent(!1,!0,t),this.lastSelectedTab=m.key,this.dispatchVisibleChangedEvent(!0,!0,t)}),t==null||t.setMenuVisible(!0,"contextMenu"),this.activeMenu=a,a.addEventListener(T.EVENT_DESTROYED,()=>{this.activeMenu===a&&(this.activeMenu=null)})}addStopAnchoring(t,e,s){t.then(i=>{e.addEventListener("leftChanged",i),e.addEventListener("visibleChanged",i),s.push(()=>{e.removeEventListener("leftChanged",i),e.removeEventListener("visibleChanged",i)})})}getMenuParams(t,e,s){const i={column:t,headerPosition:this.focusService.getFocusedHeader(),columnIndex:this.columnModel.getAllDisplayedColumns().indexOf(t),eventSource:s},r=this.createMenu(t,i,e,s);return{menu:r,eMenuGui:r.getGui(),anchorToElement:s||this.ctrlsService.getGridBodyCtrl().getGui(),restoreFocusParams:i}}createMenu(t,e,s,i){return this.menuService.isLegacyMenuEnabled()?this.createBean(new Ue(t,e,this.lastSelectedTab,s,i)):this.createBean(new Be(t,e,i))}dispatchVisibleChangedEvent(t,e,s,i){var r,o;const n={type:f.EVENT_COLUMN_MENU_VISIBLE_CHANGED,visible:t,switchingTab:e,key:(o=(r=this.lastSelectedTab)!=null?r:i)!=null?o:this.menuService.isLegacyMenuEnabled()?Ue.TAB_GENERAL:"columnMenu",column:s!=null?s:null};this.eventService.dispatchEvent(n)}isMenuEnabled(t){var e;if(!this.menuService.isLegacyMenuEnabled())return!0;const s=!this.filterManager.isFilterAllowed(t),i=(e=t.getColDef().menuTabs)!=null?e:Ue.TABS_DEFAULT;return(s&&i.includes(Ue.TAB_FILTER)?i.length-1:i.length)>0}showMenuAfterContextMenuEvent(t,e,s){this.menuUtils.onContextMenu(e,s,i=>(this.showMenuAfterMouseEvent(t,i,"columnMenu"),!0))}};C([p("popupService")],Q.prototype,"popupService",2);C([p("focusService")],Q.prototype,"focusService",2);C([p("ctrlsService")],Q.prototype,"ctrlsService",2);C([p("columnModel")],Q.prototype,"columnModel",2);C([p("filterManager")],Q.prototype,"filterManager",2);C([p("menuUtils")],Q.prototype,"menuUtils",2);C([p("menuService")],Q.prototype,"menuService",2);Q=C([G("enterpriseMenuFactory")],Q);var $=class I extends T{constructor(e,s,i,r,o){super(),this.column=e,this.restoreFocusParams=s,this.initialSelection=i,this.restrictTo=r,this.sourceElement=o,this.tabFactories={},this.includeChecks={},this.tabFactories[I.TAB_GENERAL]=this.createMainPanel.bind(this),this.tabFactories[I.TAB_FILTER]=this.createFilterPanel.bind(this),this.tabFactories[I.TAB_COLUMNS]=this.createColumnsPanel.bind(this),this.includeChecks[I.TAB_GENERAL]=()=>!0,this.includeChecks[I.TAB_FILTER]=()=>e?this.filterManager.isFilterAllowed(e):!1,this.includeChecks[I.TAB_COLUMNS]=()=>!0}init(){const e=this.getTabsToCreate().map(s=>this.createTab(s));this.tabbedLayout=new bi({items:e,cssClass:"ag-menu",onActiveItemClicked:this.onHidePopup.bind(this),onItemClicked:this.onTabItemClicked.bind(this)}),this.createBean(this.tabbedLayout),this.mainMenuList&&this.mainMenuList.setParentComponent(this.tabbedLayout),this.addDestroyFunc(()=>this.destroyBean(this.tabbedLayout))}getTabsToCreate(){var e,s;return this.restrictTo?this.restrictTo:((s=(e=this.column)==null?void 0:e.getColDef().menuTabs)!=null?s:I.TABS_DEFAULT).filter(i=>this.isValidMenuTabItem(i)).filter(i=>this.isNotSuppressed(i)).filter(i=>this.isModuleLoaded(i))}isModuleLoaded(e){return e===I.TAB_COLUMNS?N.__isRegistered(x.ColumnsToolPanelModule,this.context.getGridId()):!0}isValidMenuTabItem(e){let s=!0,i=I.TABS_DEFAULT;return this.restrictTo!=null&&(s=this.restrictTo.indexOf(e)>-1,i=this.restrictTo),s=s&&I.TABS_DEFAULT.indexOf(e)>-1,s||console.warn(`AG Grid: Trying to render an invalid menu item '${e}'. Check that your 'menuTabs' contains one of [${i}]`),s}isNotSuppressed(e){return this.includeChecks[e]()}createTab(e){return this.tabFactories[e]()}showTabBasedOnPreviousSelection(){this.showTab(this.initialSelection)}showTab(e){this.tabItemColumns&&e===I.TAB_COLUMNS?this.tabbedLayout.showItem(this.tabItemColumns):this.tabItemFilter&&e===I.TAB_FILTER?this.tabbedLayout.showItem(this.tabItemFilter):this.tabItemGeneral&&e===I.TAB_GENERAL?this.tabbedLayout.showItem(this.tabItemGeneral):this.tabbedLayout.showFirstItem()}onTabItemClicked(e){let s=null;switch(e.item){case this.tabItemColumns:s=I.TAB_COLUMNS;break;case this.tabItemFilter:s=I.TAB_FILTER;break;case this.tabItemGeneral:s=I.TAB_GENERAL;break}s&&this.activateTab(s)}activateTab(e){const s={type:I.EVENT_TAB_SELECTED,key:e};this.dispatchEvent(s)}createMainPanel(){return this.mainMenuList=this.columnMenuFactory.createMenu(this,this.column,()=>{var e;return(e=this.sourceElement)!=null?e:this.getGui()}),this.mainMenuList.addEventListener(Ye.EVENT_CLOSE_MENU,this.onHidePopup.bind(this)),this.tabItemGeneral={title:d.createIconNoSpan("menu",this.gos,this.column),titleLabel:I.TAB_GENERAL.replace("MenuTab",""),bodyPromise:V.resolve(this.mainMenuList.getGui()),name:I.TAB_GENERAL},this.tabItemGeneral}onHidePopup(e){this.menuUtils.closePopupAndRestoreFocusOnSelect(this.hidePopupFunc,this.restoreFocusParams,e)}createFilterPanel(){const e=this.column?this.createManagedBean(new bs(this.column,"COLUMN_MENU")):null;if(!(e!=null&&e.hasFilter()))throw new Error("AG Grid - Unable to instantiate filter");const s=r=>e.afterGuiAttached(r),i=()=>e.afterGuiDetached();return this.tabItemFilter={title:d.createIconNoSpan("filter",this.gos,this.column),titleLabel:I.TAB_FILTER.replace("MenuTab",""),bodyPromise:V.resolve(e==null?void 0:e.getGui()),afterAttachedCallback:s,afterDetachedCallback:i,name:I.TAB_FILTER},this.tabItemFilter}createColumnsPanel(){const e=document.createElement("div");e.classList.add("ag-menu-column-select-wrapper");const i=this.columnChooserFactory.createColumnSelectPanel(this,this.column).getGui();return i.classList.add("ag-menu-column-select"),e.appendChild(i),this.tabItemColumns={title:d.createIconNoSpan("columns",this.gos,this.column),titleLabel:I.TAB_COLUMNS.replace("MenuTab",""),bodyPromise:V.resolve(e),name:I.TAB_COLUMNS},this.tabItemColumns}afterGuiAttached(e){const{container:s,hidePopup:i}=e;this.tabbedLayout.setAfterAttachedParams({container:s,hidePopup:i}),i&&(this.hidePopupFunc=i,this.addDestroyFunc(i))}getGui(){return this.tabbedLayout.getGui()}};$.EVENT_TAB_SELECTED="tabSelected";$.TAB_FILTER="filterMenuTab";$.TAB_GENERAL="generalMenuTab";$.TAB_COLUMNS="columnsMenuTab";$.TABS_DEFAULT=[$.TAB_GENERAL,$.TAB_FILTER,$.TAB_COLUMNS];C([p("filterManager")],$.prototype,"filterManager",2);C([p("columnChooserFactory")],$.prototype,"columnChooserFactory",2);C([p("columnMenuFactory")],$.prototype,"columnMenuFactory",2);C([p("menuUtils")],$.prototype,"menuUtils",2);C([b],$.prototype,"init",1);var Ue=$,Be=class extends L{constructor(t,e,s){super(`
            <div ref="eColumnMenu" role="presentation" class="ag-menu ag-column-menu"></div>
        `),this.column=t,this.restoreFocusParams=e,this.sourceElement=s}init(){this.mainMenuList=this.columnMenuFactory.createMenu(this,this.column,()=>{var t;return(t=this.sourceElement)!=null?t:this.getGui()}),this.mainMenuList.addEventListener(Ye.EVENT_CLOSE_MENU,this.onHidePopup.bind(this)),this.eColumnMenu.appendChild(this.mainMenuList.getGui())}onHidePopup(t){this.menuUtils.closePopupAndRestoreFocusOnSelect(this.hidePopupFunc,this.restoreFocusParams,t)}afterGuiAttached({hidePopup:t}){t&&(this.hidePopupFunc=t,this.addDestroyFunc(t)),this.focusService.focusInto(this.mainMenuList.getGui())}};C([p("columnMenuFactory")],Be.prototype,"columnMenuFactory",2);C([p("menuUtils")],Be.prototype,"menuUtils",2);C([p("focusService")],Be.prototype,"focusService",2);C([E("eColumnMenu")],Be.prototype,"eColumnMenu",2);C([b],Be.prototype,"init",1);var to="ag-menu",ys="ag-context-menu-open",he=class extends T{hideActiveMenu(){this.destroyBean(this.activeMenu)}getMenuItems(t,e,s){const i=[];if(d.exists(t)&&N.__isRegistered(x.ClipboardModule,this.context.getGridId())&&e&&(this.gos.get("suppressCutToClipboard")||i.push("cut"),i.push("copy","copyWithHeaders","copyWithGroupHeaders","paste","separator")),this.gos.get("enableCharts")&&N.__isRegistered(x.GridChartsModule,this.context.getGridId())&&(this.columnModel.isPivotMode()&&i.push("pivotChart"),this.rangeService&&!this.rangeService.isEmpty()&&i.push("chartRange")),d.exists(t)){const a=!N.__isRegistered(x.CsvExportModule,this.context.getGridId()),l=!N.__isRegistered(x.ExcelExportModule,this.context.getGridId()),u=this.gos.get("suppressExcelExport")||l,c=this.gos.get("suppressCsvExport")||a;!d.isIOSUserAgent()&&(!u||!c)&&i.push("export")}const r=i.length?i:void 0,o=e==null?void 0:e.getColDef().contextMenuItems;if(Array.isArray(o))return o;if(typeof o=="function")return o(this.gos.addGridCommonParams({column:e,node:t,value:s,defaultItems:r}));const n=this.gos.getCallback("getContextMenuItems");return n?n({column:e,node:t,value:s,defaultItems:r}):i}onContextMenu(t,e,s,i,r,o){this.menuUtils.onContextMenu(t,e,n=>this.showMenu(s,i,r,n,o))}showMenu(t,e,s,i,r){const o=this.getMenuItems(t,e,s),n=this.ctrlsService.getGridBodyCtrl().getGui();if(o===void 0||d.missingOrEmpty(o))return!1;const a=new et(o,e,t,s);this.createBean(a);const l=a.getGui(),u={column:e,rowNode:t,type:"contextMenu",mouseEvent:i,ePopup:l,nudgeY:1},c=this.localeService.getLocaleTextFunc(),h=this.popupService.addPopup({modal:!0,eChild:l,closeOnEsc:!0,closedCallback:m=>{n.classList.remove(ys),this.destroyBean(a),this.dispatchVisibleChangedEvent(!1,m===void 0?"api":"ui")},click:i,positionCallback:()=>{const m=this.gos.get("enableRtl");this.popupService.positionPopupUnderMouseEvent(Ut(ht({},u),{nudgeX:m?(l.offsetWidth+1)*-1:1}))},anchorToElement:r,ariaLabel:c("ariaLabelContextMenu","Context Menu")});h&&(n.classList.add(ys),a.afterGuiAttached({container:"contextMenu",hidePopup:h.hideFunc})),this.activeMenu&&this.hideActiveMenu(),this.activeMenu=a,a.addEventListener(T.EVENT_DESTROYED,()=>{this.activeMenu===a&&(this.activeMenu=null)}),h&&a.addEventListener(Ye.EVENT_CLOSE_MENU,m=>{var y,P;return h.hideFunc({mouseEvent:(y=m.mouseEvent)!=null?y:void 0,keyboardEvent:(P=m.keyboardEvent)!=null?P:void 0,forceHide:!0})});const g=i&&i instanceof MouseEvent&&i.type==="mousedown";return this.dispatchVisibleChangedEvent(!0,g?"api":"ui"),!0}dispatchVisibleChangedEvent(t,e="ui"){const s={type:f.EVENT_CONTEXT_MENU_VISIBLE_CHANGED,visible:t,source:e};this.eventService.dispatchEvent(s)}};C([p("popupService")],he.prototype,"popupService",2);C([p("ctrlsService")],he.prototype,"ctrlsService",2);C([p("columnModel")],he.prototype,"columnModel",2);C([p("menuUtils")],he.prototype,"menuUtils",2);C([ne("rangeService")],he.prototype,"rangeService",2);he=C([G("contextMenuFactory")],he);var et=class extends L{constructor(t,e,s,i){super(`<div class="${to}" role="presentation"></div>`),this.menuItems=t,this.column=e,this.node=s,this.value=i,this.menuList=null,this.focusedCell=null}addMenuItems(){const t=this.createManagedBean(new Ht(0,{column:this.column,node:this.node,value:this.value})),e=this.menuItemMapper.mapWithStockItems(this.menuItems,null,()=>this.getGui());t.addMenuItems(e),this.appendChild(t),this.menuList=t,t.addEventListener(Ye.EVENT_CLOSE_MENU,s=>this.dispatchEvent(s))}afterGuiAttached(t){t.hidePopup&&this.addDestroyFunc(t.hidePopup),this.focusedCell=this.focusService.getFocusedCell(),this.menuList&&this.focusService.focusInto(this.menuList.getGui())}restoreFocusedCell(){const t=this.focusService.getFocusedCell();if(t&&this.focusedCell&&this.cellPositionUtils.equals(t,this.focusedCell)){const{rowIndex:e,rowPinned:s,column:i}=this.focusedCell,r=this.gos.getDocument(),o=this.gos.getActiveDomElement();(!o||o===r.body)&&this.focusService.setFocusedCell({rowIndex:e,column:i,rowPinned:s,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!this.focusService.isKeyboardMode()})}}destroy(){this.restoreFocusedCell(),super.destroy()}};C([p("menuItemMapper")],et.prototype,"menuItemMapper",2);C([p("focusService")],et.prototype,"focusService",2);C([p("cellPositionUtils")],et.prototype,"cellPositionUtils",2);C([b],et.prototype,"addMenuItems",1);var Z=class extends T{mapWithStockItems(t,e,s){if(!t)return[];const i=[];return t.forEach(r=>{let o;if(typeof r=="string"?o=this.getStockMenuItem(r,e,s):o=ht({},r),!o)return;const n=o,{subMenu:a}=n;a&&a instanceof Array&&(n.subMenu=this.mapWithStockItems(a,e,s)),o!=null&&i.push(o)}),i}getStockMenuItem(t,e,s){var i;const r=this.localeService.getLocaleTextFunc(),o=this.gos.get("skipHeaderOnAutoSize");switch(t){case"pinSubMenu":return{name:r("pinColumn","Pin Column"),icon:d.createIconNoSpan("menuPin",this.gos,null),subMenu:["clearPinned","pinLeft","pinRight"]};case"pinLeft":return{name:r("pinLeft","Pin Left"),action:()=>this.columnModel.setColumnsPinned([e],"left","contextMenu"),checked:!!e&&e.isPinnedLeft()};case"pinRight":return{name:r("pinRight","Pin Right"),action:()=>this.columnModel.setColumnsPinned([e],"right","contextMenu"),checked:!!e&&e.isPinnedRight()};case"clearPinned":return{name:r("noPin","No Pin"),action:()=>this.columnModel.setColumnsPinned([e],null,"contextMenu"),checked:!!e&&!e.isPinned()};case"valueAggSubMenu":return N.__assertRegistered(x.RowGroupingModule,"Aggregation from Menu",this.context.getGridId())?!(e!=null&&e.isPrimary())&&!(e!=null&&e.getColDef().pivotValueColumn)?null:{name:r("valueAggregation","Value Aggregation"),icon:d.createIconNoSpan("menuValue",this.gos,null),subMenu:this.createAggregationSubMenu(e,this.aggFuncService)}:null;case"autoSizeThis":return{name:r("autosizeThiscolumn","Autosize This Column"),action:()=>this.columnModel.autoSizeColumn(e,"contextMenu",o)};case"autoSizeAll":return{name:r("autosizeAllColumns","Autosize All Columns"),action:()=>this.columnModel.autoSizeAllColumns("contextMenu",o)};case"rowGroup":return{name:r("groupBy","Group by")+" "+d.escapeString(this.columnModel.getDisplayNameForColumn(e,"header")),disabled:(e==null?void 0:e.isRowGroupActive())||!(e!=null&&e.getColDef().enableRowGroup),action:()=>this.columnModel.addRowGroupColumns([e],"contextMenu"),icon:d.createIconNoSpan("menuAddRowGroup",this.gos,null)};case"rowUnGroup":const n=d.createIconNoSpan("menuRemoveRowGroup",this.gos,null),a=e==null?void 0:e.getColDef().showRowGroup,l=this.gos.get("groupLockGroupColumns");if(a===!0)return{name:r("ungroupAll","Un-Group All"),disabled:l===-1||l>=this.columnModel.getRowGroupColumns().length,action:()=>this.columnModel.setRowGroupColumns(this.columnModel.getRowGroupColumns().slice(0,l),"contextMenu"),icon:n};if(typeof a=="string"){const g=this.columnModel.getPrimaryColumn(a),m=g!=null?d.escapeString(this.columnModel.getDisplayNameForColumn(g,"header")):a;return{name:r("ungroupBy","Un-Group by")+" "+m,disabled:g!=null&&this.columnModel.isColumnGroupingLocked(g),action:()=>this.columnModel.removeRowGroupColumns([a],"contextMenu"),icon:n}}return{name:r("ungroupBy","Un-Group by")+" "+d.escapeString(this.columnModel.getDisplayNameForColumn(e,"header")),disabled:!(e!=null&&e.isRowGroupActive())||!(e!=null&&e.getColDef().enableRowGroup)||this.columnModel.isColumnGroupingLocked(e),action:()=>this.columnModel.removeRowGroupColumns([e],"contextMenu"),icon:n};case"resetColumns":return{name:r("resetColumns","Reset Columns"),action:()=>this.columnModel.resetColumnState("contextMenu")};case"expandAll":return{name:r("expandAll","Expand All Row Groups"),action:()=>this.gridApi.expandAll()};case"contractAll":return{name:r("collapseAll","Collapse All Row Groups"),action:()=>this.gridApi.collapseAll()};case"copy":return N.__assertRegistered(x.ClipboardModule,"Copy from Menu",this.context.getGridId())?{name:r("copy","Copy"),shortcut:r("ctrlC","Ctrl+C"),icon:d.createIconNoSpan("clipboardCopy",this.gos,null),action:()=>this.clipboardService.copyToClipboard()}:null;case"copyWithHeaders":return N.__assertRegistered(x.ClipboardModule,"Copy with Headers from Menu",this.context.getGridId())?{name:r("copyWithHeaders","Copy with Headers"),icon:d.createIconNoSpan("clipboardCopy",this.gos,null),action:()=>this.clipboardService.copyToClipboard({includeHeaders:!0})}:null;case"copyWithGroupHeaders":return N.__assertRegistered(x.ClipboardModule,"Copy with Group Headers from Menu",this.context.getGridId())?{name:r("copyWithGroupHeaders","Copy with Group Headers"),icon:d.createIconNoSpan("clipboardCopy",this.gos,null),action:()=>this.clipboardService.copyToClipboard({includeHeaders:!0,includeGroupHeaders:!0})}:null;case"cut":if(N.__assertRegistered(x.ClipboardModule,"Cut from Menu",this.context.getGridId())){const g=this.focusService.getFocusedCell(),m=g?this.rowPositionUtils.getRowNode(g):null,y=m?g==null?void 0:g.column.isCellEditable(m):!1;return{name:r("cut","Cut"),shortcut:r("ctrlX","Ctrl+X"),icon:d.createIconNoSpan("clipboardCut",this.gos,null),disabled:!y||this.gos.get("suppressCutToClipboard"),action:()=>this.clipboardService.cutToClipboard(void 0,"contextMenu")}}else return null;case"paste":return N.__assertRegistered(x.ClipboardModule,"Paste from Clipboard",this.context.getGridId())?{name:r("paste","Paste"),shortcut:r("ctrlV","Ctrl+V"),disabled:!0,icon:d.createIconNoSpan("clipboardPaste",this.gos,null),action:()=>this.clipboardService.pasteFromClipboard()}:null;case"export":const u=[],c=N.__isRegistered(x.CsvExportModule,this.context.getGridId()),h=N.__isRegistered(x.ExcelExportModule,this.context.getGridId());return!this.gos.get("suppressCsvExport")&&c&&u.push("csvExport"),!this.gos.get("suppressExcelExport")&&h&&u.push("excelExport"),{name:r("export","Export"),subMenu:u,icon:d.createIconNoSpan("save",this.gos,null)};case"csvExport":return{name:r("csvExport","CSV Export"),icon:d.createIconNoSpan("csvExport",this.gos,null),action:()=>this.gridApi.exportDataAsCsv({})};case"excelExport":return{name:r("excelExport","Excel Export"),icon:d.createIconNoSpan("excelExport",this.gos,null),action:()=>this.gridApi.exportDataAsExcel()};case"separator":return"separator";case"pivotChart":case"chartRange":return(i=this.chartMenuItemMapper.getChartItems(t))!=null?i:null;case"columnFilter":return e?{name:r("columnFilter","Column Filter"),icon:d.createIconNoSpan("filter",this.gos,null),action:()=>this.menuService.showFilterMenu({column:e,buttonElement:s(),containerType:"columnFilter",positionBy:"button"})}:null;case"columnChooser":return N.__isRegistered(x.ColumnsToolPanelModule,this.context.getGridId())?{name:r("columnChooser","Choose Columns"),icon:d.createIconNoSpan("columns",this.gos,null),action:()=>this.menuService.showColumnChooser({column:e,eventSource:s()})}:null;case"sortAscending":return{name:r("sortAscending","Sort Ascending"),icon:d.createIconNoSpan("sortAscending",this.gos,null),action:()=>this.sortController.setSortForColumn(e,"asc",!1,"columnMenu")};case"sortDescending":return{name:r("sortDescending","Sort Descending"),icon:d.createIconNoSpan("sortDescending",this.gos,null),action:()=>this.sortController.setSortForColumn(e,"desc",!1,"columnMenu")};case"sortUnSort":return{name:r("sortUnSort","Clear Sort"),icon:d.createIconNoSpan("sortUnSort",this.gos,null),action:()=>this.sortController.setSortForColumn(e,null,!1,"columnMenu")};default:return console.warn(`AG Grid: unknown menu item type ${t}`),null}}createAggregationSubMenu(t,e){const s=this.localeService.getLocaleTextFunc();let i;if(t.isPrimary())i=t;else{const o=t.getColDef().pivotValueColumn;i=d.exists(o)?o:void 0}const r=[];if(i){const o=i.isValueActive(),n=e.getFuncNames(i);r.push({name:s("noAggregation","None"),action:()=>{this.columnModel.removeValueColumns([i],"contextMenu"),this.columnModel.setColumnAggFunc(i,void 0,"contextMenu")},checked:!o}),n.forEach(a=>{r.push({name:s(a,e.getDefaultFuncLabel(a)),action:()=>{this.columnModel.setColumnAggFunc(i,a,"contextMenu"),this.columnModel.addValueColumns([i],"contextMenu")},checked:o&&i.getAggFunc()===a})})}return r}};C([p("columnModel")],Z.prototype,"columnModel",2);C([p("gridApi")],Z.prototype,"gridApi",2);C([p("focusService")],Z.prototype,"focusService",2);C([p("rowPositionUtils")],Z.prototype,"rowPositionUtils",2);C([p("chartMenuItemMapper")],Z.prototype,"chartMenuItemMapper",2);C([p("menuService")],Z.prototype,"menuService",2);C([p("sortController")],Z.prototype,"sortController",2);C([ne("clipboardService")],Z.prototype,"clipboardService",2);C([ne("aggFuncService")],Z.prototype,"aggFuncService",2);Z=C([G("menuItemMapper")],Z);var so="31.3.2",Ze=class extends T{getChartItems(t){var e,s;if(!this.chartService){N.__assertRegistered(x.GridChartsModule,`the Context Menu key "${t}"`,this.context.getGridId());return}const i=t==="pivotChart"?new io(this.gos,this.chartService,this.localeService):new ro(this.gos,this.chartService,this.localeService),r=this.chartService.isEnterprise();let o=i.getMenuItem();if(o&&o.subMenu&&!r){const a=l=>{var u;return Ut(ht({},l),{subMenu:(u=l.subMenu)==null?void 0:u.filter(c=>!c._enterprise).map(c=>a(c))})};o=a(o)}const n=(s=(e=this.gos.get("chartToolPanelsDef"))==null?void 0:e.settingsPanel)==null?void 0:s.chartGroupsDef;return n&&(o=Ze.filterAndOrderChartMenu(o,n,i.getConfigLookup())),this.cleanInternals(o)}cleanInternals(t){if(!t)return t;const e=s=>{var i;return s==null||delete s._key,s==null||delete s._enterprise,(i=s==null?void 0:s.subMenu)==null||i.forEach(r=>e(r)),s};return e(t)}static buildLookup(t){let e={};const s=i=>{e[i._key]=i,i.subMenu&&i.subMenu.forEach(r=>s(r))};return s(t),e}static filterAndOrderChartMenu(t,e,s){var i;const r=this.buildLookup(t);let o=Ut(ht({},t),{subMenu:[]});if(Object.entries(e).forEach(([n,a])=>{var l,u;const c=s[n];if(c===null)return;if(c==null){d.warnOnce(`invalid chartGroupsDef config '${n}'`);return}const h=r[c._key];if(h)if(h.subMenu){const g=a.map(m=>{const y=c[m];if(y==null){d.warnOnce(`invalid chartGroupsDef config '${n}.${m}'`);return}return r[y]}).filter(m=>m!==void 0);g.length>0&&(h.subMenu=g,(l=o.subMenu)==null||l.push(h))}else(u=o.subMenu)==null||u.push(h)}),((i=o.subMenu)==null?void 0:i.length)!=0)return o}};C([ne("chartService")],Ze.prototype,"chartService",2);Ze=C([G("chartMenuItemMapper")],Ze);var io=class{constructor(t,e,s){this.gos=t,this.chartService=e,this.localeService=s}getMenuItem(){const t=this.localeService.getLocaleTextFunc(),e=(s,i,r,o,n=!1)=>({name:t(s,i),action:()=>this.chartService.createPivotChart({chartType:r}),_key:o,_enterprise:n});return{name:t("pivotChart","Pivot Chart"),_key:"pivotChart",subMenu:[{_key:"pivotColumnChart",name:t("columnChart","Column"),subMenu:[e("groupedColumn","Grouped&lrm;","groupedColumn","pivotGroupedColumn"),e("stackedColumn","Stacked&lrm;","stackedColumn","pivotStackedColumn"),e("normalizedColumn","100% Stacked&lrm;","normalizedColumn","pivotNormalizedColumn")]},{_key:"pivotBarChart",name:t("barChart","Bar"),subMenu:[e("groupedBar","Grouped&lrm;","groupedBar","pivotGroupedBar"),e("stackedBar","Stacked&lrm;","stackedBar","pivotStackedBar"),e("normalizedBar","100% Stacked&lrm;","normalizedBar","pivotNormalizedBar")]},{_key:"pivotPieChart",name:t("pieChart","Pie"),subMenu:[e("pie","Pie&lrm;","pie","pivotPie"),e("donut","Donut&lrm;","donut","pivotDonut")]},e("line","Line&lrm;","line","pivotLineChart"),{_key:"pivotXYChart",name:t("xyChart","X Y (Scatter)"),subMenu:[e("scatter","Scatter&lrm;","scatter","pivotScatter"),e("bubble","Bubble&lrm;","bubble","pivotBubble")]},{_key:"pivotAreaChart",name:t("areaChart","Area"),subMenu:[e("area","Area&lrm;","area","pivotArea"),e("stackedArea","Stacked&lrm;","stackedArea","pivotStackedArea"),e("normalizedArea","100% Stacked&lrm;","normalizedArea","pivotNormalizedArea")]},{_key:"pivotStatisticalChart",_enterprise:!1,name:t("statisticalChart","Statistical"),subMenu:[e("histogramChart","Histogram&lrm;","histogram","pivotHistogram",!1)]},{_key:"pivotHierarchicalChart",_enterprise:!0,name:t("hierarchicalChart","Hierarchical"),subMenu:[e("treemapChart","Treemap&lrm;","treemap","pivotTreemap",!0),e("sunburstChart","Sunburst&lrm;","sunburst","pivotSunburst",!0)]},{_key:"pivotCombinationChart",name:t("combinationChart","Combination"),subMenu:[e("columnLineCombo","Column & Line&lrm;","columnLineCombo","pivotColumnLineCombo"),e("AreaColumnCombo","Area & Column&lrm;","areaColumnCombo","pivotAreaColumnCombo")]}],icon:d.createIconNoSpan("chart",this.gos,void 0)}}getConfigLookup(){return{columnGroup:{_key:"pivotColumnChart",column:"pivotGroupedColumn",stackedColumn:"pivotStackedColumn",normalizedColumn:"pivotNormalizedColumn"},barGroup:{_key:"pivotBarChart",bar:"pivotGroupedBar",stackedBar:"pivotStackedBar",normalizedBar:"pivotNormalizedBar"},pieGroup:{_key:"pivotPieChart",pie:"pivotPie",donut:"pivotDonut",doughnut:"pivotDonut"},lineGroup:{_key:"pivotLineChart",line:"pivotLineChart"},scatterGroup:{_key:"pivotXYChart",bubble:"pivotBubble",scatter:"pivotScatter"},areaGroup:{_key:"pivotAreaChart",area:"pivotArea",stackedArea:"pivotStackedArea",normalizedArea:"pivotNormalizedArea"},combinationGroup:{_key:"pivotCombinationChart",columnLineCombo:"pivotColumnLineCombo",areaColumnCombo:"pivotAreaColumnCombo",customCombo:null},hierarchicalGroup:{_key:"pivotHierarchicalChart",treemap:"pivotTreemap",sunburst:"pivotSunburst"},statisticalGroup:{_key:"pivotStatisticalChart",histogram:"pivotHistogram",rangeBar:null,rangeArea:null,boxPlot:null},polarGroup:null,specializedGroup:null}}},ro=class{constructor(t,e,s){this.gos=t,this.chartService=e,this.localeService=s}getMenuItem(){const t=this.localeService.getLocaleTextFunc(),e=(s,i,r,o,n=!1)=>({name:t(s,i),action:()=>this.chartService.createChartFromCurrentRange(r),_key:o,_enterprise:n});return{name:t("chartRange","Chart Range"),_key:"chartRange",subMenu:[{name:t("columnChart","Column"),subMenu:[e("groupedColumn","Grouped&lrm;","groupedColumn","rangeGroupedColumn"),e("stackedColumn","Stacked&lrm;","stackedColumn","rangeStackedColumn"),e("normalizedColumn","100% Stacked&lrm;","normalizedColumn","rangeNormalizedColumn")],_key:"rangeColumnChart"},{name:t("barChart","Bar"),subMenu:[e("groupedBar","Grouped&lrm;","groupedBar","rangeGroupedBar"),e("stackedBar","Stacked&lrm;","stackedBar","rangeStackedBar"),e("normalizedBar","100% Stacked&lrm;","normalizedBar","rangeNormalizedBar")],_key:"rangeBarChart"},{name:t("pieChart","Pie"),subMenu:[e("pie","Pie&lrm;","pie","rangePie"),e("donut","Donut&lrm;","donut","rangeDonut")],_key:"rangePieChart"},e("line","Line&lrm;","line","rangeLineChart"),{name:t("xyChart","X Y (Scatter)"),subMenu:[e("scatter","Scatter&lrm;","scatter","rangeScatter"),e("bubble","Bubble&lrm;","bubble","rangeBubble")],_key:"rangeXYChart"},{name:t("areaChart","Area"),subMenu:[e("area","Area&lrm;","area","rangeArea"),e("stackedArea","Stacked&lrm;","stackedArea","rangeStackedArea"),e("normalizedArea","100% Stacked&lrm;","normalizedArea","rangeNormalizedArea")],_key:"rangeAreaChart"},{name:t("polarChart","Polar"),subMenu:[e("radarLine","Radar Line&lrm;","radarLine","rangeRadarLine"),e("radarArea","Radar Area&lrm;","radarArea","rangeRadarArea"),e("nightingale","Nightingale&lrm;","nightingale","rangeNightingale"),e("radialColumn","Radial Column&lrm;","radialColumn","rangeRadialColumn"),e("radialBar","Radial Bar&lrm;","radialBar","rangeRadialBar")],_key:"rangePolarChart",_enterprise:!0},{name:t("statisticalChart","Statistical"),subMenu:[e("boxPlot","Box Plot&lrm;","boxPlot","rangeBoxPlot",!0),e("histogramChart","Histogram&lrm;","histogram","rangeHistogram",!1),e("rangeBar","Range Bar&lrm;","rangeBar","rangeRangeBar",!0),e("rangeArea","Range Area&lrm;","rangeArea","rangeRangeArea",!0)],_key:"rangeStatisticalChart",_enterprise:!1},{name:t("hierarchicalChart","Hierarchical"),subMenu:[e("treemap","Treemap&lrm;","treemap","rangeTreemap"),e("sunburst","Sunburst&lrm;","sunburst","rangeSunburst")],_key:"rangeHierarchicalChart",_enterprise:!0},{name:t("specializedChart","Specialized"),subMenu:[e("heatmap","Heatmap&lrm;","heatmap","rangeHeatmap"),e("waterfall","Waterfall&lrm;","waterfall","rangeWaterfall")],_key:"rangeSpecializedChart",_enterprise:!0},{name:t("combinationChart","Combination"),subMenu:[e("columnLineCombo","Column & Line&lrm;","columnLineCombo","rangeColumnLineCombo"),e("AreaColumnCombo","Area & Column&lrm;","areaColumnCombo","rangeAreaColumnCombo")],_key:"rangeCombinationChart"}],icon:d.createIconNoSpan("chart",this.gos,void 0)}}getConfigLookup(){return{columnGroup:{_key:"rangeColumnChart",column:"rangeGroupedColumn",stackedColumn:"rangeStackedColumn",normalizedColumn:"rangeNormalizedColumn"},barGroup:{_key:"rangeBarChart",bar:"rangeGroupedBar",stackedBar:"rangeStackedBar",normalizedBar:"rangeNormalizedBar"},pieGroup:{_key:"rangePieChart",pie:"rangePie",donut:"rangeDonut",doughnut:"rangeDonut"},lineGroup:{_key:"rangeLineChart",line:"rangeLineChart"},scatterGroup:{_key:"rangeXYChart",bubble:"rangeBubble",scatter:"rangeScatter"},areaGroup:{_key:"rangeAreaChart",area:"rangeArea",stackedArea:"rangeStackedArea",normalizedArea:"rangeNormalizedArea"},polarGroup:{_key:"rangePolarChart",radarLine:"rangeRadarLine",radarArea:"rangeRadarArea",nightingale:"rangeNightingale",radialColumn:"rangeRadialColumn",radialBar:"rangeRadialBar"},statisticalGroup:{_key:"rangeStatisticalChart",boxPlot:"rangeBoxPlot",histogram:"rangeHistogram",rangeBar:"rangeRangeBar",rangeArea:"rangeRangeArea"},hierarchicalGroup:{_key:"rangeHierarchicalChart",treemap:"rangeTreemap",sunburst:"rangeSunburst"},specializedGroup:{_key:"rangeSpecializedChart",heatmap:"rangeHeatmap",waterfall:"rangeWaterfall"},combinationGroup:{_key:"rangeCombinationChart",columnLineCombo:"rangeColumnLineCombo",areaColumnCombo:"rangeAreaColumnCombo",customCombo:null}}}},Ge=class extends T{createColumnSelectPanel(t,e,s,i){var r,o;const n=t.createManagedBean(new Xt),a=(o=(r=i!=null?i:e==null?void 0:e.getColDef().columnChooserParams)!=null?r:e==null?void 0:e.getColDef().columnsMenuParams)!=null?o:{},{contractColumnSelection:l,suppressColumnExpandAll:u,suppressColumnFilter:c,suppressColumnSelectAll:h,suppressSyncLayoutWithGrid:g,columnLayout:m}=a;return n.init(!!s,this.gos.addGridCommonParams({suppressColumnMove:!1,suppressValues:!1,suppressPivots:!1,suppressRowGroups:!1,suppressPivotMode:!1,contractColumnSelection:!!l,suppressColumnExpandAll:!!u,suppressColumnFilter:!!c,suppressColumnSelectAll:!!h,suppressSyncLayoutWithGrid:!!m||!!g,onStateUpdated:()=>{}}),"columnMenu"),m&&n.setColumnLayout(m),n}showColumnChooser({column:t,chooserParams:e,eventSource:s}){this.hideActiveColumnChooser();const i=this.createColumnSelectPanel(this,t,!0,e),r=this.localeService.getLocaleTextFunc(),o=this.columnModel.getAllDisplayedColumns().indexOf(t),n=t?this.focusService.getFocusedHeader():null;this.activeColumnChooserDialog=this.createBean(new wt({title:r("chooseColumns","Choose Columns"),component:i,width:300,height:300,resizable:!0,movable:!0,centered:!0,closable:!0,afterGuiAttached:()=>{var a;(a=this.focusService.findNextFocusableElement(i.getGui()))==null||a.focus(),this.dispatchVisibleChangedEvent(!0,t)},closedCallback:a=>{const l=this.activeColumnChooser.getGui();this.destroyBean(this.activeColumnChooser),this.activeColumnChooser=void 0,this.activeColumnChooserDialog=void 0,this.dispatchVisibleChangedEvent(!1,t),t&&this.menuUtils.restoreFocusOnClose({column:t,headerPosition:n,columnIndex:o,eventSource:s},l,a,!0)}})),this.activeColumnChooser=i}hideActiveColumnChooser(){this.activeColumnChooserDialog&&this.destroyBean(this.activeColumnChooserDialog)}dispatchVisibleChangedEvent(t,e){const s={type:f.EVENT_COLUMN_MENU_VISIBLE_CHANGED,visible:t,switchingTab:!1,key:"columnChooser",column:e!=null?e:null};this.eventService.dispatchEvent(s)}};C([p("focusService")],Ge.prototype,"focusService",2);C([p("menuUtils")],Ge.prototype,"menuUtils",2);C([p("columnModel")],Ge.prototype,"columnModel",2);Ge=C([G("columnChooserFactory")],Ge);var H=class extends T{createMenu(t,e,s){const i=t.createManagedBean(new Ht(0,{column:e!=null?e:null,node:null,value:null})),r=this.getMenuItems(e),o=this.menuItemMapper.mapWithStockItems(r,e!=null?e:null,s);return i.addMenuItems(o),i}getMenuItems(t){const e=this.getDefaultMenuOptions(t);let s;const i=t==null?void 0:t.getColDef().mainMenuItems;if(Array.isArray(i))s=i;else if(typeof i=="function")s=i(this.gos.addGridCommonParams({column:t,defaultItems:e}));else{const r=this.gos.getCallback("getMainMenuItems");r&&t?s=r({column:t,defaultItems:e}):s=e}return d.removeRepeatsFromArray(s,H.MENU_ITEM_SEPARATOR),s}getDefaultMenuOptions(t){const e=[],s=this.menuService.isLegacyMenuEnabled();if(!t)return s||e.push("columnChooser"),e.push("resetColumns"),e;const i=!t.getColDef().lockPinned,r=this.columnModel.getRowGroupColumns().length,o=r>0,n=t.isAllowValue(),a=t.isAllowRowGroup(),l=t.isPrimary(),u=this.columnModel.isPivotMode(),c=this.rowModel.getType()==="clientSide",h=this.gos.get("treeData"),g=l&&o&&n||!l;if(!s&&t.isSortable()){const P=t.getSort();P!=="asc"&&e.push("sortAscending"),P!=="desc"&&e.push("sortDescending"),P&&e.push("sortUnSort"),e.push(H.MENU_ITEM_SEPARATOR)}return this.menuService.isFilterMenuItemEnabled(t)&&(e.push("columnFilter"),e.push(H.MENU_ITEM_SEPARATOR)),i&&e.push("pinSubMenu"),g&&e.push("valueAggSubMenu"),(i||g)&&e.push(H.MENU_ITEM_SEPARATOR),e.push("autoSizeThis"),e.push("autoSizeAll"),e.push(H.MENU_ITEM_SEPARATOR),t.getColDef().showRowGroup?e.push("rowUnGroup"):a&&t.isPrimary()&&(t.isRowGroupActive()?this.columnModel.isColumnGroupingLocked(t)||e.push("rowUnGroup"):e.push("rowGroup")),e.push(H.MENU_ITEM_SEPARATOR),s||e.push("columnChooser"),e.push("resetColumns"),c&&(h||r>(u?1:0))&&(e.push("expandAll"),e.push("contractAll")),e}};H.MENU_ITEM_SEPARATOR="separator";C([p("menuItemMapper")],H.prototype,"menuItemMapper",2);C([p("columnModel")],H.prototype,"columnModel",2);C([p("rowModel")],H.prototype,"rowModel",2);C([p("filterManager")],H.prototype,"filterManager",2);C([p("menuService")],H.prototype,"menuService",2);H=C([G("columnMenuFactory")],H);var Ie=class extends T{restoreFocusOnClose(t,e,s,i){const{eventSource:r}=t,o=s instanceof KeyboardEvent;if(!i&&!o||!r)return;const n=this.gos.getDocument(),a=this.gos.getActiveDomElement();!e.contains(a)&&a!==n.body||this.focusHeaderCell(t)}closePopupAndRestoreFocusOnSelect(t,e,s){let i;s&&s.keyboardEvent&&(i=s.keyboardEvent),t(i&&{keyboardEvent:i});const r=this.focusService.getFocusedCell(),o=this.gos.getDocument(),n=this.gos.getActiveDomElement();if(!n||n===o.body)if(r){const{rowIndex:a,rowPinned:l,column:u}=r;this.focusService.setFocusedCell({rowIndex:a,column:u,rowPinned:l,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}else this.focusHeaderCell(e)}onContextMenu(t,e,s){if(!this.gos.get("allowContextMenuWithControlKey")&&t&&(t.ctrlKey||t.metaKey)||(t&&this.blockMiddleClickScrollsIfNeeded(t),this.gos.get("suppressContextMenu")))return;const i=t!=null?t:e.touches[0];if(s(i)){const r=t!=null?t:e;r&&r.cancelable&&r.preventDefault()}}focusHeaderCell(t){const{column:e,columnIndex:s,headerPosition:i,eventSource:r}=t;if(this.columnModel.getAllDisplayedColumns().some(n=>n===e)&&r&&d.isVisible(r)){const n=this.focusService.findTabbableParent(r);n&&(e&&this.headerNavigationService.scrollToColumn(e),n.focus())}else if(i&&s!==-1){const n=this.columnModel.getAllDisplayedColumns(),a=n[s]||d.last(n);a&&this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:i.headerRowIndex,column:a}})}}blockMiddleClickScrollsIfNeeded(t){this.gos.get("suppressMiddleClickScrolls")&&t.which===2&&t.preventDefault()}};C([p("focusService")],Ie.prototype,"focusService",2);C([p("headerNavigationService")],Ie.prototype,"headerNavigationService",2);C([p("columnModel")],Ie.prototype,"columnModel",2);Ie=C([G("menuUtils")],Ie);var Fo={version:so,moduleName:x.MenuModule,beans:[Q,he,Z,Ze,Ge,H,Ie],dependantModules:[_e]},oo=Object.defineProperty,no=Object.getOwnPropertyDescriptor,W=(t,e,s,i)=>{for(var r=i>1?void 0:i?no(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(r=(i?n(e,s,r):n(r))||r);return i&&r&&oo(e,s,r),r},ao=class{constructor(t,e,s,i,r,o,n,a,l,u,c){this.rowModel=t,this.filterParams=e,this.createKey=s,this.caseFormat=i,this.columnModel=r,this.valueService=o,this.treeDataOrGrouping=n,this.treeData=a,this.getDataPath=l,this.groupAllowUnbalanced=u,this.addManagedListener=c}extractUniqueValuesAsync(t,e){return new V(s=>{if(this.rowModel.isRowDataLoaded())s(this.extractUniqueValues(t,e));else{const i=this.addManagedListener(f.EVENT_ROW_COUNT_READY,()=>{i==null||i(),s(this.extractUniqueValues(t,e))})}})}extractUniqueValues(t,e){const s=new Map,i=this.extractExistingFormattedKeys(e),r=new Set,o=this.treeData&&!!this.getDataPath,n=this.columnModel.getRowGroupColumns(),a=(l,u)=>{const c=this.caseFormat(l);if(!r.has(c)){r.add(c);let h=l,g=d.makeNull(u);const m=i==null?void 0:i.get(c);m!=null&&(h=m,g=e.get(m)),s.set(h,g)}};return this.rowModel.forEachLeafNode(l=>{if(!l.data||!t(l))return;if(this.treeDataOrGrouping){this.addValueForTreeDataOrGrouping(l,o,n,a);return}let u=this.getValue(l);if(this.filterParams.convertValuesToStrings){this.addValueForConvertValuesToString(l,u,a);return}u!=null&&Array.isArray(u)?(u.forEach(c=>{a(this.createKey(c,l),c)}),u.length===0&&a(null,null)):a(this.createKey(u,l),u)}),s}addValueForConvertValuesToString(t,e,s){const i=this.createKey(e,t);i!=null&&Array.isArray(i)?(i.forEach(r=>{const o=d.toStringOrNull(d.makeNull(r));s(o,o)}),i.length===0&&s(null,null)):s(i,i)}addValueForTreeDataOrGrouping(t,e,s,i){var r;let o;if(e){if((r=t.childrenAfterGroup)!=null&&r.length)return;o=this.getDataPath(t.data)}else o=s.map(n=>this.valueService.getKeyForNode(n,t)),o.push(this.getValue(t));o&&(o=o.map(n=>d.toStringOrNull(d.makeNull(n)))),!e&&this.groupAllowUnbalanced&&(o==null?void 0:o.some(n=>n==null))&&(o=o.filter(n=>n!=null)),i(this.createKey(o),o)}getValue(t){return this.filterParams.getValue(t)}extractExistingFormattedKeys(t){if(!t)return null;const e=new Map;return t.forEach((s,i)=>{e.set(this.caseFormat(i),i)}),e}},k=class{};k.SELECT_ALL="__AG_SELECT_ALL__";k.ADD_SELECTION_TO_FILTER="__AG_ADD_SELECTION_TO_FILTER__";var lo=class{constructor(t,e,s,i){this.valueService=t,this.valueFormatter=e,this.formatter=s,this.column=i,this.displayedKeys=[]}updateDisplayedValuesToAllAvailable(t,e,s){this.displayedKeys=Array.from(s)}updateDisplayedValuesToMatchMiniFilter(t,e,s,i,r){this.displayedKeys=[];for(let o of s)if(o==null)r&&this.displayedKeys.push(o);else{const n=t(o),a=this.valueService.formatValue(this.column,null,n,this.valueFormatter,!1),l=this.formatter(a);i(l)&&this.displayedKeys.push(o)}}getDisplayedValueCount(){return this.displayedKeys.length}getDisplayedItem(t){return this.displayedKeys[t]}getSelectAllItem(){return k.SELECT_ALL}getAddSelectionToFilterItem(){return k.ADD_SELECTION_TO_FILTER}getDisplayedKeys(){return this.displayedKeys}forEachDisplayedKey(t){this.displayedKeys.forEach(t)}someDisplayedKey(t){return this.displayedKeys.some(t)}hasGroups(){return!1}refresh(){}},ti=class si{constructor(e,s,i,r){this.formatter=e,this.treeListPathGetter=s,this.treeListFormatter=i,this.treeDataOrGrouping=r,this.allDisplayedItemsTree=[],this.activeDisplayedItemsFlat=[],this.selectAllItem={depth:0,filterPasses:!0,available:!0,treeKey:k.SELECT_ALL,children:this.allDisplayedItemsTree,expanded:!0,key:k.SELECT_ALL,parentTreeKeys:[]},this.addSelectionToFilterItem={depth:0,filterPasses:!0,available:!0,treeKey:k.ADD_SELECTION_TO_FILTER,expanded:!0,key:k.ADD_SELECTION_TO_FILTER,parentTreeKeys:[]}}updateDisplayedValuesToAllAvailable(e,s,i,r){r==="reload"?this.generateItemTree(e,s,i):r==="otherFilter"?(this.updateAvailable(i),this.updateExpandAll()):r==="miniFilter"&&(this.resetFilter(),this.updateExpandAll()),this.flattenItems()}updateDisplayedValuesToMatchMiniFilter(e,s,i,r,o,n){n==="reload"?this.generateItemTree(e,s,i):n==="otherFilter"&&this.updateAvailable(i),this.updateFilter(r,o),this.updateExpandAll(),this.flattenItems()}generateItemTree(e,s,i){var r;this.allDisplayedItemsTree=[],this.groupsExist=!1;const o=this.getTreeListPathGetter(e,i);for(let n of s){const a=e(n),l=(r=o(a))!=null?r:[null];l.length>1&&(this.groupsExist=!0);const u=i.has(n);let c=this.allDisplayedItemsTree,h,g=[];l.forEach((m,y)=>{c||(c=[],h.children=c),h=c.find(P=>{var w;return((w=P.treeKey)==null?void 0:w.toUpperCase())===(m==null?void 0:m.toUpperCase())}),h||(h={treeKey:m,depth:y,filterPasses:!0,expanded:!1,available:u,parentTreeKeys:g},y===l.length-1&&(h.key=n),c.push(h)),c=h.children,g=[...g,m]})}this.updateAvailable(i),this.selectAllItem.children=this.allDisplayedItemsTree,this.selectAllItem.expanded=!1}getTreeListPathGetter(e,s){if(this.treeListPathGetter)return this.treeListPathGetter;if(this.treeDataOrGrouping)return r=>r;let i=!1;for(const r of s){const o=e(r);if(o instanceof Date){i=!0;break}else if(o!=null)break}return i?si.DATE_TREE_LIST_PATH_GETTER:(d.warnOnce("property treeList=true for Set Filter params, but you did not provide a treeListPathGetter or values of type Date."),r=>[String(r)])}flattenItems(){this.activeDisplayedItemsFlat=[];const e=s=>{s.forEach(i=>{!i.filterPasses||!i.available||(this.activeDisplayedItemsFlat.push(i),i.children&&i.expanded&&e(i.children))})};e(this.allDisplayedItemsTree)}resetFilter(){const e=s=>{s.children&&s.children.forEach(i=>{e(i)}),s.filterPasses=!0};this.allDisplayedItemsTree.forEach(s=>e(s))}updateFilter(e,s){const i=r=>r.available?r.treeKey==null?s:e(this.formatter(this.treeListFormatter?this.treeListFormatter(r.treeKey,r.depth,r.parentTreeKeys):r.treeKey)):!1;this.allDisplayedItemsTree.forEach(r=>this.recursiveItemCheck(r,!1,i,"filterPasses"))}getDisplayedValueCount(){return this.activeDisplayedItemsFlat.length}getDisplayedItem(e){return this.activeDisplayedItemsFlat[e]}getSelectAllItem(){return this.selectAllItem}getAddSelectionToFilterItem(){return this.addSelectionToFilterItem}getDisplayedKeys(){const e=[];return this.forEachDisplayedKey(s=>e.push(s)),e}forEachDisplayedKey(e){const s=(i,r)=>{i.children?(!i.expanded||!r)&&i.children.forEach(o=>{o.filterPasses&&s(o,!1)}):e(i.key)};this.activeDisplayedItemsFlat.forEach(i=>s(i,!0))}someDisplayedKey(e){const s=(i,r)=>{if(i.children){if(!i.expanded||!r)return i.children.some(o=>o.filterPasses?s(o,!1):!1)}else return e(i.key);return!1};return this.activeDisplayedItemsFlat.some(i=>s(i,!0))}hasGroups(){return this.groupsExist}refresh(){this.updateExpandAll(),this.flattenItems()}updateExpandAll(){const e=(i,r,o)=>{for(const n of i){if(!n.filterPasses||!n.available||!n.children)continue;if(r=r||!!n.expanded,o=o||!n.expanded,r&&o)return;const a=e(n.children,r,o);if(a===void 0)return;a?r=!0:o=!0}return r&&o?void 0:r},s=this.getSelectAllItem();s.expanded=e(s.children,!1,!1)}recursiveItemCheck(e,s,i,r){let o=!1;e.children&&e.children.forEach(a=>{const l=this.recursiveItemCheck(a,s||i(e),i,r);o=o||l});const n=s||o||i(e);return e[r]=n,n}updateAvailable(e){const s=i=>e.has(i.key);this.allDisplayedItemsTree.forEach(i=>this.recursiveItemCheck(i,!1,s,"available"))}};ti.DATE_TREE_LIST_PATH_GETTER=t=>t?[String(t.getFullYear()),String(t.getMonth()+1),String(t.getDate())]:null;var uo=ti,co=class{constructor({caseFormat:t}){this.filteringKeys=null,this.filteringKeysCaseFormatted=null,this.hasNoAppliedFilteringKeys=!1,this.caseFormat=t}allFilteringKeys(){return this.filteringKeys}allFilteringKeysCaseFormatted(){return this.filteringKeysCaseFormatted}noAppliedFilteringKeys(){return this.hasNoAppliedFilteringKeys}setFilteringKeys(t){this.filteringKeys=new Set(t),this.hasNoAppliedFilteringKeys=!this.filteringKeys||this.filteringKeys.size===0,this.filteringKeysCaseFormatted=new Set,this.filteringKeys.forEach(e=>this.filteringKeysCaseFormatted.add(this.caseFormat(e)))}addFilteringKey(t){this.filteringKeys==null&&(this.filteringKeys=new Set,this.filteringKeysCaseFormatted=new Set),this.filteringKeys.add(t),this.filteringKeysCaseFormatted.add(this.caseFormat(t)),this.hasNoAppliedFilteringKeys&&(this.hasNoAppliedFilteringKeys=!1)}hasCaseFormattedFilteringKey(t){return this.filteringKeysCaseFormatted.has(this.caseFormat(t))}hasFilteringKey(t){return this.filteringKeys.has(t)}reset(){this.filteringKeys=null,this.filteringKeysCaseFormatted=null,this.hasNoAppliedFilteringKeys=!1}},ii=class ri{constructor(e){this.localEventService=new Ls,this.miniFilterText=null,this.addCurrentSelectionToFilter=!1,this.providedValues=null,this.allValues=new Map,this.availableKeys=new Set,this.selectedKeys=new Set,this.initialised=!1;const{usingComplexObjects:s,columnModel:i,valueService:r,treeDataTreeList:o,groupingTreeList:n,filterParams:a,gos:l,valueFormatter:u,addManagedListener:c}=e,{column:h,colDef:g,textFormatter:m,doesRowPassOtherFilter:y,suppressSorting:P,comparator:w,rowModel:j,values:R,caseSensitive:ee,convertValuesToStrings:ke,treeList:ve,treeListPathGetter:be,treeListFormatter:tt}=a;this.filterParams=a,this.gos=l,this.setIsLoading=e.setIsLoading,this.translate=e.translate,this.caseFormat=e.caseFormat,this.createKey=e.createKey,this.usingComplexObjects=!!e.usingComplexObjects,this.formatter=m||ss.DEFAULT_FORMATTER,this.doesRowPassOtherFilters=y,this.suppressSorting=P||!1,this.convertValuesToStrings=!!ke,this.filteringKeys=new co({caseFormat:this.caseFormat});const Te=w!=null?w:g.comparator,At=!!o||!!n;this.compareByValue=!!(s&&Te||At||ve&&!be),At&&!Te?this.entryComparator=this.createTreeDataOrGroupingComparator():ve&&!be&&!Te?this.entryComparator=([Ft,St],[di,Mt])=>d.defaultComparator(St,Mt):this.entryComparator=([Ft,St],[di,Mt])=>Te(St,Mt),this.keyComparator=Te!=null?Te:d.defaultComparator,this.caseSensitive=!!ee;const ai=l.get("getDataPath"),li=l.get("groupAllowUnbalanced");j.getType()==="clientSide"&&(this.clientSideValuesExtractor=new ao(j,this.filterParams,this.createKey,this.caseFormat,i,r,At,!!o,ai,li,c)),R==null?this.valuesType=2:(this.valuesType=Array.isArray(R)?0:1,this.providedValues=R),this.displayValueModel=ve?new uo(this.formatter,be,tt,o||n):new lo(r,u,this.formatter,h),this.updateAllValues().then(Ft=>this.resetSelectionState(Ft||[]))}addEventListener(e,s,i){this.localEventService.addEventListener(e,s,i)}removeEventListener(e,s,i){this.localEventService.removeEventListener(e,s,i)}updateOnParamsChange(e){return new V(s=>{const{values:i,textFormatter:r,suppressSorting:o}=e,n=this.providedValues,a=this.suppressSorting;if(this.filterParams=e,this.formatter=r||ss.DEFAULT_FORMATTER,this.suppressSorting=o||!1,this.providedValues=i!=null?i:null,this.providedValues!==n||this.suppressSorting!==a){!i||i.length===0?(this.valuesType=2,this.providedValues=null):this.valuesType=Array.isArray(i)?0:1;const l=this.getModel();this.updateAllValues().then(u=>{this.setModel(l).then(()=>s())})}else s()})}refreshValues(){return new V(e=>{this.allValuesPromise.then(()=>{const s=this.getModel();this.updateAllValues(),this.setModel(s).then(()=>e())})})}overrideValues(e){return new V(s=>{this.allValuesPromise.then(()=>{this.valuesType=0,this.providedValues=e,this.refreshValues().then(()=>s())})})}refreshAfterAnyFilterChanged(){return this.showAvailableOnly()?this.allValuesPromise.then(e=>(this.updateAvailableKeys(e!=null?e:[],"otherFilter"),!0)):V.resolve(!1)}isInitialised(){return this.initialised}updateAllValues(){return this.allValuesPromise=new V(e=>{switch(this.valuesType){case 2:this.getValuesFromRowsAsync(!1).then(s=>e(this.processAllValues(s)));break;case 0:{e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(this.providedValues))));break}case 1:{this.setIsLoading(!0);const s=this.providedValues,{column:i,colDef:r}=this.filterParams,o=this.gos.addGridCommonParams({success:n=>{this.setIsLoading(!1),e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(n))))},colDef:r,column:i});window.setTimeout(()=>s(o),0);break}default:throw new Error("Unrecognised valuesType")}}),this.allValuesPromise.then(e=>this.updateAvailableKeys(e||[],"reload")).then(()=>this.initialised=!0),this.allValuesPromise}processAllValues(e){const s=this.sortKeys(e);return this.allValues=e!=null?e:new Map,s}validateProvidedValues(e){if(this.usingComplexObjects&&(e==null?void 0:e.length)){const s=e[0];s&&typeof s!="object"&&typeof s!="function"&&(this.createKey(s)==null?d.warnOnce("Set Filter Key Creator is returning null for provided values and provided values are primitives. Please provide complex objects or set convertValuesToStrings=true in the filterParams. See https://www.ag-grid.com/javascript-data-grid/filter-set-filter-list/#filter-value-types"):d.warnOnce("Set Filter has a Key Creator, but provided values are primitives. Did you mean to provide complex objects or enable convertValuesToStrings?"))}return e}setValuesType(e){this.valuesType=e}getValuesType(){return this.valuesType}isKeyAvailable(e){return this.availableKeys.has(e)}showAvailableOnly(){return this.valuesType===2}updateAvailableKeys(e,s){const i=this.showAvailableOnly()?this.sortKeys(this.getValuesFromRows(!0)):e;this.availableKeys=new Set(i),this.localEventService.dispatchEvent({type:ri.EVENT_AVAILABLE_VALUES_CHANGED}),this.updateDisplayedValues(s,e)}sortKeys(e){const s=e!=null?e:new Map;if(this.suppressSorting)return Array.from(s.keys());let i;return this.compareByValue?i=Array.from(s.entries()).sort(this.entryComparator).map(([r])=>r):i=Array.from(s.keys()).sort(this.keyComparator),this.filterParams.excelMode&&s.has(null)&&(i=i.filter(r=>r!=null),i.push(null)),i}getParamsForValuesFromRows(e=!1){if(!this.clientSideValuesExtractor)return d.doOnce(()=>{console.error("AG Grid: Set Filter cannot initialise because you are using a row model that does not contain all rows in the browser. Either use a different filter type, or configure Set Filter such that you provide it with values")},"setFilterValueNotCSRM"),null;const s=r=>!e||this.doesRowPassOtherFilters(r),i=e&&!this.caseSensitive?this.allValues:void 0;return{predicate:s,existingValues:i}}getValuesFromRows(e=!1){const s=this.getParamsForValuesFromRows(e);return s?this.clientSideValuesExtractor.extractUniqueValues(s.predicate,s.existingValues):null}getValuesFromRowsAsync(e=!1){const s=this.getParamsForValuesFromRows(e);return s?this.clientSideValuesExtractor.extractUniqueValuesAsync(s.predicate,s.existingValues):V.resolve(null)}setMiniFilter(e){return e=d.makeNull(e),this.miniFilterText===e?!1:(e===null&&this.setAddCurrentSelectionToFilter(!1),this.miniFilterText=e,this.updateDisplayedValues("miniFilter"),!0)}getMiniFilter(){return this.miniFilterText}updateDisplayedValues(e,s){if(e==="expansion"){this.displayValueModel.refresh();return}if(this.miniFilterText==null){this.displayValueModel.updateDisplayedValuesToAllAvailable(n=>this.getValue(n),s,this.availableKeys,e);return}const i=this.caseFormat(this.formatter(this.miniFilterText)||""),r=n=>n!=null&&this.caseFormat(n).indexOf(i)>=0,o=!!this.filterParams.excelMode&&r(this.translate("blanks"));this.displayValueModel.updateDisplayedValuesToMatchMiniFilter(n=>this.getValue(n),s,this.availableKeys,r,o,e)}getDisplayedValueCount(){return this.displayValueModel.getDisplayedValueCount()}getDisplayedItem(e){return this.displayValueModel.getDisplayedItem(e)}getSelectAllItem(){return this.displayValueModel.getSelectAllItem()}getAddSelectionToFilterItem(){return this.displayValueModel.getAddSelectionToFilterItem()}hasSelections(){return this.filterParams.defaultToNothingSelected?this.selectedKeys.size>0:this.allValues.size!==this.selectedKeys.size}getKeys(){return Array.from(this.allValues.keys())}getValues(){return Array.from(this.allValues.values())}getValue(e){return this.allValues.get(e)}setAddCurrentSelectionToFilter(e){this.addCurrentSelectionToFilter=e}isInWindowsExcelMode(){return this.filterParams.excelMode==="windows"}isAddCurrentSelectionToFilterChecked(){return this.isInWindowsExcelMode()&&this.addCurrentSelectionToFilter}showAddCurrentSelectionToFilter(){return this.isInWindowsExcelMode()&&d.exists(this.miniFilterText)&&this.miniFilterText.length>0}selectAllMatchingMiniFilter(e=!1){this.miniFilterText==null?this.selectedKeys=new Set(this.allValues.keys()):(e&&this.selectedKeys.clear(),this.displayValueModel.forEachDisplayedKey(s=>this.selectedKeys.add(s)))}deselectAllMatchingMiniFilter(){this.miniFilterText==null?this.selectedKeys.clear():this.displayValueModel.forEachDisplayedKey(e=>this.selectedKeys.delete(e))}selectKey(e){this.selectedKeys.add(e)}deselectKey(e){this.filterParams.excelMode&&this.isEverythingVisibleSelected()&&this.resetSelectionState(this.displayValueModel.getDisplayedKeys()),this.selectedKeys.delete(e)}isKeySelected(e){return this.selectedKeys.has(e)}isEverythingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>!this.isKeySelected(e))}isNothingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>this.isKeySelected(e))}getModel(){if(!this.hasSelections())return null;const e=this.isAddCurrentSelectionToFilterChecked()?this.filteringKeys.allFilteringKeys():null;if(e&&e.size>0){if(this.selectedKeys){const s=new Set([...Array.from(e),...Array.from(this.selectedKeys).filter(i=>!e.has(i))]);return Array.from(s)}return Array.from(e)}return Array.from(this.selectedKeys)}setModel(e){return this.allValuesPromise.then(s=>{if(e==null)this.resetSelectionState(s!=null?s:[]);else{this.selectedKeys.clear();const i=new Map;this.allValues.forEach((r,o)=>{i.set(this.caseFormat(o),o)}),e.forEach(r=>{const o=this.caseFormat(d.makeNull(r)),n=i.get(o);n!==void 0&&this.selectKey(n)})}})}uniqueValues(e){const s=new Map,i=new Set;return(e!=null?e:[]).forEach(r=>{const o=d.makeNull(r),n=this.convertAndGetKey(o),a=this.caseFormat(n);i.has(a)||(i.add(a),s.set(n,o))}),s}convertAndGetKey(e){return this.convertValuesToStrings?e:this.createKey(e)}resetSelectionState(e){this.filterParams.defaultToNothingSelected?this.selectedKeys.clear():this.selectedKeys=new Set(e)}hasGroups(){return this.displayValueModel.hasGroups()}createTreeDataOrGroupingComparator(){return([e,s],[i,r])=>{if(s==null)return r==null?0:-1;if(r==null)return 1;for(let o=0;o<s.length;o++){if(o>=r.length)return 1;const n=d.defaultComparator(s[o],r[o]);if(n!==0)return n}return 0}}setAppliedModelKeys(e){this.filteringKeys.setFilteringKeys(e)}addToAppliedModelKeys(e){this.filteringKeys.addFilteringKey(e)}getAppliedModelKeys(){return this.filteringKeys.allFilteringKeys()}getCaseFormattedAppliedModelKeys(){return this.filteringKeys.allFilteringKeysCaseFormatted()}hasAppliedModelKey(e){return this.filteringKeys.hasCaseFormattedFilteringKey(e)}hasAnyAppliedModelKey(){return!this.filteringKeys.noAppliedFilteringKeys()}};ii.EVENT_AVAILABLE_VALUES_CHANGED="availableValuesChanged";var oi=ii,J=class We extends L{constructor(e){var s;super(e.isGroup?We.GROUP_TEMPLATE:We.TEMPLATE),this.focusWrapper=e.focusWrapper,this.value=e.value,this.params=e.params,this.translate=e.translate,this.valueFormatter=e.valueFormatter,this.item=e.item,this.isSelected=e.isSelected,this.isTree=e.isTree,this.depth=(s=e.depth)!=null?s:0,this.isGroup=e.isGroup,this.groupsExist=e.groupsExist,this.isExpanded=e.isExpanded,this.hasIndeterminateExpandState=e.hasIndeterminateExpandState}init(){this.addDestroyFunc(()=>{var e;return(e=this.destroyCellRendererComponent)==null?void 0:e.call(this)}),this.render(),this.eCheckbox.setLabelEllipsis(!0).setValue(this.isSelected,!0).setDisabled(!!this.params.readOnly).getInputElement().setAttribute("tabindex","-1"),this.refreshVariableAriaLabels(),this.isTree&&(this.depth>0&&this.addCssClass("ag-set-filter-indent-"+this.depth),this.isGroup?this.setupExpansion():this.groupsExist&&this.addCssClass("ag-set-filter-add-group-indent"),d.setAriaLevel(this.getAriaElement(),this.depth+1)),this.refreshAriaChecked(),!this.params.readOnly&&this.eCheckbox.onValueChange(e=>this.onCheckboxChanged(!!e))}getFocusableElement(){return this.focusWrapper}setupExpansion(){this.eGroupClosedIcon.appendChild(d.createIcon("setFilterGroupClosed",this.gos,null)),this.eGroupOpenedIcon.appendChild(d.createIcon("setFilterGroupOpen",this.gos,null)),this.addManagedListener(this.eGroupClosedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.addManagedListener(this.eGroupOpenedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.hasIndeterminateExpandState&&(this.eGroupIndeterminateIcon.appendChild(d.createIcon("setFilterGroupIndeterminate",this.gos,null)),this.addManagedListener(this.eGroupIndeterminateIcon,"click",this.onExpandOrContractClicked.bind(this))),this.setExpandedIcons(),this.refreshAriaExpanded()}onExpandOrContractClicked(){this.setExpanded(!this.isExpanded)}setExpanded(e,s){if(this.isGroup&&e!==this.isExpanded){this.isExpanded=e;const i={type:We.EVENT_EXPANDED_CHANGED,isExpanded:!!e,item:this.item};s||this.dispatchEvent(i),this.setExpandedIcons(),this.refreshAriaExpanded()}}setExpandedIcons(){d.setDisplayed(this.eGroupClosedIcon,this.hasIndeterminateExpandState?this.isExpanded===!1:!this.isExpanded),d.setDisplayed(this.eGroupOpenedIcon,this.isExpanded===!0),this.hasIndeterminateExpandState&&d.setDisplayed(this.eGroupIndeterminateIcon,this.isExpanded===void 0)}onCheckboxChanged(e){this.isSelected=e;const s={type:We.EVENT_SELECTION_CHANGED,isSelected:e,item:this.item};this.dispatchEvent(s),this.refreshVariableAriaLabels(),this.refreshAriaChecked()}toggleSelected(){this.params.readOnly||this.setSelected(!this.isSelected)}setSelected(e,s){this.isSelected=e,this.eCheckbox.setValue(e,s),this.refreshAriaChecked()}refreshVariableAriaLabels(){if(!this.isTree)return;const e=this.localeService.getLocaleTextFunc(),s=this.eCheckbox.getValue(),i=s===void 0?e("ariaIndeterminate","indeterminate"):s?e("ariaVisible","visible"):e("ariaHidden","hidden"),r=e("ariaToggleVisibility","Press SPACE to toggle visibility");d.setAriaLabelledBy(this.eCheckbox.getInputElement(),void 0),this.eCheckbox.setInputAriaLabel(`${r} (${i})`)}setupFixedAriaLabels(e){if(!this.isTree)return;const i=this.localeService.getLocaleTextFunc()("ariaFilterValue","Filter Value"),r=this.getAriaElement();d.setAriaLabel(r,`${e} ${i}`),d.setAriaDescribedBy(r,this.eCheckbox.getInputElement().id)}refreshAriaChecked(){const e=this.getAriaElement();d.setAriaChecked(e,this.eCheckbox.getValue())}refreshAriaExpanded(){d.setAriaExpanded(this.getAriaElement(),!!this.isExpanded)}refresh(e,s,i){var r,o;if(this.item=e,s!==this.isSelected&&this.setSelected(s,!0),this.setExpanded(i,!0),this.valueFunction){const n=this.valueFunction();this.setTooltipAndCellRendererParams(n,n),this.cellRendererComponent||this.renderCellWithoutCellRenderer()}if(this.cellRendererComponent&&!((o=(r=this.cellRendererComponent).refresh)==null?void 0:o.call(r,this.cellRendererParams))){const a=this.cellRendererComponent;this.renderCell(),this.destroyBean(a)}}render(){const{params:{column:e}}=this;let{value:s}=this,i=null;typeof s=="function"?(this.valueFunction=s,i=this.valueFunction(),s=i):this.isTree?i=d.toStringOrNull(s):i=this.getFormattedValue(e,s),this.setTooltipAndCellRendererParams(s,i),this.renderCell()}setTooltipAndCellRendererParams(e,s){const i=this.gos.get("tooltipShowMode")==="whenTruncated";if(this.params.showTooltips&&(!i||!this.params.cellRenderer)){const r=s!=null?s:d.toStringOrNull(e);let o;i&&(o=()=>{const n=this.eCheckbox.getGui().querySelector(".ag-label");return n?n.scrollWidth>n.clientWidth:!0}),this.setTooltip({newTooltipText:r,location:"setFilterValue",getColDef:()=>this.params.colDef,getColumn:()=>this.params.column,shouldDisplayTooltip:o})}this.cellRendererParams=this.gos.addGridCommonParams({value:e,valueFormatted:s,colDef:this.params.colDef,column:this.params.column,setTooltip:(r,o)=>{this.setTooltip({newTooltipText:r,getColDef:()=>this.params.colDef,getColumn:()=>this.params.column,location:"setFilterValue",shouldDisplayTooltip:o})}})}getTooltipParams(){const e=super.getTooltipParams();return e.location="setFilterValue",e.colDef=this.getComponentHolder(),this.isTree&&(e.level=this.depth),e}getFormattedValue(e,s){return this.valueService.formatValue(e,null,s,this.valueFormatter,!1)}renderCell(){const e=this.userComponentFactory.getSetFilterCellRendererDetails(this.params,this.cellRendererParams),s=e?e.newAgStackInstance():void 0;if(s==null){this.renderCellWithoutCellRenderer();return}s.then(i=>{i&&(this.cellRendererComponent=i,this.eCheckbox.setLabel(i.getGui()),this.destroyCellRendererComponent=()=>this.destroyBean(i))})}renderCellWithoutCellRenderer(){var e;let s=(e=this.cellRendererParams.valueFormatted==null?this.cellRendererParams.value:this.cellRendererParams.valueFormatted)!=null?e:this.translate("blanks");typeof s!="string"&&(d.warnOnce(`Set Filter Value Formatter must return string values. Please ensure the Set Filter Value Formatter returns string values for complex objects, or set convertValuesToStrings=true in the filterParams. See ${this.getFrameworkOverrides().getDocLink("filter-set-filter-list/#filter-value-types")}`),s=""),this.eCheckbox.setLabel(s),this.setupFixedAriaLabels(s)}getComponentHolder(){return this.params.column.getColDef()}};J.EVENT_SELECTION_CHANGED="selectionChanged";J.EVENT_EXPANDED_CHANGED="expandedChanged";J.GROUP_TEMPLATE=`
        <div class="ag-set-filter-item" aria-hidden="true">
            <span class="ag-set-filter-group-icons">
                <span class="ag-set-filter-group-closed-icon" ref="eGroupClosedIcon"></span>
                <span class="ag-set-filter-group-opened-icon" ref="eGroupOpenedIcon"></span>
                <span class="ag-set-filter-group-indeterminate-icon" ref="eGroupIndeterminateIcon"></span>
            </span>
            <ag-checkbox ref="eCheckbox" class="ag-set-filter-item-checkbox"></ag-checkbox>
        </div>`;J.TEMPLATE=`
        <div class="ag-set-filter-item">
            <ag-checkbox ref="eCheckbox" class="ag-set-filter-item-checkbox"></ag-checkbox>
        </div>`;W([p("valueService")],J.prototype,"valueService",2);W([p("userComponentFactory")],J.prototype,"userComponentFactory",2);W([E("eCheckbox")],J.prototype,"eCheckbox",2);W([E("eGroupOpenedIcon")],J.prototype,"eGroupOpenedIcon",2);W([E("eGroupClosedIcon")],J.prototype,"eGroupClosedIcon",2);W([E("eGroupIndeterminateIcon")],J.prototype,"eGroupIndeterminateIcon",2);W([b],J.prototype,"init",1);var Lt=J,ho={loadingOoo:"Loading...",blanks:"(Blanks)",searchOoo:"Search...",selectAll:"(Select All)",selectAllSearchResults:"(Select All Search Results)",addCurrentSelectionToFilter:"Add current selection to filter",noMatches:"No matches."},ni=class{getModelAsString(t,e){const{values:s}=t||e.getModel()||{},i=e.getValueModel();if(s==null||i==null)return"";const r=s.filter(a=>i.isKeyAvailable(a)),o=r.length,n=r.slice(0,10).map(a=>e.getFormattedValue(a));return`(${o}) ${n.join(",")}${o>10?",...":""}`}},fe=class extends Ti{constructor(){super("setFilter"),this.valueModel=null,this.setFilterParams=null,this.virtualList=null,this.caseSensitive=!1,this.convertValuesToStrings=!1,this.treeDataTreeList=!1,this.groupingTreeList=!1,this.hardRefreshVirtualList=!1,this.noValueFormatterSupplied=!1,this.filterModelFormatter=new ni,this.updateSetFilterOnParamsChange=t=>{var e;this.setFilterParams=t,this.convertValuesToStrings=!!t.convertValuesToStrings,this.caseSensitive=!!t.caseSensitive;const s=(e=t.keyCreator)!=null?e:t.colDef.keyCreator;this.setValueFormatter(t.valueFormatter,s,this.convertValuesToStrings,!!t.treeList,!!t.colDef.refData);const i=t.column.getId().startsWith(Di);this.treeDataTreeList=this.gos.get("treeData")&&!!t.treeList&&i,this.getDataPath=this.gos.get("getDataPath"),this.groupingTreeList=!!this.columnModel.getRowGroupColumns().length&&!!t.treeList&&i,this.createKey=this.generateCreateKey(s,this.convertValuesToStrings,this.treeDataTreeList||this.groupingTreeList)}}postConstruct(){super.postConstruct()}updateUiVisibility(){}createBodyTemplate(){return`
            <div class="ag-set-filter">
                <div ref="eFilterLoading" class="ag-filter-loading ag-hidden">${this.translateForSetFilter("loadingOoo")}</div>
                <ag-input-text-field class="ag-mini-filter" ref="eMiniFilter"></ag-input-text-field>
                <div ref="eFilterNoMatches" class="ag-filter-no-matches ag-hidden">${this.translateForSetFilter("noMatches")}</div>
                <div ref="eSetFilterList" class="ag-set-filter-list" role="presentation"></div>
            </div>`}handleKeyDown(t){if(super.handleKeyDown(t),!t.defaultPrevented)switch(t.key){case M.SPACE:this.handleKeySpace(t);break;case M.ENTER:this.handleKeyEnter(t);break;case M.LEFT:this.handleKeyLeft(t);break;case M.RIGHT:this.handleKeyRight(t);break}}handleKeySpace(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.toggleSelected()}handleKeyEnter(t){if(!this.setFilterParams)return;const{excelMode:e,readOnly:s}=this.setFilterParams||{};!e||!!s||(t.preventDefault(),this.onBtApply(!1,!1,t),this.setFilterParams.excelMode==="mac"&&this.eMiniFilter.getInputElement().select())}handleKeyLeft(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.setExpanded(!1)}handleKeyRight(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.setExpanded(!0)}getComponentForKeyEvent(t){var e;if(!this.eSetFilterList.contains(this.gos.getActiveDomElement())||!this.virtualList)return;const s=this.virtualList.getLastFocusedRow();if(s==null)return;const i=this.virtualList.getComponentAt(s);if(i==null)return;t.preventDefault();const{readOnly:r}=(e=this.setFilterParams)!=null?e:{};if(!r)return i}getCssIdentifier(){return"set-filter"}setModel(t){var e;return t==null&&((e=this.valueModel)==null?void 0:e.getModel())==null?(this.setMiniFilter(null),V.resolve()):super.setModel(t)}refresh(t){var e,s,i;return!super.refresh(t)||["treeList","treeListFormatter","treeListPathGetter","keyCreator","convertValuesToStrings","caseSensitive","comparator","suppressSelectAll","excelMode"].some(o=>{var n;return t[o]!==((n=this.setFilterParams)==null?void 0:n[o])})||this.haveColDefParamsChanged(t.colDef)?!1:(super.updateParams(t),this.updateSetFilterOnParamsChange(t),this.updateMiniFilter(),(t.cellRenderer!==((e=this.setFilterParams)==null?void 0:e.cellRenderer)||t.valueFormatter!==((s=this.setFilterParams)==null?void 0:s.valueFormatter))&&this.checkAndRefreshVirtualList(),(i=this.valueModel)==null||i.updateOnParamsChange(t).then(()=>{var o;(o=this.valueModel)!=null&&o.hasSelections()&&this.refreshFilterValues()}),!0)}haveColDefParamsChanged(t){var e;const s=["keyCreator","filterValueGetter"],i=(e=this.setFilterParams)==null?void 0:e.colDef;return s.some(r=>t[r]!==(i==null?void 0:i[r]))}setModelAndRefresh(t){return this.valueModel?this.valueModel.setModel(t).then(()=>this.checkAndRefreshVirtualList()):V.resolve()}resetUiToDefaults(){return this.setMiniFilter(null),this.setModelAndRefresh(null)}setModelIntoUi(t){this.setMiniFilter(null);const e=t==null?null:t.values;return this.setModelAndRefresh(e)}getModelFromUi(){if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getModel();return t?{values:t,filterType:this.getFilterType()}:null}getFilterType(){return"set"}getValueModel(){return this.valueModel}areModelsEqual(t,e){return t==null&&e==null?!0:t!=null&&e!=null&&d.areEqual(t.values,e.values)}setParams(t){var e;this.applyExcelModeOptions(t),super.setParams(t),this.updateSetFilterOnParamsChange(t);const s=(e=t.keyCreator)!=null?e:t.colDef.keyCreator;this.valueModel=new oi({filterParams:t,setIsLoading:i=>this.setIsLoading(i),translate:i=>this.translateForSetFilter(i),caseFormat:i=>this.caseFormat(i),createKey:this.createKey,valueFormatter:this.valueFormatter,usingComplexObjects:!!s,gos:this.gos,columnModel:this.columnModel,valueService:this.valueService,treeDataTreeList:this.treeDataTreeList,groupingTreeList:this.groupingTreeList,addManagedListener:(i,r)=>this.addManagedListener(this.eventService,i,r)}),this.initialiseFilterBodyUi(),this.addEventListenersForDataChanges()}onAddCurrentSelectionToFilterChange(t){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.setAddCurrentSelectionToFilter(t)}setValueFormatter(t,e,s,i,r){let o=t;if(!o){if(e&&!s&&!i)throw new Error("AG Grid: Must supply a Value Formatter in Set Filter params when using a Key Creator unless convertValuesToStrings is enabled");this.noValueFormatterSupplied=!0,r||(o=n=>d.toStringOrNull(n.value))}this.valueFormatter=o}generateCreateKey(t,e,s){if(s&&!t)throw new Error("AG Grid: Must supply a Key Creator in Set Filter params when `treeList = true` on a group column, and Tree Data or Row Grouping is enabled.");return t?(i,r=null)=>{const o=this.getKeyCreatorParams(i,r);return d.makeNull(t(o))}:e?i=>Array.isArray(i)?i:d.makeNull(d.toStringOrNull(i)):i=>d.makeNull(d.toStringOrNull(i))}getFormattedValue(t){var e;let s=this.valueModel.getValue(t);this.noValueFormatterSupplied&&(this.treeDataTreeList||this.groupingTreeList)&&Array.isArray(s)&&(s=d.last(s));const i=this.valueService.formatValue(this.setFilterParams.column,null,s,this.valueFormatter,!1);return(e=i==null?d.toStringOrNull(s):i)!=null?e:this.translateForSetFilter("blanks")}applyExcelModeOptions(t){t.excelMode==="windows"?(t.buttons||(t.buttons=["apply","cancel"]),t.closeOnApply==null&&(t.closeOnApply=!0)):t.excelMode==="mac"&&(t.buttons||(t.buttons=["reset"]),t.applyMiniFilterWhileTyping==null&&(t.applyMiniFilterWhileTyping=!0),t.debounceMs==null&&(t.debounceMs=500)),t.excelMode&&t.defaultToNothingSelected&&(t.defaultToNothingSelected=!1,d.warnOnce('The Set Filter Parameter "defaultToNothingSelected" value was ignored because it does not work when "excelMode" is used.'))}addEventListenersForDataChanges(){!this.isValuesTakenFromGrid()||(this.addManagedListener(this.eventService,f.EVENT_CELL_VALUE_CHANGED,t=>{this.setFilterParams&&t.column===this.setFilterParams.column&&this.syncAfterDataChange()}),this.addManagedPropertyListeners(["treeData","getDataPath","groupAllowUnbalanced"],()=>{this.syncAfterDataChange()}))}syncAfterDataChange(){if(!this.valueModel)throw new Error("Value model has not been created.");return this.valueModel.refreshValues().then(()=>{this.checkAndRefreshVirtualList(),this.onBtApply(!1,!0)})}setIsLoading(t){d.setDisplayed(this.eFilterLoading,t),t||(this.hardRefreshVirtualList=!0)}initialiseFilterBodyUi(){this.initVirtualList(),this.initMiniFilter()}initVirtualList(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const e=this.localeService.getLocaleTextFunc()("ariaFilterList","Filter List"),s=!!this.setFilterParams.treeList,i=this.virtualList=this.createBean(new pt({cssIdentifier:"filter",ariaRole:s?"tree":"listbox",listName:e})),r=this.getRefElement("eSetFilterList");s&&r.classList.add("ag-set-filter-tree-list"),r&&r.appendChild(i.getGui());const{cellHeight:o}=this.setFilterParams;o!=null&&i.setRowHeight(o);const n=(u,c)=>this.createSetListItem(u,s,c);i.setComponentCreator(n);const a=(u,c)=>this.updateSetListItem(u,c);i.setComponentUpdater(a);let l;this.setFilterParams.suppressSelectAll?l=new po(this.valueModel):l=new go(this.valueModel,()=>this.isSelectAllSelected()),s&&(l=new mo(l)),i.setModel(l)}getSelectAllLabel(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getMiniFilter()==null||!this.setFilterParams.excelMode?"selectAll":"selectAllSearchResults";return this.translateForSetFilter(t)}getAddSelectionToFilterLabel(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");return this.translateForSetFilter("addCurrentSelectionToFilter")}createSetListItem(t,e,s){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const i=this.valueModel.hasGroups(),{isSelected:r,isExpanded:o}=this.isSelectedExpanded(t),{value:n,depth:a,isGroup:l,hasIndeterminateExpandState:u,selectedListener:c,expandedListener:h}=this.newSetListItemAttributes(t,e),g={focusWrapper:s,value:n,params:this.setFilterParams,translate:y=>this.translateForSetFilter(y),valueFormatter:this.valueFormatter,item:t,isSelected:r,isTree:e,depth:a,groupsExist:i,isGroup:l,isExpanded:o,hasIndeterminateExpandState:u},m=this.createBean(new Lt(g));return m.addEventListener(Lt.EVENT_SELECTION_CHANGED,c),h&&m.addEventListener(Lt.EVENT_EXPANDED_CHANGED,h),m}newSetTreeItemAttributes(t,e){var s,i,r,o,n,a;if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const l=this.valueModel.hasGroups();return t.key===k.SELECT_ALL?{value:()=>this.getSelectAllLabel(),isGroup:l,depth:t.depth,hasIndeterminateExpandState:!0,selectedListener:u=>this.onSelectAll(u.isSelected),expandedListener:u=>this.onExpandAll(u.item,u.isExpanded)}:t.key===k.ADD_SELECTION_TO_FILTER?{value:()=>this.getAddSelectionToFilterLabel(),depth:t.depth,isGroup:!1,hasIndeterminateExpandState:!1,selectedListener:u=>{this.onAddCurrentSelectionToFilterChange(u.isSelected)}}:t.children?{value:(r=(i=(s=this.setFilterParams).treeListFormatter)==null?void 0:i.call(s,t.treeKey,t.depth,t.parentTreeKeys))!=null?r:t.treeKey,depth:t.depth,isGroup:!0,selectedListener:u=>this.onGroupItemSelected(u.item,u.isSelected),expandedListener:u=>this.onExpandedChanged(u.item,u.isExpanded)}:{value:(a=(n=(o=this.setFilterParams).treeListFormatter)==null?void 0:n.call(o,t.treeKey,t.depth,t.parentTreeKeys))!=null?a:t.treeKey,depth:t.depth,selectedListener:u=>this.onItemSelected(u.item.key,u.isSelected)}}newSetListItemAttributes(t,e){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");return this.isSetFilterModelTreeItem(t)?this.newSetTreeItemAttributes(t,e):t===k.SELECT_ALL?{value:()=>this.getSelectAllLabel(),selectedListener:s=>this.onSelectAll(s.isSelected)}:t===k.ADD_SELECTION_TO_FILTER?{value:()=>this.getAddSelectionToFilterLabel(),selectedListener:s=>{this.onAddCurrentSelectionToFilterChange(s.isSelected)}}:{value:this.valueModel.getValue(t),selectedListener:s=>this.onItemSelected(s.item,s.isSelected)}}updateSetListItem(t,e){const{isSelected:s,isExpanded:i}=this.isSelectedExpanded(t);e.refresh(t,s,i)}isSelectedExpanded(t){let e,s;return this.isSetFilterModelTreeItem(t)?(s=t.expanded,t.key===k.SELECT_ALL?e=this.isSelectAllSelected():t.key===k.ADD_SELECTION_TO_FILTER?e=this.valueModel.isAddCurrentSelectionToFilterChecked():t.children?e=this.areAllChildrenSelected(t):e=this.valueModel.isKeySelected(t.key)):t===k.SELECT_ALL?e=this.isSelectAllSelected():t===k.ADD_SELECTION_TO_FILTER?e=this.valueModel.isAddCurrentSelectionToFilterChecked():e=this.valueModel.isKeySelected(t),{isSelected:e,isExpanded:s}}isSetFilterModelTreeItem(t){return(t==null?void 0:t.treeKey)!==void 0}initMiniFilter(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{eMiniFilter:t,localeService:e}=this,s=e.getLocaleTextFunc();t.setDisplayed(!this.setFilterParams.suppressMiniFilter),t.setValue(this.valueModel.getMiniFilter()),t.onValueChange(()=>this.onMiniFilterInput()),t.setInputAriaLabel(s("ariaSearchFilterValues","Search filter values")),this.addManagedListener(t.getInputElement(),"keydown",i=>this.onMiniFilterKeyDown(i))}updateMiniFilter(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{eMiniFilter:t}=this;t.isDisplayed()!==!this.setFilterParams.suppressMiniFilter&&t.setDisplayed(!this.setFilterParams.suppressMiniFilter);const e=this.valueModel.getMiniFilter();t.getValue()!==e&&t.setValue(e)}afterGuiAttached(t){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");super.afterGuiAttached(t),this.resetExpansion(),this.refreshVirtualList();const{eMiniFilter:e}=this;e.setInputPlaceholder(this.translateForSetFilter("searchOoo")),(!t||!t.suppressFocus)&&e.getFocusableElement().focus()}afterGuiDetached(){var t,e;super.afterGuiDetached(),(t=this.setFilterParams)!=null&&t.excelMode&&this.resetMiniFilter();const s=this.getModel();(((e=this.setFilterParams)==null?void 0:e.excelMode)||!this.areModelsEqual(s,this.getModelFromUi()))&&(this.resetUiToActiveModel(s),this.showOrHideResults())}applyModel(t="api"){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");this.setFilterParams.excelMode&&t!=="rowDataUpdated"&&this.valueModel.isEverythingVisibleSelected()&&this.valueModel.selectAllMatchingMiniFilter();const e=this.valueModel.showAddCurrentSelectionToFilter()&&this.valueModel.isAddCurrentSelectionToFilterChecked();if(e&&!this.getModel())return!1;const s=super.applyModel(t),i=this.getModel();return i?(e||this.valueModel.setAppliedModelKeys(new Set),i.values.forEach(r=>{this.valueModel.addToAppliedModelKeys(r)})):e||this.valueModel.setAppliedModelKeys(null),s}isModelValid(t){return this.setFilterParams&&this.setFilterParams.excelMode?t==null||t.values.length>0:!0}doesFilterPass(t){if(!this.setFilterParams||!this.valueModel||!this.valueModel.getCaseFormattedAppliedModelKeys())return!0;if(!this.valueModel.hasAnyAppliedModelKey())return!1;const{node:e,data:s}=t;if(this.treeDataTreeList)return this.doesFilterPassForTreeData(e,s);if(this.groupingTreeList)return this.doesFilterPassForGrouping(e);let i=this.getValueFromNode(e);return this.convertValuesToStrings?this.doesFilterPassForConvertValuesToString(e,i):i!=null&&Array.isArray(i)?i.length===0?this.valueModel.hasAppliedModelKey(null):i.some(r=>this.isInAppliedModel(this.createKey(r,e))):this.isInAppliedModel(this.createKey(i,e))}doesFilterPassForConvertValuesToString(t,e){const s=this.createKey(e,t);return s!=null&&Array.isArray(s)?s.length===0?this.valueModel.hasAppliedModelKey(null):s.some(i=>this.isInAppliedModel(i)):this.isInAppliedModel(s)}doesFilterPassForTreeData(t,e){var s;return(s=t.childrenAfterGroup)!=null&&s.length?!1:this.isInAppliedModel(this.createKey(this.checkMakeNullDataPath(this.getDataPath(e))))}doesFilterPassForGrouping(t){const e=this.columnModel.getRowGroupColumns().map(s=>this.valueService.getKeyForNode(s,t));return e.push(this.getValueFromNode(t)),this.isInAppliedModel(this.createKey(this.checkMakeNullDataPath(e)))}checkMakeNullDataPath(t){return t&&(t=t.map(e=>d.toStringOrNull(d.makeNull(e)))),t!=null&&t.some(e=>e==null)?null:t}isInAppliedModel(t){return this.valueModel.hasAppliedModelKey(t)}getValueFromNode(t){return this.setFilterParams.getValue(t)}getKeyCreatorParams(t,e=null){return{value:t,colDef:this.setFilterParams.colDef,column:this.setFilterParams.column,node:e,data:e==null?void 0:e.data,api:this.setFilterParams.api,columnApi:this.setFilterParams.columnApi,context:this.setFilterParams.context}}onNewRowsLoaded(){!this.isValuesTakenFromGrid()||this.syncAfterDataChange()}isValuesTakenFromGrid(){return this.valueModel?this.valueModel.getValuesType()===2:!1}setFilterValues(t){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.overrideValues(t).then(()=>{this.checkAndRefreshVirtualList(),this.onUiChanged()})}resetFilterValues(){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.setValuesType(2),this.syncAfterDataChange()}refreshFilterValues(){if(!this.valueModel)throw new Error("Value model has not been created.");!this.valueModel.isInitialised()||this.valueModel.refreshValues().then(()=>{this.checkAndRefreshVirtualList(),this.onUiChanged()})}onAnyFilterChanged(){setTimeout(()=>{if(!!this.isAlive()){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.refreshAfterAnyFilterChanged().then(t=>{t&&(this.checkAndRefreshVirtualList(),this.showOrHideResults())})}},0)}onMiniFilterInput(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.valueModel.setMiniFilter(this.eMiniFilter.getValue()))return;const{applyMiniFilterWhileTyping:t,readOnly:e}=this.setFilterParams||{};!e&&t?this.filterOnAllVisibleValues(!1):this.updateUiAfterMiniFilterChange()}updateUiAfterMiniFilterChange(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{excelMode:t,readOnly:e}=this.setFilterParams||{};t==null||!!e?this.checkAndRefreshVirtualList():this.valueModel.getMiniFilter()==null?this.resetUiToActiveModel(this.getModel()):(this.valueModel.selectAllMatchingMiniFilter(!0),this.checkAndRefreshVirtualList(),this.onUiChanged()),this.showOrHideResults()}showOrHideResults(){if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getMiniFilter()!=null&&this.valueModel.getDisplayedValueCount()<1;d.setDisplayed(this.eNoMatches,t),d.setDisplayed(this.eSetFilterList,!t)}resetMiniFilter(){var t;this.eMiniFilter.setValue(null,!0),(t=this.valueModel)==null||t.setMiniFilter(null)}resetUiToActiveModel(t,e){this.setModelAndRefresh(t==null?null:t.values).then(()=>{this.onUiChanged(!1,"prevent"),e==null||e()})}handleCancelEnd(t){this.setMiniFilter(null),super.handleCancelEnd(t)}onMiniFilterKeyDown(t){const{excelMode:e,readOnly:s}=this.setFilterParams||{};t.key===M.ENTER&&!e&&!s&&this.filterOnAllVisibleValues()}filterOnAllVisibleValues(t=!0){const{readOnly:e}=this.setFilterParams||{};if(!this.valueModel)throw new Error("Value model has not been created.");if(e)throw new Error("Unable to filter in readOnly mode.");this.valueModel.selectAllMatchingMiniFilter(!0),this.checkAndRefreshVirtualList(),this.onUiChanged(!1,t?"immediately":"debounce"),this.showOrHideResults()}focusRowIfAlive(t){t!=null&&window.setTimeout(()=>{if(!this.virtualList)throw new Error("Virtual list has not been created.");this.isAlive()&&this.virtualList.focusRow(t)},0)}onSelectAll(t){if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.virtualList)throw new Error("Virtual list has not been created.");t?this.valueModel.selectAllMatchingMiniFilter():this.valueModel.deselectAllMatchingMiniFilter(),this.refreshAfterSelection()}onGroupItemSelected(t,e){const s=i=>{i.children?i.children.forEach(r=>s(r)):this.selectItem(i.key,e)};s(t),this.refreshAfterSelection()}onItemSelected(t,e){if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.virtualList)throw new Error("Virtual list has not been created.");this.selectItem(t,e),this.refreshAfterSelection()}selectItem(t,e){e?this.valueModel.selectKey(t):this.valueModel.deselectKey(t)}onExpandAll(t,e){const s=i=>{i.filterPasses&&i.available&&i.children&&(i.children.forEach(r=>s(r)),i.expanded=e)};s(t),this.refreshAfterExpansion()}onExpandedChanged(t,e){t.expanded=e,this.refreshAfterExpansion()}refreshAfterExpansion(){const t=this.virtualList.getLastFocusedRow();this.valueModel.updateDisplayedValues("expansion"),this.checkAndRefreshVirtualList(),this.focusRowIfAlive(t)}refreshAfterSelection(){const t=this.virtualList.getLastFocusedRow();this.checkAndRefreshVirtualList(),this.onUiChanged(),this.focusRowIfAlive(t)}setMiniFilter(t){this.eMiniFilter.setValue(t),this.onMiniFilterInput()}getMiniFilter(){return this.valueModel?this.valueModel.getMiniFilter():null}checkAndRefreshVirtualList(){if(!this.virtualList)throw new Error("Virtual list has not been created.");this.virtualList.refresh(!this.hardRefreshVirtualList),this.hardRefreshVirtualList&&(this.hardRefreshVirtualList=!1)}getFilterKeys(){return this.valueModel?this.valueModel.getKeys():[]}getFilterValues(){return this.valueModel?this.valueModel.getValues():[]}getValues(){return this.getFilterKeys()}refreshVirtualList(){this.setFilterParams&&this.setFilterParams.refreshValuesOnOpen?this.refreshFilterValues():this.checkAndRefreshVirtualList()}translateForSetFilter(t){return this.localeService.getLocaleTextFunc()(t,ho[t])}isSelectAllSelected(){if(!this.setFilterParams||!this.valueModel)return!1;if(this.setFilterParams.defaultToNothingSelected){if(this.valueModel.hasSelections()&&this.valueModel.isEverythingVisibleSelected())return!0;if(this.valueModel.isNothingVisibleSelected())return!1}else{if(this.valueModel.hasSelections()&&this.valueModel.isNothingVisibleSelected())return!1;if(this.valueModel.isEverythingVisibleSelected())return!0}}areAllChildrenSelected(t){const e=s=>{if(s.children){let i=!1,r=!1;return s.children.some(n=>{if(!n.filterPasses||!n.available)return!1;const a=e(n);return a===void 0?!0:(a?i=!0:r=!0,i&&r)})?void 0:i}else return this.valueModel.isKeySelected(s.key)};return this.setFilterParams.defaultToNothingSelected?this.valueModel.hasSelections()&&e(t):e(t)}destroy(){this.virtualList!=null&&(this.virtualList.destroy(),this.virtualList=null),super.destroy()}caseFormat(t){return t==null||typeof t!="string"||this.caseSensitive?t:t.toUpperCase()}resetExpansion(){var t,e;if(!((t=this.setFilterParams)!=null&&t.treeList))return;const s=(e=this.valueModel)==null?void 0:e.getSelectAllItem();if(this.isSetFilterModelTreeItem(s)){const i=r=>{r.children&&(r.children.forEach(o=>i(o)),r.expanded=!1)};i(s),this.valueModel.updateDisplayedValues("expansion")}}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t,this)}getPositionableElement(){return this.eSetFilterList}};W([E("eMiniFilter")],fe.prototype,"eMiniFilter",2);W([E("eFilterLoading")],fe.prototype,"eFilterLoading",2);W([E("eSetFilterList")],fe.prototype,"eSetFilterList",2);W([E("eFilterNoMatches")],fe.prototype,"eNoMatches",2);W([p("columnModel")],fe.prototype,"columnModel",2);W([p("valueService")],fe.prototype,"valueService",2);var po=class{constructor(t){this.model=t}getRowCount(){return this.model.getDisplayedValueCount()}getRow(t){return this.model.getDisplayedItem(t)}areRowsEqual(t,e){return t===e}},go=class{constructor(t,e){this.model=t,this.isSelectAllSelected=e}getRowCount(){const e=this.model.showAddCurrentSelectionToFilter()?2:1;return this.model.getDisplayedValueCount()+e}getRow(t){if(t===0)return this.model.getSelectAllItem();const e=this.model.showAddCurrentSelectionToFilter(),s=e?2:1;return t===1&&e?this.model.getAddSelectionToFilterItem():this.model.getDisplayedItem(t-s)}areRowsEqual(t,e){return t===e}},mo=class{constructor(t){this.model=t}getRowCount(){return this.model.getRowCount()}getRow(t){return this.model.getRow(t)}areRowsEqual(t,e){return t==null&&e==null?!0:t!=null&&e!=null&&t.treeKey===e.treeKey&&t.depth===e.depth}},Qt=class extends L{constructor(){super(`
            <div class="ag-floating-filter-input ag-set-floating-filter-input" role="presentation">
                <ag-input-text-field ref="eFloatingFilterText"></ag-input-text-field>
            </div>`),this.availableValuesListenerAdded=!1,this.filterModelFormatter=new ni}destroy(){super.destroy()}init(t){this.params=t,this.eFloatingFilterText.setDisabled(!0).addGuiEventListener("click",()=>this.params.showParentFilter()),this.setParams(t)}setParams(t){const e=this.columnModel.getDisplayNameForColumn(t.column,"header",!0),s=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setInputAriaLabel(`${e} ${s("ariaFilterInput","Filter Input")}`)}onParamsUpdated(t){this.refresh(t)}refresh(t){this.params=t,this.setParams(t)}onParentModelChanged(t){this.updateFloatingFilterText(t)}parentSetFilterInstance(t){this.params.parentFilterInstance(e=>{if(!(e instanceof fe))throw new Error("AG Grid - SetFloatingFilter expects SetFilter as its parent");t(e)})}addAvailableValuesListener(){this.parentSetFilterInstance(t=>{const e=t.getValueModel();!e||this.addManagedListener(e,oi.EVENT_AVAILABLE_VALUES_CHANGED,()=>this.updateFloatingFilterText())}),this.availableValuesListenerAdded=!0}updateFloatingFilterText(t){this.availableValuesListenerAdded||this.addAvailableValuesListener(),this.parentSetFilterInstance(e=>{this.eFloatingFilterText.setValue(this.filterModelFormatter.getModelAsString(t,e))})}};W([E("eFloatingFilterText")],Qt.prototype,"eFloatingFilterText",2);W([p("columnModel")],Qt.prototype,"columnModel",2);var fo="31.3.2",So={version:fo,moduleName:x.SetFilterModule,beans:[],userComponents:[{componentName:"agSetColumnFilter",componentClass:fe},{componentName:"agSetColumnFloatingFilter",componentClass:Qt}],dependantModules:[_e]};export{yo as A,Ao as C,Fo as M,So as S,Eo as a};
